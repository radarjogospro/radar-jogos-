<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Radar Jogos PRO</title>

  <style>
    :root{
      --accent:#22d48a;
      --accent2:#12b976;
      --glow: rgba(34,212,138,.22);

      --bg0:#06141b;
      --bg1:#062a2a;

      --stroke:rgba(255,255,255,.09);
      --text:#eaf4f6;
      --muted:rgba(234,244,246,.70);
      --muted2:rgba(234,244,246,.52);

      --danger:#b85a5a;
      --warn:#fbbf24;

      --shadow: 0 22px 80px rgba(0,0,0,.55);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;

      background:
        radial-gradient(900px 420px at 50% -120px, var(--glow), transparent 62%),
        radial-gradient(700px 460px at 15% 10%, rgba(255,255,255,.06), transparent 62%),
        radial-gradient(900px 520px at 90% 30%, rgba(120,140,255,.12), transparent 62%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
    }

    .wrap{max-width: 900px; margin:0 auto; padding: 14px 14px 126px;}

    /* Top */
    .topbar{
      position: sticky;
      top:0;
      z-index: 60;
      padding: 12px 0 10px;
      background: linear-gradient(180deg, rgba(8,26,36,.82), rgba(6,20,27,.18));
      backdrop-filter: blur(14px);
    }
    .brand{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 12px 12px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      box-shadow: 0 14px 34px rgba(0,0,0,.34);
    }
    .title{display:flex; flex-direction:column; gap:4px; line-height:1.05;}
    .title h1{margin:0; font-size: 18px; letter-spacing:.3px; font-weight: 950;}
    .status{
      display:flex; align-items:center; gap:10px;
      font-weight: 900; font-size: 13px; color: var(--muted);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(34,212,138,.14);
    }
    .iconBtn{
      border:none; cursor:pointer; padding: 10px 12px; border-radius: 14px;
      background: rgba(255,255,255,.06); color: var(--text);
      font-weight: 950; border:1px solid var(--stroke);
      user-select:none;
    }

    /* Panel */
    .panel{
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      background:
        radial-gradient(900px 250px at 15% 0%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(700px 260px at 90% 0%, rgba(120,140,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(11,35,45,.82), rgba(9,28,37,.62));
      backdrop-filter: blur(12px);
      position: relative;
      overflow:hidden;
    }
    .panel::after{
      content:"";
      position:absolute; inset:-60px;
      opacity:.08;
      background-image: radial-gradient(circle, #fff 1px, transparent 1px);
      background-size: 18px 18px;
      pointer-events:none;
      transform: rotate(8deg);
    }

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; position:relative; z-index:2}
    .search{
      flex:1; min-width: 210px;
      padding: 14px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline: none;
      font-size: 15px;
    }
    .btn{
      padding: 12px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight: 950;
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      border:none;
      color:#071d18;
      box-shadow: 0 14px 34px rgba(0,0,0,.22);
    }
    .meta{
      margin-top: 10px;
      color: var(--muted);
      line-height: 1.35;
      font-weight: 850;
      font-size: 13px;
      position:relative;
      z-index:2;
    }

    /* Chips */
    .chips{margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap; position:relative; z-index:2}
    .chip{
      padding: 10px 13px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      font-size: 13px;
      display:flex; align-items:center; gap:8px;
    }
    .chip.active{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
      border-color: rgba(255,255,255,.14);
    }
    .dotmini{width:8px; height:8px; border-radius:50%; background: var(--accent); box-shadow: 0 0 0 6px rgba(34,212,138,.12);}
    .hint{
      margin-top: 10px;
      color: var(--muted2);
      font-weight: 800;
      font-size: 12px;
      line-height: 1.35;
      position:relative;
      z-index:2;
    }

    /* Calendar bar */
    .datebar{
      margin-top: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.12);
      padding: 12px;
      border-radius: 18px;
      position:relative;
      z-index:2;
    }
    .datebar .left{display:flex; gap:10px; flex-wrap:wrap; align-items:center; font-weight: 950; font-size: 13px;}
    .tag{
      font-weight: 950;
      padding: 5px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      font-size: 11px;
      color: rgba(234,244,246,.80);
    }
    .datepill{
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      font-size: 12px;
    }
    .datepill.active{border-color: rgba(255,255,255,.16); background: rgba(255,255,255,.09);}
    .datebar .right{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .dateinput{
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 900;
      outline:none;
    }

    /* List */
    .list{margin-top: 14px; display:flex; flex-direction:column; gap:12px;}

    /* Card */
    .card{
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 280px at 12% -30%, rgba(255,255,255,.06), transparent 55%),
        radial-gradient(900px 280px at 85% 0%, rgba(120,140,255,.12), transparent 55%),
        radial-gradient(900px 280px at 42% 0%, var(--glow), transparent 60%),
        linear-gradient(180deg, rgba(11,35,45,.92), rgba(9,28,37,.74));
      box-shadow: 0 18px 60px rgba(0,0,0,.34);
      padding: 16px;
      position:relative;
      overflow:hidden;
    }

    /* ‚ÄúBanner‚Äù art√≠stico sem imagem externa */
    .card::before{
      content:"";
      position:absolute;
      left:-40px; top:-30px;
      width: 220px; height: 140px;
      border-radius: 28px;
      opacity:.22;
      background:
        radial-gradient(circle at 30% 40%, rgba(255,255,255,.35), transparent 55%),
        radial-gradient(circle at 70% 30%, rgba(255,255,255,.22), transparent 50%),
        radial-gradient(circle at 50% 65%, rgba(255,255,255,.18), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10);
      transform: rotate(-10deg);
      pointer-events:none;
    }

    .match{
      font-size: 26px;
      font-weight: 950;
      line-height: 1.05;
      margin: 0 0 8px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-weight: 850;
      font-size: 14px;
      line-height:1.2;
    }

    .topline{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
    }

    .pillrow{display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; align-items:center}
    .pill{
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      font-weight: 950;
      font-size: 12px;
    }
    .pill.live{
      border-color: rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
    }
    .pill.final{border-color: rgba(184,90,90,.32); background: rgba(184,90,90,.14)}
    .pill.warn{border-color: rgba(251,191,36,.26); background: rgba(251,191,36,.12)}

    .badgeLive{
      display:flex; align-items:center; gap:8px;
      font-weight: 950;
      font-size: 12px;
      padding: 8px 11px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
    }
    .liveDot{
      width:10px; height:10px; border-radius:50%;
      background:#ff4d4d;
      box-shadow: 0 0 0 6px rgba(255,77,77,.14);
    }

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px;}
    .btn.small{padding: 11px 14px; border-radius: 14px; font-weight: 950; font-size: 13px}
    .btn.star{display:flex; align-items:center; gap:8px}

    /* Insights */
    .section{
      margin-top: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.07);
      background: rgba(0,0,0,.14);
      padding: 12px;
    }
    .sectionHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .sectionHead h3{
      margin:0;
      font-size: 12px;
      letter-spacing:.4px;
      color: rgba(234,244,246,.86);
      text-transform: uppercase;
      font-weight: 950;
    }
    .tabs{display:flex; gap:8px; flex-wrap:wrap;}
    .tab{
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(234,244,246,.86);
      font-weight: 950;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      border-color: rgba(255,255,255,.14);
      background: rgba(255,255,255,.09);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 8px 12px;
      align-items:center;
      font-weight: 900;
      color: rgba(234,244,246,.82);
      font-size: 13px;
    }
    .mut{color: rgba(234,244,246,.62)}
    .miniNote{
      margin-top: 8px;
      color: rgba(234,244,246,.58);
      font-weight: 850;
      font-size: 12px;
      line-height: 1.35;
    }

    .empty{
      text-align:center;
      padding: 18px 12px 14px;
      color: rgba(234,244,246,.78);
      font-weight: 950;
      border:1px dashed rgba(255,255,255,.16);
      border-radius: 22px;
      background: rgba(0,0,0,.10);
    }
    .empty .mini{
      margin-top: 10px;
      color: rgba(234,244,246,.56);
      font-weight: 850;
      font-size: 13px;
      line-height: 1.35;
    }
    .empty .actions2{
      display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
      margin-top: 12px;
    }

    /* Bottom nav */
    .bottom{
      position: fixed;
      left:0; right:0; bottom: 12px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index: 80;
    }
    .bottom .bar{
      width: min(900px, calc(100% - 24px));
      display:flex; gap: 10px;
      background: rgba(8,22,28,.64);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 24px;
      padding: 10px;
      backdrop-filter: blur(14px);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      pointer-events:auto;
    }
    .bigbtn{
      flex:1;
      border-radius: 20px;
      padding: 14px 14px;
      font-weight: 950;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      display:flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer;
      user-select:none;
      font-size: 14px;
      opacity:.94;
    }
    .bigbtn.active{
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      color:#061d18;
      border:none;
      opacity:1;
      box-shadow: 0 14px 34px rgba(0,0,0,.22);
    }

    /* Modal */
    .modal{
      position: fixed; inset:0;
      background: rgba(0,0,0,.50);
      display:none;
      align-items: flex-end;
      justify-content:center;
      padding: 14px;
      z-index: 999;
    }
    .modal.open{display:flex;}
    .sheet{
      width: min(900px, 100%);
      background: rgba(10,27,35,.94);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 26px;
      box-shadow: 0 22px 80px rgba(0,0,0,.55);
      padding: 14px;
      backdrop-filter: blur(14px);
    }
    .sheet h2{margin: 6px 6px 12px; font-size: 16px; letter-spacing:.2px;}
    .item{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      padding: 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
      margin: 10px 0;
      font-size: 14px;
    }
    .item .right{color: rgba(234,244,246,.55); font-weight: 900}
    .close{
      margin-top: 10px;
      width:100%;
      padding: 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="title">
          <h1>Radar Jogos PRO</h1>
          <div class="status"><span class="dot"></span> Online</div>
        </div>
        <button class="iconBtn" id="openMenu">‚Ä¶ Menu</button>
      </div>
    </div>

    <section class="panel">
      <div class="row">
        <input id="q" class="search" placeholder="Buscar time, liga ou pa√≠s..." />
        <button id="clear" class="btn">Limpar</button>
        <button id="refresh" class="btn primary">Atualizar</button>
      </div>

      <div id="meta" class="meta">Carregando‚Ä¶</div>

      <div class="chips">
        <div class="chip active" data-tab="smart"><span class="dotmini"></span> ‚ö° Ao vivo + Pr√≥ximos</div>
        <div class="chip" data-tab="live"><span class="dotmini" style="background:#ff4d4d; box-shadow:none;"></span> üî¥ Ao vivo</div>
        <div class="chip" data-tab="date">üìÖ Calend√°rio</div>
        <div class="chip" data-tab="br">üáßüá∑ Brasil</div>
        <div class="chip" data-tab="eu">üá™üá∫ Europa</div>
        <div class="chip" data-tab="all">üåç Todos</div>
      </div>

      <div id="datebar" class="datebar" style="display:none;">
        <div class="left">
          <span class="tag">Data</span>
          <button class="datepill" id="btnToday">Hoje</button>
          <button class="datepill" id="btnTomorrow">Amanh√£</button>
        </div>
        <div class="right">
          <input class="dateinput" id="datePick" type="date" />
          <button class="btn" id="dateApply">Aplicar</button>
        </div>
      </div>

      <div class="hint">
        * Odds/probabilidades s√£o estimativas. No FREE, a API limita e nem todos os jogos recebem c√°lculo (mas o layout j√° fica pronto pra quando voc√™ assinar).
      </div>
    </section>

    <section id="list" class="list"></section>
  </div>

  <div class="bottom">
    <div class="bar">
      <button class="bigbtn active" id="goGames">üóìÔ∏è Jogos</button>
      <button class="bigbtn" id="goFav">‚òÖ Favoritos</button>
      <button class="bigbtn" id="goHist">‚è±Ô∏è Hist√≥rico</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <h2>Menu</h2>
      <button class="item" data-view="games"><span>Jogos</span><span class="right">principal</span></button>
      <button class="item" data-view="fav"><span>Favoritos</span><span class="right">salvos</span></button>
      <button class="item" data-view="hist"><span>Hist√≥rico</span><span class="right">vistos</span></button>

      <button class="item" id="toggleInsights">
        <span>Mostrar ‚ÄúInsights‚Äù</span>
        <span class="right" id="insightsState">ligado</span>
      </button>

      <button class="item" id="cycleTheme"><span>Tema / Cores</span><span class="right" id="themeName">verde</span></button>

      <button class="item" data-view="cfg"><span>Configura√ß√µes</span><span class="right">em breve</span></button>
      <button class="close" id="closeMenu">Fechar</button>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));
    const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));

    /* ========= THEMES ========= */
    const THEMES = [
      { key:'verde',  accent:'#22d48a', accent2:'#12b976', glow:'rgba(34,212,138,.22)', bg1:'#062a2a' },
      { key:'azul',   accent:'#4fb3ff', accent2:'#2f7cff', glow:'rgba(79,179,255,.22)', bg1:'#071f33' },
      { key:'roxo',   accent:'#a78bfa', accent2:'#7c3aed', glow:'rgba(167,139,250,.22)', bg1:'#1b1033' },
      { key:'ambar',  accent:'#fbbf24', accent2:'#f59e0b', glow:'rgba(251,191,36,.20)', bg1:'#2a1d08' },
    ];

    function applyTheme(key){
      const t = THEMES.find(x=>x.key===key) || THEMES[0];
      document.documentElement.style.setProperty('--accent', t.accent);
      document.documentElement.style.setProperty('--accent2', t.accent2);
      document.documentElement.style.setProperty('--glow', t.glow);
      document.documentElement.style.setProperty('--bg1', t.bg1);
      localStorage.setItem('theme_key', t.key);
      $('#themeName').textContent = t.key;
    }
    function nextTheme(){
      const cur = localStorage.getItem('theme_key') || 'verde';
      const idx = Math.max(0, THEMES.findIndex(x=>x.key===cur));
      applyTheme(THEMES[(idx+1) % THEMES.length].key);
    }

    /* ========= STATE ========= */
    const state = {
      raw: null,
      games: [],
      tab: 'smart',
      view: 'games',
      q: '',
      selectedDate: null,
      fav: new Set(JSON.parse(localStorage.getItem('fav_ids')||'[]')),
      seen: new Set(JSON.parse(localStorage.getItem('seen_ids')||'[]')),
      showInsights: (localStorage.getItem('show_insights') ?? '1') === '1',
      cardTab: JSON.parse(localStorage.getItem('card_tabs')||'{}') // {id:"odds|mm|form"}
    };

    function saveLocal(){
      localStorage.setItem('fav_ids', JSON.stringify(Array.from(state.fav)));
      localStorage.setItem('seen_ids', JSON.stringify(Array.from(state.seen)));
      localStorage.setItem('show_insights', state.showInsights ? '1' : '0');
      localStorage.setItem('card_tabs', JSON.stringify(state.cardTab));
    }

    function setBottomActive(which){
      $('#goGames').classList.toggle('active', which==='games');
      $('#goFav').classList.toggle('active', which==='fav');
      $('#goHist').classList.toggle('active', which==='hist');
    }

    function normalize(s){
      return (s||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');
    }

    function isEurope(country){
      const c = normalize(country);
      return ['england','spain','italy','germany','france','portugal','netherlands','belgium','turkey','greece','scotland','wales','ireland','sweden','norway','denmark','finland','austria','switzerland','poland','czech','croatia','serbia','ukraine','romania','bulgaria','hungary']
        .some(k=>c.includes(k));
    }

    /* ========= TIME HELPERS ========= */
    function todayYMD_SP(){
      return new Intl.DateTimeFormat('en-CA', {
        timeZone:'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(new Date());
    }
    function tomorrowYMD_SP(){
      return new Intl.DateTimeFormat('en-CA', {
        timeZone:'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(new Date(Date.now()+24*3600*1000));
    }
    function ymdSP_from_ts(ts){
      return new Intl.DateTimeFormat('en-CA', {
        timeZone:'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(new Date(ts*1000));
    }
    function formatTimeSP(ts){
      return new Intl.DateTimeFormat('pt-BR', {
        timeZone:'America/Sao_Paulo',
        hour:'2-digit', minute:'2-digit'
      }).format(new Date(ts*1000));
    }
    function formatDateSP(ts){
      return new Intl.DateTimeFormat('pt-BR', {
        timeZone:'America/Sao_Paulo',
        day:'2-digit', month:'2-digit', year:'numeric'
      }).format(new Date(ts*1000));
    }

    // Converter date+time (do seu JSON atual) => timestamp
    // Obs: fixo -03:00 (Brasil sem hor√°rio de ver√£o atualmente)
    function tsFromDateTime_SP(dateStr, timeStr){
      if(!dateStr) return null;
      const t = (timeStr && /^\d\d:\d\d$/.test(timeStr)) ? timeStr : '00:00';
      const iso = `${dateStr}T${t}:00-03:00`;
      const d = new Date(iso);
      const ms = d.getTime();
      if(Number.isNaN(ms)) return null;
      return Math.floor(ms/1000);
    }

    function ensureSelectedDate(){
      if(!state.selectedDate) state.selectedDate = todayYMD_SP();
    }

    /* ========= PARSE GAMES (compat√≠vel com seu JSON atual e futuros) ========= */
    function makeId(g, idx){
      const base = `${g.home||''}|${g.away||''}|${g.league||''}|${g.country||''}|${g.date||''}|${g.time||''}|${g.ts||''}|${idx}`;
      // hash simples
      let h=0;
      for(let i=0;i<base.length;i++){ h = ((h<<5)-h) + base.charCodeAt(i); h |= 0; }
      return Math.abs(h);
    }

    function isLiveStatus(status){
      const s = (status||'').toUpperCase();
      return ['1H','2H','HT','ET','P','LIVE','IN PLAY'].includes(s);
    }

    function normalizeGame(raw, idx){
      const home = raw.home ?? raw.teams?.home?.name ?? 'Casa';
      const away = raw.away ?? raw.teams?.away?.name ?? 'Fora';
      const league = raw.league ?? raw.league?.name ?? raw.competition ?? 'Liga';
      const country = raw.country ?? raw.league?.country ?? raw.area ?? 'World';
      const status = raw.status ?? raw.fixture?.status?.short ?? raw.fixture?.status?.long ?? 'NS';

      // ts preferido (se existir), sen√£o cria via date/time
      const ts =
        (typeof raw.ts === 'number' ? raw.ts :
        typeof raw.timestamp === 'number' ? raw.timestamp :
        typeof raw.fixture?.timestamp === 'number' ? raw.fixture.timestamp :
        tsFromDateTime_SP(raw.date, raw.time));

      const id = raw.id ?? raw.fixture?.id ?? makeId(raw, idx);

      const live = !!raw.live || isLiveStatus(status);
      const score = raw.score ?? (raw.goals ? {home: raw.goals.home, away: raw.goals.away} : null);
      const probs = raw.probs ?? raw.odds ?? null; // para futuro

      return { id:Number(id), home, away, league, country, status, ts: ts ?? 0, live, score, probs, raw };
    }

    /* ========= FILTERS ========= */
    function gameMatchesQuery(g){
      const q = normalize(state.q);
      if(!q) return true;
      const text = normalize(`${g.home} ${g.away} ${g.league} ${g.country}`);
      return text.includes(q);
    }
    function gameMatchesView(g){
      if(state.view === 'games') return true;
      if(state.view === 'fav') return state.fav.has(g.id);
      if(state.view === 'hist') return state.seen.has(g.id);
      return false;
    }
    function gameMatchesTab(g){
      if(state.tab === 'all') return true;
      if(state.tab === 'br') return normalize(g.country).includes('brazil');
      if(state.tab === 'eu') return isEurope(g.country);
      if(state.tab === 'live') return !!g.live;

      if(state.tab === 'date'){
        ensureSelectedDate();
        return ymdSP_from_ts(g.ts) === state.selectedDate;
      }

      // smart: ao vivo + pr√≥ximos 36h + √∫ltimas 8h (deixa mais ‚Äúcheio‚Äù)
      if(state.tab === 'smart'){
        const now = Date.now()/1000;
        const withinPast = (g.ts >= (now - (8*3600)));
        const withinFuture = (g.ts <= (now + (36*3600)));
        const isOldFinal = (g.ts < (now - (8*3600))) && (['FT','AET','PEN'].includes((g.status||'').toUpperCase()));
        return (g.live || (withinPast && withinFuture)) && !isOldFinal;
      }
      return true;
    }

    function statusLabel(g){
      const s = (g.status||'').toUpperCase();
      if(g.live) return 'Ao vivo';
      if(['FT','AET','PEN'].includes(s)) return 'Final';
      if(s === 'NS') return 'N√£o iniciado';
      if(s) return g.status;
      return 'Agendado';
    }
    function statusClass(g){
      const s = (g.status||'').toUpperCase();
      if(g.live) return 'pill live';
      if(['FT','AET','PEN'].includes(s)) return 'pill final';
      if(s === 'PST' || s === 'CANC') return 'pill warn';
      return 'pill';
    }

    /* ========= INSIGHTS UI ========= */
    function fmtOddsRow(label, obj){
      if(!obj) return `<div class="mut">${label}</div><div>‚Äî% ‚Ä¢ odd ‚Äî</div>`;
      // aceita {p, odd} ou {prob, odd}
      const p = obj.p ?? obj.prob ?? null;
      const o = obj.odd ?? null;
      if(p == null || o == null) return `<div class="mut">${label}</div><div>‚Äî% ‚Ä¢ odd ‚Äî</div>`;
      return `<div class="mut">${label}</div><div>${p}% ‚Ä¢ odd ${o}</div>`;
    }

    function cardInsights(g){
      const tab = state.cardTab[g.id] || 'odds';
      const hasOdds = !!g.probs;

      const oddsHtml = `
        <div class="grid">
          ${fmtOddsRow('Over 1,5', g.probs?.over15)}
          ${fmtOddsRow('Over 2,5', g.probs?.over25)}
          ${fmtOddsRow('Under 1,5', g.probs?.under15)}
          ${fmtOddsRow('Under 2,5', g.probs?.under25)}
        </div>
        <div class="miniNote">
          ${hasOdds ? 'Base: √∫ltimos 3 jogos (quando dispon√≠vel).' : 'No modo FREE, o c√°lculo pode n√£o aparecer. O layout fica pronto para a API paga.'}
        </div>
      `;

      // UI de Mais/Menos (pronta para futuro)
      const mmHtml = `
        <div class="grid">
          <div class="mut">Mais prov√°vel</div><div>+ Over 1,5</div>
          <div class="mut">Risco m√©dio</div><div>¬± Over 2,5</div>
          <div class="mut">Defensivo</div><div>‚àí Under 2,5</div>
          <div class="mut">Trava</div><div>‚àí Under 1,5</div>
        </div>
        <div class="miniNote">Sinal ‚Äú+ / ¬± / ‚àí‚Äù (placeholder). Quando voc√™ assinar a API, a gente liga isso nos dados reais.</div>
      `;

      // UI de Forma (√∫ltimos 3) - pronta
      const formHtml = `
        <div class="grid">
          <div class="mut">${g.home} (3 jogos)</div><div>W ‚Ä¢ D ‚Ä¢ L</div>
          <div class="mut">${g.away} (3 jogos)</div><div>D ‚Ä¢ W ‚Ä¢ L</div>
          <div class="mut">Gols m√©dios</div><div>‚Äî</div>
          <div class="mut">Tend√™ncia</div><div>‚Äî</div>
        </div>
        <div class="miniNote">Aba ‚ÄúForma‚Äù fica perfeita quando tiver endpoint de √∫ltimos jogos/estat√≠sticas.</div>
      `;

      const content = tab === 'odds' ? oddsHtml : tab === 'mm' ? mmHtml : formHtml;

      return `
        <div class="section">
          <div class="sectionHead">
            <h3>Insights</h3>
            <div class="tabs">
              <div class="tab ${tab==='odds'?'active':''}" data-ctab="odds" data-id="${g.id}">Odds</div>
              <div class="tab ${tab==='mm'?'active':''}" data-ctab="mm" data-id="${g.id}">Mais/Menos</div>
              <div class="tab ${tab==='form'?'active':''}" data-ctab="form" data-id="${g.id}">Forma</div>
            </div>
          </div>
          ${content}
        </div>
      `;
    }

    /* ========= RENDER ========= */
    function card(g){
      const time = g.ts ? formatTimeSP(g.ts) : (g.raw?.time || '‚Äî:‚Äî');
      const date = g.ts ? formatDateSP(g.ts) : (g.raw?.date || '‚Äî/‚Äî/‚Äî');

      // placar s√≥ se ao vivo E tiver dado
      const showScore = !!g.live && g.score && (g.score.home !== null && g.score.away !== null);

      return `
        <article class="card">
          <div class="topline">
            <div>
              <div class="match">${g.home} x ${g.away}</div>
              <p class="sub">${g.league} ‚Ä¢ ${g.country} ‚Ä¢ ${time} <span class="tag" style="margin-left:8px">${date}</span></p>
            </div>
            ${g.live ? `<div class="badgeLive"><span class="liveDot"></span> AO VIVO</div>` : ``}
          </div>

          <div class="pillrow">
            <span class="${statusClass(g)}">${statusLabel(g)}</span>
            ${showScore ? `<span class="pill">Placar: ${g.score.home} x ${g.score.away}</span>` : ``}
          </div>

          <div class="actions">
            <button class="btn small primary" data-act="seen" data-id="${g.id}">Marcar como visto</button>
            <button class="btn small star" data-act="fav" data-id="${g.id}">
              ${state.fav.has(g.id) ? '‚òÖ Favorito' : '‚òÜ Favoritar'}
            </button>
          </div>

          ${state.showInsights ? cardInsights(g) : ``}
        </article>
      `;
    }

    function setActiveChip(tab){
      $$('.chip').forEach(x=>{
        x.classList.toggle('active', x.getAttribute('data-tab') === tab);
      });
    }

    function renderEmpty(){
      const list = $('#list');
      const tips = [
        `Voc√™ est√° no filtro <b>${state.tab === 'date' ? 'Calend√°rio' : state.tab === 'smart' ? 'Ao vivo + Pr√≥ximos' : state.tab}</b>.`,
        `Se ‚ÄúHoje‚Äù estiver vazio, o <b>arquivo pode ter jogos de ontem</b> (igual seu print).`,
        `A est√©tica/UX j√° est√° pronta; quando os dados vierem certinho, vai ficar ‚Äúapp de loja‚Äù.`
      ].join('<br>');

      list.innerHTML = `
        <div class="empty">
          Nada para mostrar agora.
          <div class="mini">${tips}</div>
          <div class="actions2">
            <button class="btn primary" id="btnAll">Ver Todos</button>
            <button class="btn" id="btnTodayQuick">Calend√°rio: Hoje</button>
          </div>
        </div>
      `;

      $('#btnAll').onclick = ()=>{
        state.tab = 'all';
        setActiveChip('all');
        render();
      };
      $('#btnTodayQuick').onclick = ()=>{
        state.tab = 'date';
        setActiveChip('date');
        ensureSelectedDate();
        state.selectedDate = todayYMD_SP();
        $('#datePick').value = state.selectedDate;
        highlightDatePills();
        render();
      };
    }

    function render(){
      const list = $('#list');
      list.innerHTML = '';

      $('#datebar').style.display = (state.tab === 'date') ? 'flex' : 'none';

      if(state.view === 'cfg'){
        list.innerHTML = `
          <div class="card">
            <div class="match" style="font-size:22px">Configura√ß√µes</div>
            <p class="sub">Em breve: alertas, ligas favoritas, notifica√ß√µes, modo PRO.</p>
            <div class="section">
              <div class="sectionHead">
                <h3>Status</h3>
                <span class="tag">v1</span>
              </div>
              <div style="color:rgba(234,244,246,.70); font-weight:850; font-size:13px; line-height:1.4">
                Rodando via GitHub Pages + GitHub Actions. Pr√≥ximo passo: API paga + endpoints de odds/√∫ltimos jogos.
              </div>
            </div>
          </div>
        `;
        return;
      }

      const games = state.games
        .filter(gameMatchesTab)
        .filter(gameMatchesView)
        .filter(gameMatchesQuery)
        .sort((a,b)=> (a.live===b.live ? (a.ts-b.ts) : (a.live?-1:1)));

      if(!games.length){
        renderEmpty();
        return;
      }

      list.innerHTML = games.map(card).join('');

      // actions
      $$('[data-act="fav"]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.getAttribute('data-id'));
          state.fav.has(id) ? state.fav.delete(id) : state.fav.add(id);
          saveLocal();
          render();
        };
      });
      $$('[data-act="seen"]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.getAttribute('data-id'));
          state.seen.add(id);
          saveLocal();
          render();
        };
      });

      // insight tabs
      $$('[data-ctab]').forEach(t=>{
        t.onclick = ()=>{
          const id = Number(t.getAttribute('data-id'));
          const tab = t.getAttribute('data-ctab');
          state.cardTab[id] = tab;
          saveLocal();
          render();
        };
      });
    }

    /* ========= LOAD ========= */
    function computeCounters(games){
      const now = Date.now()/1000;
      const today = todayYMD_SP();
      let live=0, todayCount=0, next24=0;
      for(const g of games){
        if(g.live) live++;
        if(ymdSP_from_ts(g.ts) === today) todayCount++;
        if(g.ts >= now && g.ts <= now + 24*3600) next24++;
      }
      return {live, todayCount, next24};
    }

    async function load(){
      const meta = $('#meta');
      meta.textContent = 'Carregando‚Ä¶';

      const url = `jogos.json?v=${Date.now()}`;
      const res = await fetch(url, {cache:'no-store'});
      const data = await res.json();

      state.raw = data;
      const rawGames = Array.isArray(data.games) ? data.games : [];
      state.games = rawGames.map((g,i)=>normalizeGame(g,i)).filter(g=>g.ts);

      const total = rawGames.length;
      const c = computeCounters(state.games);

      meta.innerHTML = `
        √öltima atualiza√ß√£o: <b>${data.updatedAt ?? '‚Äî'}</b> ‚Ä¢ Fonte: <b>${data.source ?? '‚Äî'}</b><br>
        Jogos no arquivo: <b>${total}</b> ‚Ä¢ Hoje: <b>${c.todayCount}</b> ‚Ä¢ Pr√≥x 24h: <b>${c.next24}</b> ‚Ä¢ Ao vivo: <b>${c.live}</b>
      `;

      render();
    }

    /* ========= UI EVENTS ========= */
    // chips
    $$('.chip').forEach(c=>{
      c.onclick = ()=>{
        state.tab = c.getAttribute('data-tab');
        setActiveChip(state.tab);
        if(state.tab === 'date'){
          ensureSelectedDate();
          $('#datePick').value = state.selectedDate;
          highlightDatePills();
        }
        render();
      };
    });

    // search
    $('#q').addEventListener('input', (e)=>{
      state.q = e.target.value || '';
      render();
    });
    $('#clear').onclick = ()=>{
      $('#q').value = '';
      state.q = '';
      render();
    };
    $('#refresh').onclick = load;

    // bottom
    $('#goGames').onclick = ()=>{
      state.view = 'games';
      setBottomActive('games');
      render();
    };
    $('#goFav').onclick = ()=>{
      state.view='fav';
      setBottomActive('fav');
      render();
    };
    $('#goHist').onclick = ()=>{
      state.view='hist';
      setBottomActive('hist');
      render();
    };

    // menu
    const modal = $('#modal');
    $('#openMenu').onclick = ()=> modal.classList.add('open');
    $('#closeMenu').onclick = ()=> modal.classList.remove('open');
    modal.onclick = (e)=>{ if(e.target === modal) modal.classList.remove('open'); };

    $$('.item[data-view]').forEach(it=>{
      it.onclick = ()=>{
        state.view = it.getAttribute('data-view');
        setBottomActive(state.view === 'fav' ? 'fav' : state.view === 'hist' ? 'hist' : 'games');
        modal.classList.remove('open');
        render();
      };
    });

    $('#cycleTheme').onclick = ()=> nextTheme();

    // insights toggle
    function syncInsightsState(){
      $('#insightsState').textContent = state.showInsights ? 'ligado' : 'desligado';
    }
    $('#toggleInsights').onclick = ()=>{
      state.showInsights = !state.showInsights;
      saveLocal();
      syncInsightsState();
      modal.classList.remove('open');
      render();
    };

    // calend√°rio
    function highlightDatePills(){
      const t = todayYMD_SP();
      const tm = tomorrowYMD_SP();
      $('#btnToday').classList.toggle('active', state.selectedDate === t);
      $('#btnTomorrow').classList.toggle('active', state.selectedDate === tm);
    }
    $('#btnToday').onclick = ()=>{
      state.selectedDate = todayYMD_SP();
      $('#datePick').value = state.selectedDate;
      highlightDatePills();
      render();
    };
    $('#btnTomorrow').onclick = ()=>{
      state.selectedDate = tomorrowYMD_SP();
      $('#datePick').value = state.selectedDate;
      highlightDatePills();
      render();
    };
    $('#dateApply').onclick = ()=>{
      const v = $('#datePick').value;
      if(v) state.selectedDate = v;
      highlightDatePills();
      render();
    };

    /* ========= BOOT ========= */
    applyTheme(localStorage.getItem('theme_key') || 'verde');
    ensureSelectedDate();
    $('#datePick').value = state.selectedDate;
    highlightDatePills();
    syncInsightsState();
    load();
  </script>
</body>
</html>
