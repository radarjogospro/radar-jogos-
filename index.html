<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Radar Jogos PRO</title>
  <meta name="theme-color" content="#071c1a" />
  <style>
    :root{
      --bg1:#061b1a;
      --bg2:#07122a;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --accent:#22c55e;
      --accent2:#10b981;
      --danger:#ef4444;
      --shadow: 0 18px 40px rgba(0,0,0,.38);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(16,185,129,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.18), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 22px 16px 110px;
    }

    /* Header */
    .top{
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:10px;
      margin-top:8px;
      margin-bottom:14px;
      position:relative;
    }
    .brand{
      font-weight: 900;
      letter-spacing:.6px;
      font-size: clamp(34px, 6vw, 54px);
      line-height:1.05;
      text-align:center;
    }
    .status{
      display:flex; align-items:center; gap:10px;
      color: var(--muted);
      font-weight: 650;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 18px rgba(34,197,94,.85);
    }

    /* Card controls */
    .panel{
      margin-top: 14px;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      backdrop-filter: blur(10px);
    }
    .row{
      display:flex; gap:10px; align-items:center;
      flex-wrap:wrap;
    }
    .search{
      flex: 1 1 260px;
      display:flex; gap:10px; align-items:center;
      padding: 12px 12px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background:transparent;
      color: var(--text);
      font-size: 15px;
    }
    .btn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 800;
      letter-spacing:.2px;
      cursor:pointer;
      user-select:none;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(16,185,129,.85));
      border-color: rgba(34,197,94,.40);
      color: #06201a;
      box-shadow: 0 10px 26px rgba(16,185,129,.28);
    }
    .btn.ghost{
      background: rgba(255,255,255,.06);
    }
    .btn.icon{
      width:46px; height:46px;
      display:grid; place-items:center;
      padding:0;
      border-radius: 16px;
      font-size: 18px;
    }

    .meta{
      margin-top: 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    /* Filters */
    .chips{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 14px;
    }
    .chip{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 800;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      background: rgba(16,185,129,.18);
      border-color: rgba(16,185,129,.40);
      box-shadow: 0 10px 26px rgba(16,185,129,.10);
    }

    /* List */
    .list{
      margin-top: 16px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .card{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      padding: 16px;
      box-shadow: 0 14px 32px rgba(0,0,0,.22);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(400px 120px at 20% 0%, rgba(16,185,129,.18), transparent 60%);
      pointer-events:none;
    }
    .card h3{
      margin:0 0 6px;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .sub{
      color: var(--muted);
      font-weight: 700;
      margin-bottom: 10px;
    }
    .badges{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-weight: 900;
      color: var(--text);
      cursor:pointer;
      user-select:none;
    }
    .badge.green{
      background: rgba(16,185,129,.18);
      border-color: rgba(16,185,129,.40);
    }
    .badge.red{
      background: rgba(239,68,68,.14);
      border-color: rgba(239,68,68,.28);
    }
    .badge.small{
      padding: 8px 10px;
      font-weight: 900;
      font-size: 13px;
    }
    .right{
      margin-left:auto;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .empty{
      color: var(--muted);
      text-align:center;
      padding: 26px 10px;
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 18px;
      background: rgba(255,255,255,.04);
    }

    /* Bottom bar */
    .bar{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: 12px 14px;
      background: linear-gradient(180deg, rgba(6,27,26,0), rgba(6,27,26,.85) 35%, rgba(6,27,26,.95));
      backdrop-filter: blur(10px);
    }
    .barInner{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      padding: 10px;
      box-shadow: 0 18px 45px rgba(0,0,0,.28);
    }
    .barBtn{
      flex: 1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 12px 10px;
      border-radius: 999px;
      border: 0;
      background: transparent;
      color: var(--text);
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    .barBtn.active{
      background: rgba(16,185,129,.18);
      border: 1px solid rgba(16,185,129,.35);
      box-shadow: 0 12px 28px rgba(16,185,129,.12);
    }

    /* Menu */
    .menuWrap{ position: relative; }
    .menu{
      position:absolute;
      right:0;
      bottom: 58px;
      width: 230px;
      background: rgba(8, 14, 32, .92);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      overflow:hidden;
      display:none;
    }
    .menu.open{display:block}
    .menu button{
      width:100%;
      text-align:left;
      padding: 13px 14px;
      border:0;
      background: transparent;
      color: var(--text);
      font-weight: 850;
      cursor:pointer;
    }
    .menu button:hover{ background: rgba(255,255,255,.06); }
    .menu .sep{
      height:1px;
      background: rgba(255,255,255,.10);
    }

    /* Modal */
    .modalBg{
      position: fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modalBg.open{display:flex}
    .modal{
      width: min(980px, 100%);
      background: rgba(8, 14, 32, .96);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      box-shadow: 0 30px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalHeader strong{ font-size: 16px; }
    .modalBody{
      padding: 14px;
      max-height: 70vh;
      overflow:auto;
    }
    .mini{
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">Radar Jogos<br/>PRO</div>
      <div class="status"><span class="dot"></span><span id="onlineTxt">Online</span></div>
    </div>

    <div class="panel">
      <div class="row">
        <div class="search">
          <input id="q" placeholder="Buscar jogo, time, liga ou pa√≠s..." autocomplete="off" />
        </div>
        <button class="btn ghost" id="clearBtn">Limpar</button>
        <button class="btn primary" id="refreshBtn">Atualizar</button>
      </div>

      <div class="meta" id="meta">
        Fonte autom√°tica di√°ria (GitHub Action). √öltima atualiza√ß√£o: ‚Äî
      </div>

      <div class="chips" id="chips"></div>
    </div>

    <div class="list" id="list"></div>
  </div>

  <!-- Bottom bar -->
  <div class="bar">
    <div class="barInner">
      <button class="barBtn active" id="tabJogos">üóìÔ∏è Jogos</button>

      <div class="menuWrap">
        <button class="barBtn" id="menuBtn">‚ãØ Menu</button>
        <div class="menu" id="menu">
          <button id="openFav">‚≠ê Favoritos</button>
          <button id="openHist">üïò Hist√≥rico</button>
          <div class="sep"></div>
          <button id="clearHist" style="color:rgba(239,68,68,.95)">üßπ Limpar hist√≥rico</button>
          <button id="clearFav" style="color:rgba(239,68,68,.95)">üóëÔ∏è Limpar favoritos</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modalBg" id="modalBg" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <strong id="modalTitle">‚Äî</strong>
        <button class="btn icon" id="closeModal">‚úï</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

<script>
(() => {
  // ======= CONFIG =======
  const DATA_URL = './jogos.json?cache=' + Date.now();
  const STORAGE_FAV = 'rj_favs_v1';
  const STORAGE_HIST = 'rj_hist_v1';

  const chipsEl = document.getElementById('chips');
  const listEl  = document.getElementById('list');
  const metaEl  = document.getElementById('meta');
  const qEl     = document.getElementById('q');
  const clearBtn = document.getElementById('clearBtn');
  const refreshBtn = document.getElementById('refreshBtn');

  const menuBtn = document.getElementById('menuBtn');
  const menuEl  = document.getElementById('menu');

  const modalBg = document.getElementById('modalBg');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  const closeModal = document.getElementById('closeModal');

  const openFav = document.getElementById('openFav');
  const openHist = document.getElementById('openHist');
  const clearHist = document.getElementById('clearHist');
  const clearFav = document.getElementById('clearFav');

  const tabJogos = document.getElementById('tabJogos');

  const state = {
    raw: [],
    view: [],
    filter: 'Todos',
    q: ''
  };

  const chipDefs = [
    { id:'Todos', label:'Todos' },
    { id:'Brasil', label:'Brasil' },
    { id:'Europa', label:'Europa' },
    { id:'Hoje', label:'Hoje' }
  ];

  const EUROPA = new Set([
    'England','Scotland','Wales','Northern Ireland','Ireland',
    'Spain','Portugal','France','Germany','Italy','Netherlands','Belgium',
    'Switzerland','Austria','Poland','Czech Republic','Slovakia','Hungary',
    'Denmark','Norway','Sweden','Finland','Iceland',
    'Greece','Turkey','Romania','Bulgaria','Serbia','Croatia','Slovenia',
    'Ukraine','Russia'
  ]);

  function safeJsonParse(v, fallback){
    try { return JSON.parse(v); } catch { return fallback; }
  }

  function loadFavs(){ return safeJsonParse(localStorage.getItem(STORAGE_FAV), []); }
  function saveFavs(arr){ localStorage.setItem(STORAGE_FAV, JSON.stringify(arr)); }

  function loadHist(){ return safeJsonParse(localStorage.getItem(STORAGE_HIST), []); }
  function saveHist(arr){ localStorage.setItem(STORAGE_HIST, JSON.stringify(arr)); }

  function gameKey(g){
    return `${g.date}|${g.time}|${g.home}|${g.away}|${g.league}|${g.country}`;
  }

  function isTodayBR(dateStr){
    // dateStr: YYYY-MM-DD in S√£o Paulo (we already generate in SP)
    const now = new Date();
    const br = new Date(now.toLocaleString('en-US', { timeZone:'America/Sao_Paulo' }));
    const y = br.getFullYear();
    const m = String(br.getMonth()+1).padStart(2,'0');
    const d = String(br.getDate()).padStart(2,'0');
    return dateStr === `${y}-${m}-${d}`;
  }

  function applyFilters(){
    const q = state.q.trim().toLowerCase();
    const f = state.filter;

    let data = [...state.raw];

    if (f === 'Brasil'){
      data = data.filter(g => (g.country || '').toLowerCase() === 'brazil');
    } else if (f === 'Europa'){
      data = data.filter(g => EUROPA.has(g.country));
    } else if (f === 'Hoje'){
      data = data.filter(g => isTodayBR(g.date));
    }

    if (q){
      data = data.filter(g => {
        const s = `${g.home} ${g.away} ${g.league} ${g.country}`.toLowerCase();
        return s.includes(q);
      });
    }

    // ordena por data + hora
    data.sort((a,b) => {
      const A = `${a.date} ${a.time}`; const B = `${b.date} ${b.time}`;
      return A.localeCompare(B);
    });

    state.view = data;
  }

  function renderChips(){
    chipsEl.innerHTML = '';
    chipDefs.forEach(c => {
      const b = document.createElement('button');
      b.className = 'chip' + (state.filter === c.id ? ' active' : '');
      b.textContent = c.label;
      b.onclick = () => {
        state.filter = c.id;
        renderChips();
        render();
      };
      chipsEl.appendChild(b);
    });
  }

  function badgeStatus(status){
    // status vem da API-Football: FT, NS, 1H, HT, 2H, AET, PEN, PST, CANC, SUSP...
    if(!status) return null;
    const st = String(status).toUpperCase();
    if (st === 'FT') return { txt:'Final', cls:'red' };
    if (st === 'NS') return { txt:'N√£o come√ßou', cls:'green' };
    if (st === 'HT') return { txt:'Intervalo', cls:'green' };
    if (st === '1H' || st === '2H' || st === 'LIVE') return { txt:'Ao vivo', cls:'green' };
    return { txt: st, cls:'green' };
  }

  function render(){
    applyFilters();

    if (!state.view.length){
      listEl.innerHTML = `<div class="empty">Nada por aqui. Tenta ‚ÄúTodos‚Äù ou limpa o filtro.</div>`;
      return;
    }

    const favs = new Set(loadFavs());
    listEl.innerHTML = '';

    state.view.forEach(g => {
      const key = gameKey(g);
      const isFav = favs.has(key);

      const card = document.createElement('div');
      card.className = 'card';

      const title = document.createElement('h3');
      title.textContent = `${g.home} x ${g.away}`;

      const sub = document.createElement('div');
      sub.className = 'sub';
      const timeTxt = (g.time || '').slice(0,5);
      sub.textContent = `Liga: ${g.league || '-'} ‚Ä¢ ${g.country || '-'} ‚Ä¢ ${timeTxt || '-'}`;

      const badges = document.createElement('div');
      badges.className = 'badges';

      const b1 = document.createElement('div');
      b1.className = 'badge green';
      b1.textContent = 'Jogo do dia';
      b1.onclick = () => addToHistory(g);

      const right = document.createElement('div');
      right.className = 'right';

      const fav = document.createElement('div');
      fav.className = 'badge small ' + (isFav ? 'green' : '');
      fav.textContent = isFav ? '‚≠ê Favorito' : '‚òÜ Favoritar';
      fav.onclick = () => toggleFav(g);

      right.appendChild(fav);

      const st = badgeStatus(g.status);
      if (st){
        const s = document.createElement('div');
        s.className = 'badge small ' + (st.cls === 'red' ? 'red' : 'green');
        s.textContent = st.txt;
        right.appendChild(s);
      }

      badges.appendChild(b1);
      badges.appendChild(right);

      card.appendChild(title);
      card.appendChild(sub);
      card.appendChild(badges);

      listEl.appendChild(card);
    });
  }

  function toggleFav(g){
    const key = gameKey(g);
    const favs = loadFavs();
    const set = new Set(favs);
    if (set.has(key)) set.delete(key);
    else set.add(key);
    saveFavs([...set]);
    render();
  }

  function addToHistory(g){
    const key = gameKey(g);
    const hist = loadHist();
    // guarda no topo, sem duplicar
    const next = [key, ...hist.filter(k => k !== key)].slice(0, 200);
    saveHist(next);
  }

  function openModal(title, itemsKeys){
    modalTitle.textContent = title;

    if (!itemsKeys.length){
      modalBody.innerHTML = `<div class="empty">Nada por aqui ainda.</div>`;
    } else {
      // monta um mapa das partidas atuais para ‚Äúreviver‚Äù os dados
      const map = new Map(state.raw.map(g => [gameKey(g), g]));
      const rows = itemsKeys.map(k => map.get(k)).filter(Boolean);

      if (!rows.length){
        modalBody.innerHTML = `<div class="empty">Esses itens n√£o est√£o na lista atual (pode ser outro dia).</div>`;
      } else {
        const html = rows.map(g => {
          const timeTxt = (g.time || '').slice(0,5);
          const st = badgeStatus(g.status);
          const stHtml = st ? `<span class="badge small ${st.cls === 'red' ? 'red' : 'green'}">${st.txt}</span>` : '';
          return `
            <div class="card" style="margin-bottom:12px">
              <h3 style="margin:0 0 6px">${g.home} x ${g.away}</h3>
              <div class="sub">Liga: ${g.league || '-'} ‚Ä¢ ${g.country || '-'} ‚Ä¢ ${timeTxt || '-'}</div>
              <div class="badges">
                <span class="badge small green" data-action="fav" data-key="${encodeURIComponent(gameKey(g))}">‚≠ê Alternar favorito</span>
                ${stHtml}
              </div>
            </div>
          `;
        }).join('');
        modalBody.innerHTML = html;

        modalBody.querySelectorAll('[data-action="fav"]').forEach(btn => {
          btn.addEventListener('click', () => {
            const key = decodeURIComponent(btn.getAttribute('data-key'));
            const g = map.get(key);
            if (g) toggleFav(g);
          });
        });
      }
    }

    modalBg.classList.add('open');
    modalBg.setAttribute('aria-hidden', 'false');
  }

  function closeModalNow(){
    modalBg.classList.remove('open');
    modalBg.setAttribute('aria-hidden', 'true');
  }

  function closeMenu(){
    menuEl.classList.remove('open');
  }

  async function loadData(){
    refreshBtn.textContent = 'Atualizando‚Ä¶';
    refreshBtn.disabled = true;

    try{
      const res = await fetch(DATA_URL, { cache: 'no-store' });
      if(!res.ok) throw new Error('Falha ao carregar jogos.json');
      const data = await res.json();

      const updatedAt = data.updatedAt || '-';
      const source = data.source || '-';
      const total = (data.games || []).length;

      metaEl.textContent = `Fonte autom√°tica di√°ria (GitHub Action). √öltima atualiza√ß√£o: ${updatedAt} ‚Ä¢ Fonte: ${source} ‚Ä¢ Jogos: ${total}`;

      state.raw = (data.games || []).map(g => ({
        home: g.home || '',
        away: g.away || '',
        league: g.league || '',
        country: g.country || '',
        date: g.date || '',
        time: g.time || '',
        status: g.status || ''
      }));

      renderChips();
      render();
    } catch(e){
      metaEl.textContent = 'Erro ao carregar dados. Tenta novamente.';
      listEl.innerHTML = `<div class="empty">N√£o consegui carregar <b>jogos.json</b>. Verifica se o Action rodou e se o arquivo existe.</div>`;
      console.error(e);
    } finally {
      refreshBtn.textContent = 'Atualizar';
      refreshBtn.disabled = false;
    }
  }

  // ======= Events =======
  qEl.addEventListener('input', () => {
    state.q = qEl.value;
    render();
  });

  clearBtn.addEventListener('click', () => {
    qEl.value = '';
    state.q = '';
    state.filter = 'Todos';
    renderChips();
    render();
  });

  refreshBtn.addEventListener('click', () => loadData());

  menuBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    menuEl.classList.toggle('open');
  });

  document.addEventListener('click', () => closeMenu());

  openFav.addEventListener('click', () => {
    closeMenu();
    openModal('‚≠ê Favoritos', loadFavs());
  });

  openHist.addEventListener('click', () => {
    closeMenu();
    openModal('üïò Hist√≥rico', loadHist());
  });

  clearHist.addEventListener('click', () => {
    closeMenu();
    localStorage.removeItem(STORAGE_HIST);
    openModal('üïò Hist√≥rico', []);
  });

  clearFav.addEventListener('click', () => {
    closeMenu();
    localStorage.removeItem(STORAGE_FAV);
    openModal('‚≠ê Favoritos', []);
    render();
  });

  closeModal.addEventListener('click', closeModalNow);
  modalBg.addEventListener('click', (e) => {
    if (e.target === modalBg) closeModalNow();
  });

  tabJogos.addEventListener('click', () => {
    // aqui √© s√≥ ‚Äúvoltar‚Äù pra tela principal (a lista j√° est√° na tela)
    closeMenu();
    closeModalNow();
    tabJogos.classList.add('active');
  });

  // start
  renderChips();
  loadData();
})();
</script>
</body>
</html>
