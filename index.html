<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Radar Jogos PRO</title>
  <style>
    :root{
      --bg:#06141b;
      --bg2:#05352f;
      --card:#0b232d;
      --card2:#0a1b23;
      --stroke:rgba(255,255,255,.08);
      --text:#eaf4f6;
      --muted:rgba(234,244,246,.68);
      --muted2:rgba(234,244,246,.52);
      --accent:#22d48a;
      --accent2:#12b976;
      --danger:#b85a5a;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 50% -120px, rgba(34,212,138,.35), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      min-height:100vh;
    }
    .wrap{max-width: 820px; margin:0 auto; padding: 14px 14px 120px;}
    .topbar{
      position: sticky;
      top:0;
      z-index: 50;
      padding: 12px 0 10px;
      background: linear-gradient(180deg, rgba(5,53,47,.78), rgba(6,20,27,.18));
      backdrop-filter: blur(12px);
    }
    .brand{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 10px 12px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .brand .title{display:flex; flex-direction:column; gap:2px; line-height:1.05;}
    .brand h1{margin:0; font-size: 20px; letter-spacing:.2px;}
    .status{display:flex; align-items:center; gap:10px; font-weight: 800; font-size: 13px; color: var(--muted);}
    .dot{width:10px; height:10px; border-radius:50%; background: var(--accent); box-shadow: 0 0 0 6px rgba(34,212,138,.14);}
    .quick{display:flex; gap:10px; align-items:center;}
    .iconBtn{
      border:none; cursor:pointer; padding: 10px 12px; border-radius: 14px;
      background: rgba(255,255,255,.06); color: var(--text); font-weight: 900; border:1px solid var(--stroke);
      user-select:none;
    }

    .panel{
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(11,35,45,.78), rgba(10,27,35,.60));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      position: relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(500px 180px at 15% 0%, rgba(34,212,138,.20), transparent 60%),
        radial-gradient(420px 160px at 90% 10%, rgba(255,255,255,.08), transparent 55%);
      pointer-events:none;
    }
    .panel > *{position:relative; z-index:1;}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .search{
      flex:1; min-width: 210px;
      padding: 14px 14px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.20);
      color: var(--text);
      outline: none;
      font-size: 15px;
    }
    .btn{
      padding: 12px 14px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      border:none;
      color:#062019;
      box-shadow: 0 12px 30px rgba(34,212,138,.18);
    }
    .meta{
      margin-top: 10px;
      color: var(--muted);
      line-height: 1.35;
      font-weight: 750;
      font-size: 13px;
    }

    .chips{margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap}
    .chip{
      padding: 10px 13px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      font-size: 13px;
      display:flex; align-items:center; gap:8px;
    }
    .chip.active{
      border-color: rgba(34,212,138,.35);
      background: rgba(34,212,138,.12);
    }

    .hint{
      margin-top: 10px;
      color: var(--muted2);
      font-weight: 700;
      font-size: 12px;
      line-height: 1.35;
    }

    .datebar{
      margin-top: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      border:1px solid rgba(255,255,255,.07);
      background: rgba(0,0,0,.12);
      padding: 12px;
      border-radius: 18px;
    }
    .datebar .left{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color: rgba(234,244,246,.82);
      font-weight: 900;
      font-size: 13px;
    }
    .datepill{
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      font-size: 12px;
    }
    .datepill.active{
      border-color: rgba(34,212,138,.35);
      background: rgba(34,212,138,.12);
    }
    .datebar .right{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .dateinput{
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 900;
      outline:none;
    }

    .list{margin-top: 14px; display:flex; flex-direction:column; gap:12px;}

    /* Card premium com ‚Äúhero‚Äù de futebol sem imagens externas */
    .card{
      border-radius: 26px;
      border:1px solid var(--stroke);
      background:
        radial-gradient(900px 280px at 15% -30%, rgba(34,212,138,.25), transparent 55%),
        radial-gradient(700px 250px at 90% 0%, rgba(255,255,255,.07), transparent 55%),
        linear-gradient(180deg, rgba(11,35,45,.90), rgba(10,27,35,.74));
      box-shadow: 0 16px 55px rgba(0,0,0,.33);
      padding: 16px;
      position:relative;
      overflow:hidden;
    }
    .card::after{
      content:"";
      position:absolute;
      right:-70px; top:-70px;
      width: 220px; height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.15), rgba(255,255,255,.03) 60%, transparent 70%);
      border: 1px solid rgba(255,255,255,.06);
      transform: rotate(18deg);
      pointer-events:none;
    }

    .match{
      font-size: 26px;
      font-weight: 950;
      line-height: 1.05;
      margin: 0 0 8px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-weight: 800;
      font-size: 14px;
    }
    .pills{display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; align-items:center}
    .pill{
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      font-weight: 950;
      font-size: 12px;
    }
    .pill.live{border-color: rgba(34,212,138,.35); background: rgba(34,212,138,.12)}
    .pill.final{border-color: rgba(184,90,90,.32); background: rgba(184,90,90,.14)}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px;}
    .btn.small{padding: 11px 14px; border-radius: 14px; font-weight: 950; font-size: 13px}
    .btn.star{display:flex; align-items:center; gap:8px}
    .section{
      margin-top: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.07);
      background: rgba(0,0,0,.14);
      padding: 12px;
    }
    .section h3{
      margin:0 0 10px;
      font-size: 13px;
      letter-spacing:.3px;
      color: rgba(234,244,246,.86);
      text-transform: uppercase;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 8px 12px;
      align-items:center;
      font-weight: 900;
      color: rgba(234,244,246,.82);
      font-size: 13px;
    }
    .grid .mut{color: rgba(234,244,246,.62)}
    .empty{
      text-align:center;
      padding: 22px 12px;
      color: rgba(234,244,246,.72);
      font-weight: 900;
      border:1px dashed rgba(255,255,255,.14);
      border-radius: 22px;
      background: rgba(0,0,0,.10);
    }

    /* Bottom Nav */
    .bottom{
      position: fixed;
      left:0; right:0; bottom: 12px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index: 60;
    }
    .bottom .bar{
      width: min(820px, calc(100% - 24px));
      display:flex; gap: 10px;
      background: rgba(8,22,28,.62);
      border: 1px solid var(--stroke);
      border-radius: 24px;
      padding: 10px;
      backdrop-filter: blur(12px);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      pointer-events:auto;
    }
    .bigbtn{
      flex:1;
      border-radius: 20px;
      padding: 14px 14px;
      font-weight: 950;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      display:flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer;
      user-select:none;
      font-size: 14px;
      opacity:.92;
    }
    .bigbtn.active{
      background: linear-gradient(180deg, rgba(34,212,138,.95), rgba(18,185,118,.92));
      color:#062019;
      border:none;
      opacity:1;
      box-shadow: 0 12px 30px rgba(34,212,138,.16);
    }

    /* Modal Sheet */
    .modal{
      position: fixed; inset:0;
      background: rgba(0,0,0,.50);
      display:none;
      align-items: flex-end;
      justify-content:center;
      padding: 14px;
      z-index: 999;
    }
    .modal.open{display:flex;}
    .sheet{
      width: min(820px, 100%);
      background: rgba(10,27,35,.94);
      border:1px solid var(--stroke);
      border-radius: 26px;
      box-shadow: 0 22px 80px rgba(0,0,0,.55);
      padding: 14px;
      backdrop-filter: blur(14px);
    }
    .sheet h2{margin: 6px 6px 12px; font-size: 16px; letter-spacing:.2px;}
    .item{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      padding: 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
      margin: 10px 0;
      font-size: 14px;
    }
    .item .right{color: rgba(234,244,246,.55); font-weight: 900}
    .close{
      margin-top: 10px;
      width:100%;
      padding: 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
    }
    .tag{
      font-weight: 950;
      padding: 5px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      font-size: 11px;
      color: rgba(234,244,246,.78);
    }
    .tag.live{border-color: rgba(34,212,138,.35); background: rgba(34,212,138,.12); color: rgba(234,244,246,.88)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="title">
          <h1>Radar Jogos PRO</h1>
          <div class="status"><span class="dot"></span> Online</div>
        </div>
        <div class="quick">
          <button class="iconBtn" id="openMenu">‚Ä¶ Menu</button>
        </div>
      </div>
    </div>

    <section class="panel">
      <div class="row">
        <input id="q" class="search" placeholder="Buscar time, liga ou pa√≠s..." />
        <button id="clear" class="btn">Limpar</button>
        <button id="refresh" class="btn primary">Atualizar</button>
      </div>

      <div id="meta" class="meta">Carregando‚Ä¶</div>

      <div class="chips">
        <div class="chip active" data-tab="smart">‚ö° Ao vivo + Pr√≥ximos</div>
        <div class="chip" data-tab="live">üî¥ Ao vivo</div>
        <div class="chip" data-tab="date">üìÖ Calend√°rio</div>
        <div class="chip" data-tab="br">üáßüá∑ Brasil</div>
        <div class="chip" data-tab="eu">üá™üá∫ Europa</div>
        <div class="chip" data-tab="all">üåç Todos</div>
      </div>

      <div id="datebar" class="datebar" style="display:none;">
        <div class="left">
          <span class="tag">Data</span>
          <button class="datepill" id="btnToday">Hoje</button>
          <button class="datepill" id="btnTomorrow">Amanh√£</button>
        </div>
        <div class="right">
          <input class="dateinput" id="datePick" type="date" />
          <button class="btn" id="dateApply">Aplicar</button>
        </div>
      </div>

      <div class="hint">
        * Odds/probabilidades s√£o estimativas com base nos √∫ltimos 3 jogos quando dispon√≠vel. No FREE, a API limita e nem todos os jogos recebem c√°lculo.
      </div>
    </section>

    <section id="list" class="list"></section>
  </div>

  <div class="bottom">
    <div class="bar">
      <button class="bigbtn active" id="goGames">üóìÔ∏è Jogos</button>
      <button class="bigbtn" id="goFav">‚òÖ Favoritos</button>
      <button class="bigbtn" id="goHist">‚è±Ô∏è Hist√≥rico</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <h2>Menu</h2>
      <button class="item" data-view="games"><span>Jogos</span><span class="right">principal</span></button>
      <button class="item" data-view="fav"><span>Favoritos</span><span class="right">salvos</span></button>
      <button class="item" data-view="hist"><span>Hist√≥rico</span><span class="right">vistos</span></button>
      <button class="item" data-view="cfg"><span>Configura√ß√µes</span><span class="right">em breve</span></button>
      <button class="close" id="closeMenu">Fechar</button>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    const state = {
      data: null,
      tab: 'smart',     // smart | live | date | br | eu | all
      view: 'games',    // games | fav | hist | cfg
      q: '',
      selectedDate: null, // YYYY-MM-DD (SP)
      fav: new Set(JSON.parse(localStorage.getItem('fav_ids')||'[]')),
      seen: new Set(JSON.parse(localStorage.getItem('seen_ids')||'[]')),
    };

    function saveLocal(){
      localStorage.setItem('fav_ids', JSON.stringify(Array.from(state.fav)));
      localStorage.setItem('seen_ids', JSON.stringify(Array.from(state.seen)));
    }

    function setBottomActive(which){
      $('#goGames').classList.toggle('active', which==='games');
      $('#goFav').classList.toggle('active', which==='fav');
      $('#goHist').classList.toggle('active', which==='hist');
    }

    function normalize(s){
      return (s||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');
    }

    function isEurope(country){
      const c = normalize(country);
      return ['england','spain','italy','germany','france','portugal','netherlands','belgium','turkey','greece','scotland','wales','ireland','sweden','norway','denmark','finland','austria','switzerland','poland','czech','croatia','serbia','ukraine','romania','bulgaria','hungary']
        .some(k=>c.includes(k));
    }

    function formatTimeSP(ts){
      return new Intl.DateTimeFormat('pt-BR', {
        timeZone: 'America/Sao_Paulo',
        hour: '2-digit',
        minute: '2-digit'
      }).format(new Date(ts*1000));
    }

    function formatDateSP(ts){
      return new Intl.DateTimeFormat('pt-BR', {
        timeZone: 'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(new Date(ts*1000));
    }

    function ymdSP_from_ts(ts){
      const d = new Date(ts*1000);
      return new Intl.DateTimeFormat('en-CA', {
        timeZone:'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(d);
    }

    function todayYMD_SP(){
      const d = new Date();
      return new Intl.DateTimeFormat('en-CA', {
        timeZone:'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(d);
    }

    function tomorrowYMD_SP(){
      const d = new Date(Date.now() + 24*3600*1000);
      return new Intl.DateTimeFormat('en-CA', {
        timeZone:'America/Sao_Paulo',
        year:'numeric', month:'2-digit', day:'2-digit'
      }).format(d);
    }

    function ensureSelectedDate(){
      if(!state.selectedDate) state.selectedDate = todayYMD_SP();
    }

    function gameMatchesQuery(g){
      const q = normalize(state.q);
      if(!q) return true;
      const text = normalize(`${g.home} ${g.away} ${g.league} ${g.country}`);
      return text.includes(q);
    }

    function gameMatchesView(g){
      if(state.view === 'games') return true;
      if(state.view === 'fav') return state.fav.has(g.id);
      if(state.view === 'hist') return state.seen.has(g.id);
      return false;
    }

    // FILTROS PRINCIPAIS (ajustados pra n√£o ficar vazio)
    function gameMatchesTab(g){
      if(state.tab === 'all') return true;
      if(state.tab === 'br') return normalize(g.country).includes('brazil');
      if(state.tab === 'eu') return isEurope(g.country);
      if(state.tab === 'live') return !!g.live;

      // calend√°rio: s√≥ mostra a data escolhida (SP)
      if(state.tab === 'date'){
        ensureSelectedDate();
        return ymdSP_from_ts(g.ts) === state.selectedDate;
      }

      // smart: ao vivo + pr√≥ximos 36h + √∫ltimos 6h (evita tela vazia)
      if(state.tab === 'smart'){
        const now = Date.now()/1000;
        const withinPast = (g.ts >= (now - (6*3600)));
        const withinFuture = (g.ts <= (now + (36*3600)));
        // esconde jogos MUITO antigos finalizados
        const isOldFinal = (g.ts < (now - (6*3600))) && (g.status === 'FT' || g.status === 'AET' || g.status === 'PEN');
        return (g.live || (withinPast && withinFuture)) && !isOldFinal;
      }

      return true;
    }

    function statusLabel(g){
      if(g.live) return 'Ao vivo';
      if(g.status === 'FT' || g.status === 'AET' || g.status === 'PEN') return 'Final';
      if(g.status === 'NS') return 'N√£o iniciado';
      if(g.status) return g.status;
      return 'Agendado';
    }

    function statusClass(g){
      if(g.live) return 'pill live';
      if(g.status === 'FT' || g.status === 'AET' || g.status === 'PEN') return 'pill final';
      return 'pill';
    }

    function oddsRow(label, obj){
      if(!obj) return `<div class="mut">${label}</div><div>‚Äî% ‚Ä¢ odd ‚Äî</div>`;
      return `<div class="mut">${label}</div><div>${obj.p}% ‚Ä¢ odd ${obj.odd}</div>`;
    }

    function card(g){
      const time = formatTimeSP(g.ts);
      const date = formatDateSP(g.ts);

      // placar S√ì quando ao vivo (como voc√™ pediu)
      const showScore = !!g.live && g.score && (g.score.home !== null && g.score.away !== null);
      const probs = g.probs || null;

      return `
        <article class="card">
          <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
            <div>
              <div class="match">${g.home} x ${g.away}</div>
              <p class="sub">${g.league} ‚Ä¢ ${g.country} ‚Ä¢ ${time} <span class="tag" style="margin-left:8px">${date}</span></p>
            </div>
            ${g.live ? `<span class="tag live">LIVE</span>` : ``}
          </div>

          <div class="pills">
            <span class="${statusClass(g)}">${statusLabel(g)}</span>
            ${showScore ? `<span class="pill">Placar: ${g.score.home} x ${g.score.away}</span>` : ``}
          </div>

          <div class="actions">
            <button class="btn small primary" data-act="seen" data-id="${g.id}">Marcar como visto</button>
            <button class="btn small star" data-act="fav" data-id="${g.id}">
              ${state.fav.has(g.id) ? '‚òÖ Favorito' : '‚òÜ Favoritar'}
            </button>
          </div>

          <div class="section">
            <h3>Probabilidades (estimativas)</h3>
            <div class="grid">
              ${oddsRow('Over 1,5', probs?.over15)}
              ${oddsRow('Over 2,5', probs?.over25)}
              ${oddsRow('Under 1,5', probs?.under15)}
              ${oddsRow('Under 2,5', probs?.under25)}
            </div>
          </div>
        </article>
      `;
    }

    function render(){
      const list = $('#list');
      list.innerHTML = '';

      // barra do calend√°rio s√≥ no tab date
      $('#datebar').style.display = (state.tab === 'date') ? 'flex' : 'none';

      if(state.view === 'cfg'){
        list.innerHTML = `
          <div class="card">
            <div class="match" style="font-size:22px">Configura√ß√µes</div>
            <p class="sub">Em breve: alertas, ligas favoritas, notifica√ß√µes, modo PRO.</p>
            <div class="section">
              <h3>Status</h3>
              <div style="color:rgba(234,244,246,.70); font-weight:850; font-size:13px; line-height:1.4">
                Rodando via GitHub Pages + GitHub Actions. Pr√≥ximo passo: API paga + mais c√°lculos.
              </div>
            </div>
          </div>
        `;
        return;
      }

      const games = (state.data?.games || [])
        .filter(gameMatchesTab)
        .filter(gameMatchesView)
        .filter(gameMatchesQuery)
        .sort((a,b)=> (a.live===b.live ? (a.ts-b.ts) : (a.live?-1:1)));

      if(!games.length){
        // mensagem mais clara e "inteligente"
        if(state.tab === 'date'){
          list.innerHTML = `<div class="empty">Sem jogos para <b>${state.selectedDate}</b>. Tente ‚ÄúHoje‚Äù, ‚ÄúAmanh√£‚Äù ou outro dia.</div>`;
        } else {
          list.innerHTML = `<div class="empty">Nada para mostrar agora. Troque o filtro para ‚ÄúCalend√°rio‚Äù ou ‚ÄúTodos‚Äù.</div>`;
        }
        return;
      }

      list.innerHTML = games.map(card).join('');

      $$('[data-act="fav"]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.getAttribute('data-id'));
          state.fav.has(id) ? state.fav.delete(id) : state.fav.add(id);
          saveLocal();
          render();
        };
      });
      $$('[data-act="seen"]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.getAttribute('data-id'));
          state.seen.add(id);
          saveLocal();
          render();
        };
      });
    }

    async function load(){
      const meta = $('#meta');
      meta.textContent = 'Carregando‚Ä¶';
      const url = `jogos.json?v=${Date.now()}`;
      const res = await fetch(url, {cache:'no-store'});
      const data = await res.json();
      state.data = data;

      const total = (data.games?.length ?? data.counts?.games ?? 0);
      const prob = (data.counts?.probGames ?? 0);

      meta.innerHTML = `
        √öltima atualiza√ß√£o: <b>${data.updatedAt}</b> ‚Ä¢ Fonte: <b>${data.source}</b> ‚Ä¢
        Jogos no arquivo: <b>${total}</b> ‚Ä¢ Odds calculadas: <b>${prob}</b>
      `;
      render();
    }

    // chips
    $$('.chip').forEach(c=>{
      c.onclick = ()=>{
        $$('.chip').forEach(x=>x.classList.remove('active'));
        c.classList.add('active');
        state.tab = c.getAttribute('data-tab');

        // se entrar no calend√°rio, inicializa data
        if(state.tab === 'date'){
          ensureSelectedDate();
          $('#datePick').value = state.selectedDate;
          highlightDatePills();
        }

        render();
      };
    });

    // search
    $('#q').addEventListener('input', (e)=>{
      state.q = e.target.value || '';
      render();
    });
    $('#clear').onclick = ()=>{
      $('#q').value = '';
      state.q = '';
      render();
    };
    $('#refresh').onclick = load;

    // bottom nav (agora faz sentido)
    $('#goGames').onclick = ()=>{
      state.view = 'games';
      setBottomActive('games');

      // se j√° est√° em jogos, abre o calend√°rio r√°pido (app-like)
      if(state.tab !== 'date'){
        // mant√©m smart como padr√£o, mas se voc√™ quiser sempre abrir calend√°rio:
        // state.tab = 'date';
        // ativa o chip "Calend√°rio" visualmente:
        // $$('.chip').forEach(x=>x.classList.toggle('active', x.getAttribute('data-tab')==='date'));
      }
      render();
    };
    $('#goFav').onclick = ()=>{
      state.view='fav';
      setBottomActive('fav');
      render();
    };
    $('#goHist').onclick = ()=>{
      state.view='hist';
      setBottomActive('hist');
      render();
    };

    // menu
    const modal = $('#modal');
    $('#openMenu').onclick = ()=> modal.classList.add('open');
    $('#closeMenu').onclick = ()=> modal.classList.remove('open');
    modal.onclick = (e)=>{ if(e.target === modal) modal.classList.remove('open'); };

    $$('.item').forEach(it=>{
      it.onclick = ()=>{
        state.view = it.getAttribute('data-view');
        setBottomActive(state.view === 'fav' ? 'fav' : state.view === 'hist' ? 'hist' : 'games');
        modal.classList.remove('open');
        render();
      };
    });

    // calend√°rio
    function highlightDatePills(){
      const t = todayYMD_SP();
      const tm = tomorrowYMD_SP();
      $('#btnToday').classList.toggle('active', state.selectedDate === t);
      $('#btnTomorrow').classList.toggle('active', state.selectedDate === tm);
    }

    $('#btnToday').onclick = ()=>{
      state.selectedDate = todayYMD_SP();
      $('#datePick').value = state.selectedDate;
      highlightDatePills();
      render();
    };
    $('#btnTomorrow').onclick = ()=>{
      state.selectedDate = tomorrowYMD_SP();
      $('#datePick').value = state.selectedDate;
      highlightDatePills();
      render();
    };
    $('#dateApply').onclick = ()=>{
      const v = $('#datePick').value;
      if(v) state.selectedDate = v;
      highlightDatePills();
      render();
    };

    // boot
    ensureSelectedDate();
    $('#datePick').value = state.selectedDate;
    highlightDatePills();
    load();
  </script>
</body>
</html>
