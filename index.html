<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#06131a" />
  <title>Radar Jogos PRO</title>

  <style>
    :root{
      --bg0:#06131a;
      --bg1:#071a23;

      --cardStroke: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);

      --accent:#22c55e;
      --cyan:#22d3ee;
      --danger:#ff4d4d;
      --pink:#ff2d7a;
      --shadow: 0 18px 55px rgba(0,0,0,.55);

      --r1: 22px;
      --r2: 16px;
      --r3: 14px;

      /* ‚úÖ tipografia menor (app todo) */
      --fsTitle: 15px;
      --fsSub: 12px;
      --fsBody: 13px;
      --fsTeams: 15px;
      --fsMeta: 12px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 30% -20%, rgba(34,211,238,.12), transparent 60%),
        radial-gradient(900px 520px at 90% 10%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      overflow-x:hidden;
    }

    .wrap{ max-width:780px; margin:0 auto; padding:14px 12px 92px; }

    .surface{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--cardStroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    /* ‚úÖ Appbar N√ÉO dan√ßa: sticky sem ‚Äútop:10px‚Äù grande, com altura est√°vel */
    .appbar{
      position: sticky;
      top: 0;
      z-index: 30;
      border-radius: var(--r1);
      padding: 10px 10px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;

      /* evita cobrir conte√∫do quando cola no topo */
      margin-top: 10px;
    }

    .logo{ display:flex; align-items:center; gap:10px; min-width:0; }
    .mark{
      width:34px; height:34px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(34,211,238,.20), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:center;
      font-weight: 950;
      letter-spacing:.3px;
      flex:0 0 auto;
    }
    .brand{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .brand .title{
      font-weight: 950;
      font-size: var(--fsTitle);
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      line-height: 1.1;
      max-width: 220px; /* ‚úÖ impede cortar feio */
    }
    .brand .sub{
      display:flex; align-items:center; gap:8px;
      color: var(--muted);
      font-weight: 850;
      font-size: var(--fsSub);
      white-space:nowrap;
    }
    .dot{
      width:9px; height:9px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(34,197,94,.10);
      flex:0 0 auto;
    }

    .appbarRight{ display:flex; align-items:center; gap:8px; }
    .iconBtn{
      width:36px; height:36px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.86);
      font-weight: 950;
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      position: relative;
    }
    .badge{
      position:absolute;
      right:-2px; top:-2px;
      width:10px; height:10px; border-radius:999px;
      background: var(--danger);
      box-shadow: 0 0 0 6px rgba(255,77,77,.12);
      border: 1px solid rgba(0,0,0,.25);
    }
    .pillMoney{
      display:flex; align-items:center; gap:10px;
      padding: 8px 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight: 950;
      white-space:nowrap;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      font-size: var(--fsBody);
    }
    .pillMoney small{ color: var(--muted); font-weight: 850; }

    .cta{
      padding: 9px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,45,122,.40);
      background: linear-gradient(180deg, rgba(255,45,122,.42), rgba(255,45,122,.22));
      color: rgba(255,255,255,.95);
      font-weight: 950;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      white-space:nowrap;
      font-size: var(--fsBody);
    }
    .cta:active, .iconBtn:active, .pillMoney:active{ transform: scale(.98); }

    /* Sports tabs */
    .sportsRow{
      margin-top: 12px;
      display:flex; gap:12px;
      align-items:center;
      overflow:auto;
      padding: 6px 2px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .sportsRow::-webkit-scrollbar{ display:none; }
    .sportTab{
      display:flex; flex-direction:column; align-items:center; gap:6px;
      min-width: 66px;
      color: rgba(255,255,255,.72);
      font-weight: 900;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-size: var(--fsBody);
    }
    .sportIcon{
      width:42px; height:42px; border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:flex; align-items:center; justify-content:center;
      font-size: 18px;
    }
    .sportTab.active{ color: rgba(255,255,255,.94); }
    .sportTab.active .sportIcon{
      border-color: rgba(34,211,238,.35);
      background: linear-gradient(180deg, rgba(34,211,238,.14), rgba(255,255,255,.03));
    }

    /* Filters card */
    .filters{ margin-top: 10px; border-radius: var(--r1); padding: 12px; }

    .filterRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .chip{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight: 950;
      font-size: var(--fsBody);
      color: rgba(255,255,255,.86);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      display:flex; align-items:center; gap:10px;
      white-space:nowrap;
    }
    .chip .miniDot{ width:10px; height:10px; border-radius:999px; background: rgba(255,255,255,.22); }
    .chip.active{
      border-color: rgba(34,211,238,.35);
      background: linear-gradient(180deg, rgba(34,211,238,.14), rgba(255,255,255,.03));
    }
    .chip.active .miniDot{ background: var(--cyan); }

    .searchWrap{ margin-top: 10px; display:flex; gap:10px; align-items:center; }
    .search{
      flex: 1 1 auto;
      display:flex;
      padding: 10px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }
    .search input{
      width:100%; border:0; outline:none;
      background: transparent;
      color: var(--text);
      font-size: var(--fsBody);
      font-weight: 800;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 16px;
      font-weight: 950;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      white-space:nowrap;
      font-size: var(--fsBody);
    }
    .btn.primary{
      border-color: rgba(34,197,94,.35);
      background: linear-gradient(180deg, rgba(34,197,94,.22), rgba(255,255,255,.03));
    }
    .btn:active{ transform: scale(.98); }

    .meta{
      margin-top: 10px;
      color: var(--muted);
      font-size: var(--fsMeta);
      font-weight: 850;
      line-height: 1.35;
    }

    .sortRow{
      margin-top: 10px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      color: var(--muted);
      font-weight: 900;
      font-size: var(--fsBody);
    }
    .sortBtn{
      display:flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      color: rgba(255,255,255,.78);
      font-weight: 950;
      flex: 1 1 auto;
      min-width: 170px;
    }
    .sortBtn b{ color: rgba(255,255,255,.92); }
    .sortBtn:active{ transform: scale(.98); }

    .sortRow .right{ display:flex; align-items:center; gap:8px; }

    /* List / sections */
    .list{ margin-top: 12px; display:flex; flex-direction:column; gap: 12px; }
    .section{
      border-radius: var(--r1);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.015));
    }
    .sectionHead{
      padding: 12px 12px;
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      background: rgba(0,0,0,.10);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .leagueLeft{ display:flex; align-items:center; gap:10px; min-width:0; }
    .flag{
      width:26px; height:26px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      display:flex; align-items:center; justify-content:center;
      font-size: 14px;
      flex:0 0 auto;
    }
    .leagueName{
      font-weight: 950;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size: var(--fsBody);
    }
    .caret{
      opacity:.75;
      font-weight: 950;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      flex:0 0 auto;
    }
    .sectionBody{ padding: 10px 10px 12px; display:grid; gap:10px; }
    .sectionBody.closed{ display:none; }

    /* Match card */
    .match{
      border-radius: var(--r1);
      background: linear-gradient(180deg, rgba(11,36,48,.92), rgba(10,33,44,.92));
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .matchTop{
      padding: 12px 12px 10px;
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:12px;
    }
    .teams{ min-width:0; }
    .teamRow{
      display:flex; align-items:center; gap:10px;
      font-weight: 950;
      font-size: var(--fsTeams);
      line-height: 1.15;
    }

    /* ‚úÖ Sem escudo: bola */
    .crest{
      width:22px; height:22px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      flex:0 0 auto;
      display:flex; align-items:center; justify-content:center;
      font-size: 14px;
      color: rgba(255,255,255,.85);
    }

    .teamRow span{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .metaRight{
      display:flex; flex-direction:column; align-items:flex-end;
      gap:8px;
      min-width: 92px;
    }
    .timeTxt{
      color: rgba(255,255,255,.82);
      font-weight: 950;
      font-size: var(--fsBody);
    }
    .livePill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,77,77,.35);
      background: rgba(255,77,77,.12);
      font-weight: 950;
      font-size: 12px;
      letter-spacing:.3px;
      white-space:nowrap;
    }
    .ldot{
      width:10px; height:10px; border-radius:999px;
      background: var(--danger);
      box-shadow: 0 0 0 6px rgba(255,77,77,.10);
    }
    .scoreLine{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 7px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      font-weight: 950;
      font-size: 13px;
      white-space:nowrap;
    }
    .scoreLine .min{ color: rgba(255,255,255,.78); font-weight: 900; }

    .oddsRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      border-top: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.08);
    }
    .odd{
      padding: 10px 10px;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      border-right: 1px solid rgba(255,255,255,.06);
      font-weight: 950;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-size: var(--fsBody);
    }
    .odd:last-child{ border-right: 0; }
    .odd small{ color: var(--muted); font-weight: 900; }
    .odd b{ color: rgba(34,211,238,.90); letter-spacing:.2px; }

    .actions{
      padding: 10px 12px 12px;
      display:flex; gap:10px; flex-wrap:wrap;
      border-top: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.04);
    }
    .actions .btn{ flex: 1 1 140px; text-align:center; }

    .detailsWrap{ display:none; }
    .detailsWrap.open{ display:block; }
    .detailsInner{
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.06);
      color: var(--muted);
      font-weight: 800;
      font-size: var(--fsBody);
      line-height: 1.35;
    }
    .grid2{
      display:grid; grid-template-columns: 1fr 1fr;
      gap:10px; margin-top: 10px;
    }
    .kv{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.78);
      font-weight: 900;
    }
    .kv b{ color: rgba(255,255,255,.92); }

    .empty{
      padding: 16px;
      border-radius: var(--r1);
      border: 1px dashed rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      color: var(--muted);
      text-align:center;
      font-weight: 950;
      font-size: var(--fsBody);
    }

    .bottomNav{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      width: min(780px, calc(100% - 24px));
      padding: 10px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.42);
      backdrop-filter: blur(14px);
      display:flex; gap:10px;
      box-shadow: var(--shadow);
      z-index: 40;
    }
    .navBtn{
      flex: 1 1 0;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.86);
      font-weight: 950;
      display:flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer; user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-size: var(--fsBody);
    }
    .navBtn.active{
      border-color: rgba(34,211,238,.35);
      background: linear-gradient(180deg, rgba(34,211,238,.14), rgba(255,255,255,.03));
    }

    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index: 60;
    }
    .modalOverlay.show{ display:flex; }
    .modal{
      width: min(780px, calc(100% - 24px));
      margin-bottom: 14px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(6,19,26,.96);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding: 14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalHead b{ font-size: 14px; letter-spacing:.2px; }
    .modalBody{ padding: 12px 14px 14px; display:flex; flex-direction:column; gap:10px; }
    .menuItem{
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      font-weight: 900;
      display:flex; align-items:center; justify-content:space-between;
      cursor:pointer; user-select:none;
      font-size: var(--fsBody);
    }
    .menuItem small{ color: var(--muted); font-weight: 800; }

    @media (max-width: 420px){
      .pillMoney{ display:none; }
      .brand .title{ max-width: 170px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="appbar surface">
      <div class="logo">
        <div class="mark">R</div>
        <div class="brand">
          <div class="title">Radar Jogos PRO</div>
          <div class="sub">
            <span class="dot"></span>
            <span>Online</span>
            <span style="opacity:.55;">v2.4.1</span>
            <span style="opacity:.55;">‚Ä¢</span>
            <span id="checkTxt" style="opacity:.8;">Checagem: ‚Äî</span>
          </div>
        </div>
      </div>

      <div class="appbarRight">
        <button class="iconBtn" id="openMenu" aria-label="Menu">‚ãØ</button>
        <button class="iconBtn" id="icoSearch" aria-label="Buscar">üîé</button>
        <button class="iconBtn" id="icoUser" aria-label="Conta">üë§<span class="badge"></span></button>
        <div class="pillMoney" id="moneyPill"><small>R$</small><span>0,00</span></div>
        <button class="cta" id="proBtn">PLANO PRO</button>
      </div>
    </div>

    <div class="sportsRow" aria-label="Esportes">
      <div class="sportTab active" data-sport="all"><div class="sportIcon">üì°</div><div>Tudo</div></div>
      <div class="sportTab" data-sport="football"><div class="sportIcon">‚öΩ</div><div>Futebol</div></div>
      <div class="sportTab" data-sport="tennis"><div class="sportIcon">üéæ</div><div>T√™nis</div></div>
      <div class="sportTab" data-sport="basket"><div class="sportIcon">üèÄ</div><div>Basquete</div></div>
      <div class="sportTab" data-sport="volei"><div class="sportIcon">üèê</div><div>V√¥lei</div></div>
    </div>

    <div class="filters surface">
      <div class="filterRow">
        <div class="chip" id="chipUpcoming"><span class="miniDot"></span>üóìÔ∏è Pr√≥ximos</div>
        <div class="chip" id="chipLive"><span class="miniDot"></span>üî¥ Ao vivo</div>
        <div class="chip" id="chipBrazil"><span class="miniDot"></span>üáßüá∑ Brasil</div>
        <div class="chip" id="chipEurope"><span class="miniDot"></span>üá™üá∫ Europa</div>
        <div class="chip" id="chipAll"><span class="miniDot"></span>üåç Todos</div>
      </div>

      <div class="searchWrap">
        <div class="search">
          <input id="q" type="text" placeholder="Buscar time, liga ou pa√≠s..." autocomplete="off" />
        </div>
        <button class="btn" id="clearBtn">Limpar</button>
      </div>

      <div class="filterRow" style="margin-top:10px;">
        <button class="btn primary" id="refreshBtn">Atualizar</button>
        <button class="btn" id="autoBtn">Auto: OFF</button>
        <button class="btn" id="infoBtn">Info</button>
      </div>

      <div class="meta" id="meta">Carregando‚Ä¶</div>

      <div class="sortRow">
        <div class="sortBtn" id="sortBtn" title="Alternar ordena√ß√£o">
          <span style="opacity:.85;">‚áÖ</span>
          <b id="sortTxt">Popular primeiro</b>
          <span style="opacity:.65;">‚ñæ</span>
        </div>
        <div class="right">
          <button class="iconBtn" id="icoSettings" aria-label="Config">‚öôÔ∏è</button>
          <button class="iconBtn" id="icoTune" aria-label="Filtros">üéöÔ∏è</button>
        </div>
      </div>
    </div>

    <div class="list" id="list"></div>
  </div>

  <div class="bottomNav">
    <div class="navBtn active" id="navGames">üèüÔ∏è Jogos</div>
    <div class="navBtn" id="navLive">üî¥ Ao vivo</div>
    <div class="navBtn" id="navFav">‚≠ê Favoritos</div>
  </div>

  <div class="modalOverlay" id="menuOverlay">
    <div class="modal">
      <div class="modalHead">
        <b>Menu</b>
        <button class="btn" id="closeMenu">Fechar</button>
      </div>
      <div class="modalBody">
        <div class="menuItem" id="menuGoFav"><span>‚≠ê Favoritos</span><small>ver salvos</small></div>
        <div class="menuItem" id="menuGoGames"><span>üèüÔ∏è Jogos</span><small>lista principal</small></div>
        <div class="menuItem" id="menuAbout"><span>‚ÑπÔ∏è Sobre</span><small>vers√£o e fonte</small></div>
      </div>
    </div>
  </div>

  <script>
    const TZ = "America/Sao_Paulo";
    const LS_KEY = "rjpro_state_v241";

    const state = {
      mode: "upcoming",      // upcoming | live | favorites
      region: "all",         // all | brazil | europe
      q: "",
      favorites: {},
      autoOn: false,
      sport: "all",
      openDetails: {},
      closedLeagues: {},
      sortMode: "popular"    // popular | time
    };

    let data = null;
    let allGames = [];
    let autoTimer = null;
    let tickerTimer = null;

    const $ = (id) => document.getElementById(id);

    function saveState(){ try{ localStorage.setItem(LS_KEY, JSON.stringify({...state})); }catch(e){} }
    function loadState(){ try{ const raw = localStorage.getItem(LS_KEY); if(raw) Object.assign(state, JSON.parse(raw)); }catch(e){} }

    function fmtBrtDate(d){
      return new Intl.DateTimeFormat("pt-BR", { timeZone: TZ, day:"2-digit", month:"2-digit", year:"numeric" }).format(d);
    }
    function fmtBrtTime(d){
      return new Intl.DateTimeFormat("pt-BR", { timeZone: TZ, hour:"2-digit", minute:"2-digit" }).format(d);
    }
    function brtDayKey(d){
      const parts = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).formatToParts(d);
      const y = parts.find(p=>p.type==="year").value;
      const m = parts.find(p=>p.type==="month").value;
      const da = parts.find(p=>p.type==="day").value;
      return `${y}-${m}-${da}`;
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }

    function gameId(g){
      if(g.id) return String(g.id);
      return `${g.home||""}__${g.away||""}__${g.league||""}__${g.date||""}__${g.time||""}`;
    }

    function getKickoffMs(g){
      if(typeof g.kickoffTs === "number") return g.kickoffTs;
      if(g.date && g.time){
        const iso = `${g.date}T${g.time}:00-03:00`;
        const ms = Date.parse(iso);
        if(!Number.isNaN(ms)) return ms;
      }
      return null;
    }

    function isFinished(g){
      const st = (g.status||"").toUpperCase();
      return st === "FT" || st === "AET" || st === "PEN";
    }

    function isLikelyStaleLive(g){
      const st = (g.status||"").toUpperCase();
      const k = getKickoffMs(g);
      if(!k) return false;

      const now = Date.now();
      const ageMin = (now - k) / 60000;
      const el = (typeof g.elapsed === "number") ? g.elapsed : null;

      const liveSet = ["1H","2H","HT","ET","BT","P","LIVE","IN_PLAY"];
      if(!liveSet.includes(st)) return false;

      if(el !== null && el >= 90 && ageMin >= 125) return true;
      if(st === "ET" && ageMin >= 215) return true;
      if(el === null && ageMin >= 170) return true;

      return false;
    }

    function isLiveGame(g){
      if(isFinished(g)) return false;
      if(isLikelyStaleLive(g)) return false;
      if(g.isLive === true) return true;

      const st = (g.status||"").toUpperCase();
      if(["1H","2H","HT","ET","P","LIVE","IN_PLAY","BT"].includes(st)) return true;
      if(typeof g.elapsed === "number" && st !== "FT") return true;
      return false;
    }

    function computedElapsed(g){
      const k = getKickoffMs(g);
      if(!k) return null;
      if(!isLiveGame(g)) return null;

      const now = Date.now();
      const mins = Math.max(0, Math.floor((now - k) / 60000));
      if(typeof g.elapsed === "number") return Math.max(g.elapsed, mins);
      return mins;
    }

    function minutesText(g){
      if(isLikelyStaleLive(g)) return "FT";
      const st = (g.status||"").toUpperCase();
      const el = computedElapsed(g);

      if(el !== null && el > 0) return `${el}'`;
      if(st==="HT") return "HT";
      if(st==="FT") return "FT";
      return st || "‚Äî";
    }

    function scoreText(g){
      const sh = (typeof g.scoreHome === "number") ? g.scoreHome : null;
      const sa = (typeof g.scoreAway === "number") ? g.scoreAway : null;
      if(sh===null || sa===null) return null;
      return `${sh}‚Äì${sa}`;
    }

    function regionMatch(g){
      const c = (g.country||"").toLowerCase();
      if(state.region==="all") return true;
      if(state.region==="brazil") return c.includes("brazil") || c.includes("brasil");
      if(state.region==="europe"){
        const eu = ["england","scotland","spain","france","italy","germany","portugal","netherlands","belgium","switzerland","austria","sweden","norway","denmark","finland","poland","czech","slovakia","hungary","romania","bulgaria","greece","turkey","croatia","serbia","slovenia","ukraine"];
        return eu.some(x => c.includes(x));
      }
      return true;
    }

    function qMatch(g){
      const q = (state.q||"").trim().toLowerCase();
      if(!q) return true;
      const hay = `${g.home||""} ${g.away||""} ${g.league||""} ${g.country||""}`.toLowerCase();
      return hay.includes(q);
    }

    async function loadJogosJson(force=false){
      const bust = force ? `?t=${Date.now()}` : "";
      const res = await fetch("jogos.json"+bust, { cache: "no-store" });
      if(!res.ok) throw new Error("Falha ao carregar jogos.json");
      data = await res.json();
      allGames = Array.isArray(data.games) ? data.games : [];
    }

    function updateMeta(){
      $("checkTxt").textContent = `Checagem: ${new Intl.DateTimeFormat("pt-BR",{hour:"2-digit",minute:"2-digit"}).format(new Date())}`;

      if(!data){
        $("meta").textContent = "Sem dados ainda.";
        return;
      }

      const upd = data.updatedAt || "‚Äî";
      const src = data.source || "‚Äî";
      const now = Date.now();

      let liveClean=0, todayCount=0, next24=0;
      const todayKey = brtDayKey(new Date());

      for(const g of allGames){
        const k = getKickoffMs(g);
        if(isLiveGame(g)) liveClean++;
        if(g.date === todayKey) todayCount++;
        if(k && k >= now && k <= (now + 24*3600*1000)) next24++;
      }

      $("meta").innerHTML =
        `Atualizado: <b>${upd}</b> ‚Ä¢ Fonte: <b>${src}</b><br>` +
        `Jogos: <b>${allGames.length}</b> ‚Ä¢ Hoje: <b>${todayCount}</b> ‚Ä¢ Pr√≥x 24h: <b>${next24}</b> ‚Ä¢ Ao vivo (limpo): <b>${liveClean}</b><br>` +
        `<span style="opacity:.85">Live minuto-a-minuto: <b>sim</b> (front calcula pelo kickoff)</span>`;
    }

    function setActiveChips(){
      $("chipUpcoming").classList.toggle("active", state.mode==="upcoming");
      $("chipLive").classList.toggle("active", state.mode==="live");

      $("chipBrazil").classList.toggle("active", state.region==="brazil");
      $("chipEurope").classList.toggle("active", state.region==="europe");
      $("chipAll").classList.toggle("active", state.region==="all");

      $("navGames").classList.toggle("active", state.mode==="upcoming");
      $("navLive").classList.toggle("active", state.mode==="live");
      $("navFav").classList.toggle("active", state.mode==="favorites");

      $("autoBtn").textContent = `Auto: ${state.autoOn ? "ON" : "OFF"}`;
      $("autoBtn").classList.toggle("primary", state.autoOn);

      $("sortTxt").textContent = (state.sortMode === "popular") ? "Popular primeiro" : "Hor√°rio primeiro";
    }

    function filterUpcoming(){
      const now = Date.now();
      const max = now + 24 * 3600 * 1000;

      return allGames.filter(g => {
        if(!regionMatch(g) || !qMatch(g)) return false;
        if(isLiveGame(g)) return false;
        const k = getKickoffMs(g);
        if(!k) return false;
        if(isFinished(g)) return false;
        return (k >= now && k <= max);
      });
    }

    function filterLive(){
      return allGames.filter(g => {
        if(!regionMatch(g) || !qMatch(g)) return false;
        return isLiveGame(g);
      });
    }

    function popularityScore(g){
      // ‚úÖ heur√≠stica ‚Äúpopular‚Äù (sem API): prioriza Brasil/Europa, ligas grandes, ao vivo, e favorito
      const id = gameId(g);
      const favBoost = state.favorites[id] ? 2000 : 0;

      const country = (g.country||"").toLowerCase();
      const league = (g.league||"").toLowerCase();
      const liveBoost = isLiveGame(g) ? 1500 : 0;

      let regionBoost = 0;
      if(country.includes("brazil") || country.includes("brasil")) regionBoost += 900;
      if(["england","spain","italy","france","germany","portugal","netherlands"].some(x=>country.includes(x))) regionBoost += 700;

      let leagueBoost = 0;
      const big = ["champions","libertadores","premier","la liga","serie a","bundesliga","ligue 1","copa","brasile","carioca","paulista"];
      if(big.some(x=>league.includes(x))) leagueBoost += 500;

      const timeBoost = 0; // deixa neutro
      return favBoost + liveBoost + regionBoost + leagueBoost + timeBoost;
    }

    function sortGames(list){
      if(state.sortMode === "time"){
        return list.sort((a,b) => (getKickoffMs(a)||0) - (getKickoffMs(b)||0));
      }
      // popular primeiro
      return list.sort((a,b) => popularityScore(b) - popularityScore(a));
    }

    function flagEmojiFromCountry(country){
      const c = (country||"").toLowerCase();
      if(c.includes("brazil") || c.includes("brasil")) return "üáßüá∑";
      if(c.includes("spain")) return "üá™üá∏";
      if(c.includes("england")) return "üè¥";
      if(c.includes("italy")) return "üáÆüáπ";
      if(c.includes("france")) return "üá´üá∑";
      if(c.includes("germany")) return "üá©üá™";
      if(c.includes("portugal")) return "üáµüáπ";
      if(c.includes("netherlands")) return "üá≥üá±";
      if(c.includes("belgium")) return "üáßüá™";
      if(c.includes("turkey")) return "üáπüá∑";
      if(c.includes("argentina")) return "üá¶üá∑";
      if(c.includes("chile")) return "üá®üá±";
      if(c.includes("mexico")) return "üá≤üáΩ";
      if(c.includes("usa") || c.includes("united states")) return "üá∫üá∏";
      return "üè≥Ô∏è";
    }

    function groupByLeague(list){
      const map = new Map();
      for(const g of list){
        const key = `${g.country||"‚Äî"} ‚Ä¢ ${g.league||"‚Äî"}`;
        if(!map.has(key)) map.set(key, []);
        map.get(key).push(g);
      }
      return map;
    }

    function renderEmpty(msg){
      $("list").innerHTML = `<div class="empty">${msg}</div>`;
    }

    function fakeOddsForGame(g){
      const id = gameId(g);
      let h = 0;
      for(let i=0;i<id.length;i++) h = (h*31 + id.charCodeAt(i)) >>> 0;
      const a = 1.20 + (h % 180)/100;
      const b = 2.50 + ((h>>8) % 260)/100;
      const c = 2.10 + ((h>>16) % 420)/100;
      return { "1": a.toFixed(2), "X": b.toFixed(2), "2": c.toFixed(2) };
    }

    function renderMatch(g){
      const id = gameId(g);
      const live = isLiveGame(g);
      const k = getKickoffMs(g);

      const dStr = g.date ? fmtBrtDate(new Date(`${g.date}T12:00:00-03:00`)) : "‚Äî";
      const tStr = k ? fmtBrtTime(new Date(k)) : (g.time || "‚Äî");

      const score = scoreText(g);
      const mins = minutesText(g);
      const fav = !!state.favorites[id];
      const odds = fakeOddsForGame(g);
      const open = !!state.openDetails[id];

      const wrap = document.createElement("div");
      wrap.className = "match";
      wrap.setAttribute("data-gameid", id);

      wrap.innerHTML = `
        <div class="matchTop">
          <div class="teams">
            <div class="teamRow">
              <span class="crest">‚öΩ</span>
              <span>${escapeHtml(g.home||"‚Äî")}</span>
            </div>
            <div class="teamRow" style="margin-top:8px; opacity:.92;">
              <span class="crest">‚öΩ</span>
              <span>${escapeHtml(g.away||"‚Äî")}</span>
            </div>
            <div style="margin-top:10px; color: rgba(255,255,255,.55); font-weight: 850; font-size: 12px;">
              ${escapeHtml(g.country||"‚Äî")} ‚Ä¢ ${escapeHtml(g.league||"‚Äî")} ‚Ä¢ <span style="opacity:.85">${dStr}</span>
            </div>
          </div>

          <div class="metaRight">
            ${live ? `<div class="livePill"><span class="ldot"></span>AO VIVO</div>` : ``}
            <div class="timeTxt">${tStr}</div>
            ${live ? `
              <div class="scoreLine" data-livebox>
                <span data-score>${score ? score : "‚Äî"}</span>
                <span class="min" data-min>‚Ä¢ ${mins}</span>
              </div>
            ` : ``}
          </div>
        </div>

        <div class="oddsRow">
          <div class="odd" data-odd="1"><small>1</small><b>${odds["1"]}</b></div>
          <div class="odd" data-odd="X"><small>X</small><b>${odds["X"]}</b></div>
          <div class="odd" data-odd="2"><small>2</small><b>${odds["2"]}</b></div>
        </div>

        <div class="actions">
          <button class="btn" data-act="details">${open ? "Fechar" : "Detalhes"}</button>
          <button class="btn ${fav ? "primary":""}" data-act="fav">${fav ? "‚òÖ Favoritado" : "‚òÜ Favoritar"}</button>
        </div>

        <div class="detailsWrap ${open ? "open":""}" data-details>
          <div class="detailsInner">
            <div style="font-weight:950; color: rgba(255,255,255,.86);">
              Insights / Probabilidades
            </div>
            <div class="grid2">
              <div class="kv"><span>Over 1,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Over 2,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Under 2,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>BTTS</span><b>‚Äî%</b></div>
            </div>
            <div style="margin-top:10px; color: rgba(255,255,255,.55);">
              PRO: conta + assinatura + odds reais + exportar picks.
            </div>
          </div>
        </div>
      `;

      wrap.querySelector('[data-act="details"]').onclick = () => {
        state.openDetails[id] = !state.openDetails[id];
        saveState();
        render();
      };

      wrap.querySelector('[data-act="fav"]').onclick = () => {
        state.favorites[id] = !state.favorites[id];
        saveState();
        render();
      };

      wrap.querySelectorAll(".odd").forEach(o=>{
        o.onclick = () => {
          const which = o.getAttribute("data-odd");
          alert(`Selecionado: ${which}\n\nNo PRO: voc√™ pode salvar a pick e copiar/colar nas casas.`);
        };
      });

      return wrap;
    }

    function renderSection(leagueKey, games){
      const [country, league] = leagueKey.split(" ‚Ä¢ ").map(s=>s.trim());
      const flag = flagEmojiFromCountry(country);
      const closed = !!state.closedLeagues[leagueKey];

      const sec = document.createElement("div");
      sec.className = "section";

      sec.innerHTML = `
        <div class="sectionHead" data-head>
          <div class="leagueLeft">
            <div class="flag">${flag}</div>
            <div class="leagueName">${escapeHtml(country||"‚Äî")} - ${escapeHtml(league||"‚Äî")}</div>
          </div>
          <div class="caret">${closed ? "‚ñæ" : "‚ñ¥"}</div>
        </div>
        <div class="sectionBody ${closed ? "closed":""}" data-body></div>
      `;

      const body = sec.querySelector("[data-body]");
      for(const g of games) body.appendChild(renderMatch(g));

      sec.querySelector("[data-head]").onclick = () => {
        state.closedLeagues[leagueKey] = !state.closedLeagues[leagueKey];
        saveState();
        render();
      };

      return sec;
    }

    function renderFavorites(){
      const favIds = Object.keys(state.favorites).filter(k => state.favorites[k]);
      if(favIds.length===0){
        renderEmpty("Voc√™ ainda n√£o favoritou nada. Clique em ‚òÜ Favoritar em um jogo.");
        return;
      }
      const map = new Map(allGames.map(g => [gameId(g), g]));
      const favGames = favIds.map(id => map.get(id)).filter(Boolean);

      // favorece live
      favGames.sort((a,b) => {
        const la = isLiveGame(a), lb = isLiveGame(b);
        if(la && !lb) return -1;
        if(lb && !la) return 1;
        return (computedElapsed(b)||0) - (computedElapsed(a)||0);
      });

      const root = $("list");
      root.innerHTML = "";

      const groups = groupByLeague(favGames);
      for(const [k, arr] of groups.entries()){
        root.appendChild(renderSection(k, arr));
      }
    }

    function render(){
      setActiveChips();
      updateMeta();

      if(!data){
        renderEmpty("Sem dados ainda. Clique em Atualizar.");
        return;
      }

      if(state.mode==="favorites"){
        renderFavorites();
        return;
      }

      let list = [];
      if(state.mode==="live"){
        list = filterLive();
        if(list.length===0){ renderEmpty("Nada ao vivo agora com esses filtros."); return; }
      } else {
        list = filterUpcoming();
        if(list.length===0){ renderEmpty("Sem jogos nas pr√≥ximas 24h com esses filtros."); return; }
      }

      list = sortGames(list);

      const root = $("list");
      root.innerHTML = "";

      const groups = groupByLeague(list);
      for(const [k, arr] of groups.entries()){
        // dentro da liga, aplica a mesma ordena√ß√£o ‚Äúpopular/time‚Äù
        const ordered = sortGames([...arr]);
        root.appendChild(renderSection(k, ordered));
      }
    }

    function startTicker(){
      stopTicker();
      tickerTimer = setInterval(() => {
        document.querySelectorAll("[data-livebox]").forEach(box=>{
          const match = box.closest(".match");
          if(!match) return;
          const id = match.getAttribute("data-gameid");
          const g = allGames.find(x => gameId(x) === id);
          if(!g) return;

          const scoreEl = box.querySelector("[data-score]");
          const minEl = box.querySelector("[data-min]");

          const score = scoreText(g);
          const mins = minutesText(g);

          if(scoreEl) scoreEl.textContent = (score ? score : "‚Äî");
          if(minEl) minEl.textContent = `‚Ä¢ ${mins}`;
        });
      }, 15000);
    }
    function stopTicker(){ if(tickerTimer) clearInterval(tickerTimer); tickerTimer = null; }

    function startAuto(){
      stopAuto();
      const interval = (state.mode === "live") ? 30_000 : 60_000;
      autoTimer = setInterval(async () => {
        try{
          await loadJogosJson(true);
          render();
        }catch(e){}
      }, interval);
    }
    function stopAuto(){ if(autoTimer) clearInterval(autoTimer); autoTimer = null; }

    function wire(){
      $("chipUpcoming").onclick = () => { state.mode="upcoming"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("chipLive").onclick = () => { state.mode="live"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("chipBrazil").onclick = () => { state.region="brazil"; saveState(); render(); };
      $("chipEurope").onclick = () => { state.region="europe"; saveState(); render(); };
      $("chipAll").onclick = () => { state.region="all"; saveState(); render(); };

      $("navGames").onclick = () => { state.mode="upcoming"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("navLive").onclick = () => { state.mode="live"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("navFav").onclick = () => { state.mode="favorites"; saveState(); render(); stopAuto(); };

      $("q").addEventListener("input", () => { state.q = $("q").value; saveState(); render(); });
      $("clearBtn").onclick = () => { state.q=""; $("q").value=""; saveState(); render(); };

      $("refreshBtn").onclick = async () => {
        $("refreshBtn").textContent = "Atualizando‚Ä¶";
        try{ await loadJogosJson(true); render(); }
        catch(e){ renderEmpty("Erro ao atualizar dados."); }
        finally{ $("refreshBtn").textContent = "Atualizar"; }
      };

      $("autoBtn").onclick = () => {
        state.autoOn = !state.autoOn;
        saveState();
        setActiveChips();
        if(state.autoOn) startAuto(); else stopAuto();
      };

      $("sortBtn").onclick = () => {
        state.sortMode = (state.sortMode === "popular") ? "time" : "popular";
        saveState();
        render();
      };

      $("infoBtn").onclick = () => {
        const upd = data?.updatedAt || "‚Äî";
        const src = data?.source || "‚Äî";
        alert(`Radar Jogos PRO v2.4.1\nFonte: ${src}\nAtualizado: ${upd}\n\n‚Ä¢ ‚ÄúPopular primeiro‚Äù agora funciona (heur√≠stica)\n‚Ä¢ Live minuto-a-minuto no front\n‚Ä¢ PRO: conta+assinatura (fase 2).`);
      };

      $("openMenu").onclick = () => $("menuOverlay").classList.add("show");
      $("closeMenu").onclick = () => $("menuOverlay").classList.remove("show");
      $("menuOverlay").onclick = (e) => { if(e.target === $("menuOverlay")) $("menuOverlay").classList.remove("show"); };

      $("menuGoFav").onclick = () => { state.mode="favorites"; saveState(); render(); $("menuOverlay").classList.remove("show"); stopAuto(); };
      $("menuGoGames").onclick = () => { state.mode="upcoming"; saveState(); render(); $("menuOverlay").classList.remove("show"); if(state.autoOn) startAuto(); };
      $("menuAbout").onclick = () => {
        const upd = data?.updatedAt || "‚Äî";
        const src = data?.source || "‚Äî";
        alert(`Radar Jogos PRO v2.4.1\nFonte: ${src}\nAtualizado: ${upd}`);
      };

      // placeholders
      $("icoSettings").onclick = () => alert("Configura√ß√µes: vamos ligar mais pra frente.");
      $("icoTune").onclick = () => alert("Filtros avan√ßados: vamos ligar mais pra frente.");
      $("icoSearch").onclick = () => $("q").focus();
      $("icoUser").onclick = () => alert("Conta/Entrar: fase 2 (PRO).");

      $("moneyPill").onclick = () => alert("Saldo (demo).");

      $("proBtn").onclick = () => {
        alert(
`PLANO PRO (fase 2)
‚Ä¢ Criar conta / Entrar
‚Ä¢ Assinatura mensal (Pix/Cart√£o)
‚Ä¢ Odds reais e mercados extras
‚Ä¢ Exportar picks (copiar/colar)
‚Ä¢ Favoritos em nuvem

Agora: estamos finalizando layout e estabilidade.`
        );
      };

      // Sports tabs (s√≥ UI por enquanto)
      document.querySelectorAll(".sportTab").forEach(tab=>{
        tab.onclick = () => {
          document.querySelectorAll(".sportTab").forEach(x=>x.classList.remove("active"));
          tab.classList.add("active");
          state.sport = tab.getAttribute("data-sport") || "all";
          saveState();
        };
      });
    }

    (async function init(){
      loadState();
      if(!state.mode) state.mode="upcoming";
      if(!state.region) state.region="all";
      if(!state.favorites) state.favorites={};
      if(!state.openDetails) state.openDetails={};
      if(!state.closedLeagues) state.closedLeagues={};
      if(!state.sortMode) state.sortMode="popular";

      $("q").value = state.q || "";

      setActiveChips();
      wire();

      try{ await loadJogosJson(false); }catch(e){}
      render();

      startTicker();
      if(state.autoOn) startAuto();
    })();
  </script>
</body>
</html>
