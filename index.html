<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Radar Jogos PRO</title>
  <style>
    :root{
      --bg1:#063a34; --bg2:#021a1f;
      --card:#0b1c2a; --card2:#0a2232;
      --text:#eaf3ff; --muted:#a9c0d6;
      --pill:#0f2f2a; --pill2:#173746;
      --accent:#28d17c; --danger:#b24b5a;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      color:var(--text);
      background: radial-gradient(1200px 700px at 30% 10%, #0c5c52 0%, var(--bg1) 30%, var(--bg2) 100%);
      min-height:100vh;
    }
    .wrap{max-width:780px;margin:0 auto;padding:22px 14px 120px;}
    h1{margin:18px 0 6px; font-size:44px; line-height:1.05; text-align:center; letter-spacing:.5px;}
    .online{display:flex; gap:10px; align-items:center; justify-content:center; color:var(--muted); margin-bottom:14px;}
    .dot{width:12px;height:12px;border-radius:999px;background:#22c55e; box-shadow:0 0 20px rgba(34,197,94,.6)}
    .panel{
      background: rgba(8,22,28,.55);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
    .search{flex:1; min-width:220px; display:flex; gap:10px; align-items:center;}
    input{
      width:100%; padding:14px 14px; border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      color: var(--text);
      outline:none;
      font-size:16px;
    }
    .btn{
      padding:12px 14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: var(--text);
      font-weight:700;
      cursor:pointer;
      user-select:none;
      -webkit-user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{
      background: linear-gradient(180deg, #34ea8d 0%, #18b867 100%);
      border:none;
      color:#06221a;
    }
    .btn.ghost{background: rgba(255,255,255,.06);}
    .meta{color:var(--muted); margin-top:10px; line-height:1.35}
    .tabs{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    .tab{
      padding:10px 14px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      font-weight:800; cursor:pointer;
      user-select:none; -webkit-user-select:none;
    }
    .tab.active{background: rgba(40,209,124,.18); border-color: rgba(40,209,124,.35)}
    .note{margin-top:10px; color:#b7d2c4; font-size:13px}
    .list{margin-top:16px; display:flex; flex-direction:column; gap:14px;}
    .card{
      background: radial-gradient(900px 400px at 20% 10%, rgba(40,209,124,.16) 0%, rgba(255,255,255,.04) 40%, rgba(0,0,0,.10) 100%),
                  linear-gradient(180deg, rgba(11,28,42,.90), rgba(8,18,30,.92));
      border:1px solid rgba(255,255,255,.10);
      border-radius: 26px;
      padding:16px;
      box-shadow: var(--shadow);
    }
    .title{font-size:34px; font-weight:900; letter-spacing:.3px; margin:2px 0 10px; line-height:1.05;}
    .sub{color:var(--muted); font-weight:700; margin-top:2px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:999px;
      background: rgba(13,63,44,.55);
      border:1px solid rgba(40,209,124,.25);
      font-weight:900;
      user-select:none; -webkit-user-select:none;
    }
    .pill.danger{
      background: rgba(178,75,90,.18);
      border-color: rgba(178,75,90,.4);
    }
    .pill.gray{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.10);
      font-weight:800;
    }
    .grid{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center}
    .actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}
    .btn.small{padding:10px 12px; font-weight:900}
    .odds{
      margin-top:12px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
    }
    .odds h3{margin:0 0 8px; font-size:14px; letter-spacing:.3px; color:#cfe8ff}
    .odds .line{display:flex; justify-content:space-between; gap:10px; font-weight:800; color:var(--muted); margin:6px 0}
    .odds .val{color:var(--text)}
    .bottom{
      position:fixed; left:0; right:0; bottom:0;
      padding:14px 12px;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(2,10,14,.55) 35%, rgba(2,10,14,.92) 100%);
      backdrop-filter: blur(10px);
    }
    .bar{
      max-width:780px; margin:0 auto; display:flex; gap:12px;
      background: rgba(8,18,30,.70);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 24px;
      padding:10px;
      box-shadow: var(--shadow);
    }
    .bar .btn{flex:1; border-radius:18px; padding:14px 14px; font-weight:900}
    .bar .btn.primary{color:#06221a}
    .modal{
      position:fixed; inset:0; display:none; align-items:flex-end; justify-content:center;
      background: rgba(0,0,0,.45);
    }
    .modal.show{display:flex}
    .sheet{
      width:min(780px, 96vw);
      background: rgba(8,18,30,.95);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 22px;
      padding:14px;
      margin:0 0 14px 0;
      box-shadow: var(--shadow);
    }
    .sheet h2{margin:4px 0 12px; font-size:18px}
    .sheet .item{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 12px; border-radius:16px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      margin-bottom:10px;
      font-weight:900;
      user-select:none; -webkit-user-select:none;
    }
    .sheet .item span{color:var(--muted); font-weight:800}
    .badge-live{color:#9ff7c7}
    .badge-ft{color:#ffb4c2}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Radar Jogos<br/>PRO</h1>
    <div class="online"><div class="dot"></div> Online</div>

    <div class="panel">
      <div class="row">
        <div class="search">
          <input id="q" placeholder="Buscar jogo, time, liga ou pa√≠s..." />
          <button class="btn" id="clear">Limpar</button>
        </div>
        <button class="btn primary" id="refresh">Atualizar</button>
      </div>

      <div class="meta" id="meta">Carregando...</div>

      <div class="tabs">
        <div class="tab active" data-tab="todos">Todos</div>
        <div class="tab" data-tab="brasil">Brasil</div>
        <div class="tab" data-tab="europa">Europa</div>
        <div class="tab" data-tab="hoje">Hoje</div>
        <div class="tab" data-tab="live">Ao vivo</div>
      </div>

      <div class="note">* Probabilidades/odds aqui s√£o <b>estimativas (odd justa)</b>, n√£o odds de casa.</div>
    </div>

    <div class="list" id="list"></div>
  </div>

  <div class="bottom">
    <div class="bar">
      <button class="btn primary" id="goJogos">üóìÔ∏è Jogos</button>
      <button class="btn" id="openMenu">‚ãØ Menu</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <h2>Menu</h2>
      <div class="item" data-nav="jogos">Jogos <span>lista principal</span></div>
      <div class="item" data-nav="favoritos">Favoritos <span>salvos</span></div>
      <div class="item" data-nav="historico">Hist√≥rico <span>vistos</span></div>
      <div class="item" data-nav="config">Configura√ß√µes <span>ajustes</span></div>
      <button class="btn ghost" id="closeMenu" style="width:100%;">Fechar</button>
    </div>
  </div>

<script>
  const state = {
    tab: "todos",
    view: "jogos", // jogos | favoritos | historico | config
    data: null,
    favorites: new Set(JSON.parse(localStorage.getItem("fav") || "[]")),
    history: new Set(JSON.parse(localStorage.getItem("hist") || "[]")),
  };

  const liveShort = new Set(["1H","HT","2H","ET","P","BT","LIVE"]);
  const finishedShort = new Set(["FT","AET","PEN"]);

  function saveLocal(){
    localStorage.setItem("fav", JSON.stringify([...state.favorites]));
    localStorage.setItem("hist", JSON.stringify([...state.history]));
  }

  function statusLabel(g){
    const s = g.status || "";
    if (liveShort.has(s)) {
      const m = (g.minute !== null && g.minute !== undefined) ? `${g.minute}'` : "Ao vivo";
      return { text: `Ao vivo ‚Ä¢ ${m}`, cls: "pill" };
    }
    if (finishedShort.has(s)) return { text: "Final", cls: "pill danger" };
    if (s === "NS") return { text: "N√£o iniciado", cls: "pill gray" };
    return { text: s || "‚Äî", cls: "pill gray" };
  }

  function isEurope(country){
    const c = (country || "").toLowerCase();
    const eu = ["england","spain","italy","germany","france","portugal","netherlands","belgium","scotland","turkey","greece","switzerland","austria","sweden","norway","denmark","poland","czech","croatia","serbia","romania","ukraine","ireland","wales"];
    return eu.some(x => c.includes(x));
  }

  function pickGames(){
    const q = (document.getElementById("q").value || "").trim().toLowerCase();
    const games = (state.data?.games || []);

    // view
    let base = games;
    if (state.view === "favoritos") {
      base = games.filter(g => state.favorites.has(String(g.id)));
    } else if (state.view === "historico") {
      base = games.filter(g => state.history.has(String(g.id)));
    } else if (state.view === "config") {
      base = [];
    }

    // tab
    const today = state.data?.date; // j√° vem no BRT
    base = base.filter(g => {
      if (state.tab === "brasil") return (g.country || "").toLowerCase().includes("brazil");
      if (state.tab === "europa") return isEurope(g.country);
      if (state.tab === "hoje") return (g.date === today);
      if (state.tab === "live") return liveShort.has(g.status);
      return true;
    });

    // por padr√£o em "Jogos": mostra Live + Pr√≥ximos (n√£o mostra finalizados)
    if (state.view === "jogos" && state.tab !== "hoje") {
      base = base.filter(g => !finishedShort.has(g.status));
    }

    // search
    if (q) {
      base = base.filter(g => {
        const hay = `${g.home} ${g.away} ${g.league} ${g.country}`.toLowerCase();
        return hay.includes(q);
      });
    }

    return base;
  }

  function render(){
    const list = document.getElementById("list");
    list.innerHTML = "";

    // Config view
    if (state.view === "config") {
      list.innerHTML = `
        <div class="card">
          <div class="title" style="font-size:26px;">Configura√ß√µes</div>
          <div class="sub">Em breve: alertas, ligas favoritas, notifica√ß√µes.</div>
          <div class="odds" style="margin-top:14px;">
            <h3>Status</h3>
            <div class="muted">Vers√£o atual roda por GitHub Pages + GitHub Actions.</div>
          </div>
        </div>
      `;
      return;
    }

    const games = pickGames();

    if (!games.length) {
      list.innerHTML = `<div class="card"><div class="title" style="font-size:26px;">Nada por aqui</div><div class="sub">Tenta mudar o filtro ou buscar outro termo.</div></div>`;
      return;
    }

    for (const g of games){
      const st = statusLabel(g);
      const fav = state.favorites.has(String(g.id));
      const isFT = finishedShort.has(g.status);
      const score = (g.score && (g.score.home !== null) && (g.score.away !== null))
        ? `${g.score.home} x ${g.score.away}`
        : "‚Äî x ‚Äî";

      const p = g.prob || {};
      const fo = (p.fairOdds || {});
      const oddsBox = `
        <div class="odds">
          <h3>Probabilidades (estimativas)</h3>
          <div class="line"><span>Over 1,5</span><span class="val">${p.over15 ?? "‚Äî"}% ‚Ä¢ odd ${fo.over15 ?? "‚Äî"}</span></div>
          <div class="line"><span>Over 2,5</span><span class="val">${p.over25 ?? "‚Äî"}% ‚Ä¢ odd ${fo.over25 ?? "‚Äî"}</span></div>
          <div class="line"><span>Under 1,5</span><span class="val">${p.under15 ?? "‚Äî"}% ‚Ä¢ odd ${fo.under15 ?? "‚Äî"}</span></div>
          <div class="line"><span>Under 2,5</span><span class="val">${p.under25 ?? "‚Äî"}% ‚Ä¢ odd ${fo.under25 ?? "‚Äî"}</span></div>
          <div class="muted" style="font-size:12px; margin-top:8px;">${p.note || ""}</div>
        </div>
      `;

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="title">${g.home} x ${g.away}</div>
        <div class="sub">Liga: ${g.league || "‚Äî"} ‚Ä¢ ${g.country || "‚Äî"} ‚Ä¢ ${g.time || "‚Äî"}</div>

        <div class="grid">
          <span class="${st.cls}">${st.text}</span>
          <span class="pill gray">Placar: <b>${score}</b></span>
          ${g.tag ? `<span class="pill">${g.tag}</span>` : ``}
        </div>

        <div class="actions">
          <button class="btn small primary" data-seen="${g.id}">Marcar como visto</button>
          <button class="btn small" data-fav="${g.id}">${fav ? "‚òÖ Favorito" : "‚òÜ Favoritar"}</button>
          ${isFT ? `<span class="pill danger">Final</span>` : ``}
        </div>

        ${oddsBox}
      `;

      // handlers
      card.querySelector("[data-seen]")?.addEventListener("click", () => {
        state.history.add(String(g.id));
        saveLocal();
        render();
      });

      card.querySelector("[data-fav]")?.addEventListener("click", () => {
        const id = String(g.id);
        if (state.favorites.has(id)) state.favorites.delete(id);
        else state.favorites.add(id);
        saveLocal();
        render();
      });

      list.appendChild(card);
    }
  }

  async function load(){
    const meta = document.getElementById("meta");
    meta.textContent = "Carregando jogos‚Ä¶";

    // cache busting pra sempre pegar o mais novo
    const url = `./jogos.json?_=${Date.now()}`;

    try{
      const r = await fetch(url, { cache: "no-store" });
      const data = await r.json();
      state.data = data;

      const err = data.error ? ` ‚Ä¢ ERRO: ${data.error}` : "";
      meta.innerHTML = `Fonte autom√°tica (GitHub Action). √öltima atualiza√ß√£o: <b>${data.updatedAt || "‚Äî"}</b> ‚Ä¢ Fonte: <b>${data.source || "‚Äî"}</b> ‚Ä¢ Jogos: <b>${data.gamesCount ?? (data.games?.length ?? 0)}</b>${err}`;

      render();
    }catch(e){
      meta.textContent = "Falha ao carregar jogos.json";
      document.getElementById("list").innerHTML = `<div class="card"><div class="title" style="font-size:26px;">Erro</div><div class="sub">${String(e)}</div></div>`;
    }
  }

  // UI
  document.getElementById("refresh").addEventListener("click", load);
  document.getElementById("clear").addEventListener("click", () => { document.getElementById("q").value=""; render(); });
  document.getElementById("q").addEventListener("input", () => render());

  document.querySelectorAll(".tab").forEach(t => {
    t.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
      t.classList.add("active");
      state.tab = t.dataset.tab;
      state.view = "jogos";
      render();
    });
  });

  // Bottom bar
  document.getElementById("goJogos").addEventListener("click", () => { state.view="jogos"; render(); });

  // Menu modal
  const modal = document.getElementById("modal");
  document.getElementById("openMenu").addEventListener("click", () => modal.classList.add("show"));
  document.getElementById("closeMenu").addEventListener("click", () => modal.classList.remove("show"));
  modal.addEventListener("click", (e) => { if (e.target === modal) modal.classList.remove("show"); });

  document.querySelectorAll(".sheet .item").forEach(it => {
    it.addEventListener("click", () => {
      const nav = it.dataset.nav;
      state.view = nav;
      modal.classList.remove("show");
      render();
    });
  });

  load();
</script>
</body>
</html>
