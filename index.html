<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#071b1b" />
  <title>Radar PRO</title>

  <style>
    :root{
      --bg0:#061818;
      --bg1:#071f1f;

      --cardA: rgba(255,255,255,.060);
      --cardB: rgba(255,255,255,.030);

      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);

      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);

      --accent:#22c55e;
      --accent2:#06b6d4;
      --danger:#ef4444;
      --hot:#ec4899;
      --warn:#f59e0b;

      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 22px;
      --radius2: 16px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 650px at 25% -10%, rgba(34,197,94,.12), transparent 60%),
        radial-gradient(900px 520px at 90% 10%, rgba(6,182,212,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      overflow-x:hidden;
    }

    .wrap{ max-width:760px; margin:0 auto; padding:14px 14px 94px; }

    .surface{
      background: linear-gradient(145deg, var(--cardA), var(--cardB));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    /* ===== Topo (layout v2.4.2) ===== */
    .topShell{
      position: sticky;
      top: 10px;
      z-index: 25;
      border-radius: var(--radius);
      overflow:hidden;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px;
    }

    .brandRow{
      display:flex; align-items:center; gap:12px; min-width:0;
    }

    .logoPill{
      width:44px; height:44px; border-radius:16px;
      display:flex; align-items:center; justify-content:center;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      font-weight: 950;
      letter-spacing:.8px;
    }

    .brandText{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .brandText .title{
      font-weight: 950;
      font-size: 18px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      line-height:1.1;
    }
    .statusline{
      display:flex; align-items:center; gap:8px;
      color:var(--muted);
      font-size: 12px;
      font-weight: 900;
      white-space:nowrap;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(34,197,94,.12);
      flex: 0 0 auto;
    }

    .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 16px;
      font-weight: 900;
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      white-space:nowrap;
    }
    .btn:active{ transform: scale(.98); }
    .btn.ghost{ background: rgba(255,255,255,.03); }

    .btn.hot{
      border-color: rgba(236,72,153,.35);
      background: linear-gradient(180deg, rgba(236,72,153,.26), rgba(236,72,153,.12));
      padding: 12px 16px;
      border-radius: 18px;
      font-weight: 950;
    }

    .iconBtn{
      width:44px; height:44px;
      display:flex; align-items:center; justify-content:center;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      position:relative;
    }

    .badgeRed{
      position:absolute;
      right:10px; top:8px;
      width:9px; height:9px;
      border-radius:999px;
      background: var(--danger);
      box-shadow: 0 0 0 6px rgba(239,68,68,.12);
    }

    /* Abas de esportes */
    .sportsTabs{
      display:flex;
      gap:12px;
      padding: 10px 10px 12px;
      overflow:auto;
      scrollbar-width:none;
    }
    .sportsTabs::-webkit-scrollbar{ display:none; }

    .sTab{
      flex: 0 0 auto;
      width: 92px;
      padding: 10px 10px 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      display:flex; flex-direction:column; align-items:center; gap:8px;
      font-weight: 950;
      color: rgba(255,255,255,.84);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .sTab .ico{
      width:42px; height:42px; border-radius: 18px;
      display:flex; align-items:center; justify-content:center;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      font-size: 18px;
    }
    .sTab.active{
      border-color: rgba(6,182,212,.35);
      background: linear-gradient(180deg, rgba(6,182,212,.16), rgba(6,182,212,.07));
    }

    /* Banner/hero */
    .hero{
      margin-top: 14px;
      padding: 14px;
      border-radius: var(--radius);
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(800px 260px at 15% 25%, rgba(6,182,212,.20), transparent 60%),
        radial-gradient(600px 220px at 85% 20%, rgba(34,197,94,.16), transparent 55%);
      opacity:.9;
      pointer-events:none;
    }
    .heroInner{ position:relative; display:flex; justify-content:space-between; gap:12px; align-items:center; }
    .heroLeft{ display:flex; flex-direction:column; gap:10px; }
    .heroChip{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      font-weight: 950;
      width: fit-content;
    }
    .heroTitle{ font-size: 22px; font-weight: 980; letter-spacing:.2px; }
    .heroSub{ color: var(--muted); font-weight: 800; }
    .heroBtn{
      border-radius: 18px;
      padding: 12px 14px;
      font-weight: 950;
      border: 1px solid rgba(6,182,212,.35);
      background: linear-gradient(180deg, rgba(6,182,212,.18), rgba(6,182,212,.08));
    }

    /* Painel filtros */
    .panel{ margin-top:14px; padding:14px; border-radius: var(--radius); position:relative; overflow:hidden; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .chips{ margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap; }
    .chip{
      padding: 10px 12px; border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      font-weight: 950; font-size: 13px;
      display:flex; align-items:center; gap:10px;
      cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent;
    }
    .chip .miniDot{ width:10px; height:10px; border-radius:999px; background: rgba(255,255,255,.22); }
    .chip.active{
      border-color: rgba(6,182,212,.35);
      background: linear-gradient(180deg, rgba(6,182,212,.16), rgba(6,182,212,.07));
    }
    .chip.active.green{
      border-color: rgba(34,197,94,.40);
      background: linear-gradient(180deg, rgba(34,197,94,.18), rgba(34,197,94,.08));
    }
    .chip.active .miniDot{ background: var(--accent2); }
    .chip.active.green .miniDot{ background: var(--accent); }

    .searchWrap{ display:flex; gap:10px; align-items:center; width:100%; margin-top:12px; }
    .search{
      flex: 1 1 auto; display:flex;
      padding: 10px 12px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }
    .search input{
      width:100%; border:0; outline:none;
      background: transparent; color: var(--text);
      font-size: 14px; font-weight: 800;
    }

    .meta{ margin-top:10px; color: var(--muted); font-size: 13px; font-weight: 800; line-height: 1.35; }

    /* Aviso discreto do fallback */
    .fallbackNote{
      display:inline-flex; align-items:center; gap:8px;
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(245,158,11,.30);
      background: rgba(245,158,11,.10);
      color: rgba(255,255,255,.86);
      font-weight: 900;
      font-size: 12px;
      width: fit-content;
    }

    /* Sort row */
    .sortRow{
      margin-top:12px;
      display:flex; gap:10px; align-items:center;
    }
    .sortSelect{
      flex:1 1 auto;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.88);
      font-weight: 950;
      appearance:none;
      outline:none;
    }

    /* Lista */
    .list{ margin-top: 14px; display:flex; flex-direction:column; gap: 12px; }

    .game{ border-radius: var(--radius); overflow:hidden; }
    .gameHeader{ padding: 14px 14px 10px; background: transparent; }
    .gameTop{ display:flex; justify-content:space-between; gap: 12px; align-items:flex-start; }

    .teamsWrap{ display:flex; gap:12px; align-items:flex-start; min-width:0; }
    .teamIcons{
      display:flex; flex-direction:column; gap:10px; padding-top:2px;
    }
    .tIcon{
      width:34px; height:34px; border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      font-size: 16px;
      opacity:.95;
    }

    .teams{
      font-weight: 980; font-size: 18px; line-height: 1.15; letter-spacing:.15px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .sub{
      color: var(--muted);
      margin-top: 8px;
      font-size: 13px;
      font-weight: 850;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }

    .badgeLive{ display:flex; flex-direction:column; align-items:flex-end; gap:8px; min-width: 118px; }
    .liveTag{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px; border-radius: 999px;
      border: 1px solid rgba(239,68,68,.35);
      background: rgba(239,68,68,.12);
      font-weight: 980; font-size: 12px; letter-spacing:.3px; white-space:nowrap;
    }
    .liveTag .ldot{
      width:10px; height:10px; border-radius:999px;
      background: var(--danger);
      box-shadow: 0 0 0 6px rgba(239,68,68,.12);
    }

    .scorePill{
      display:inline-flex; align-items:center; gap:10px;
      padding: 7px 10px; border-radius: 14px;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.14);
      font-weight: 980; font-size: 13px; white-space:nowrap;
    }
    .scorePill .min{ color: rgba(255,255,255,.80); font-weight: 900; }

    .pillDate{
      display:inline-flex; align-items:center;
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      color: rgba(255,255,255,.80);
      font-weight: 900; font-size: 12px; white-space:nowrap;
    }

    .oddsRow{
      margin: 10px 14px 0;
      border-top: 1px solid rgba(255,255,255,.06);
      padding-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:0;
      overflow:hidden;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.12);
    }
    .odd{
      padding: 12px 10px;
      display:flex; justify-content:space-between; align-items:center;
      font-weight: 950;
      color: rgba(255,255,255,.88);
      border-right: 1px solid rgba(255,255,255,.06);
    }
    .odd:last-child{ border-right:0; }
    .odd b{ color: rgba(6,182,212,.95); }

    .gameActions{
      padding: 12px 14px 12px;
      display:flex; gap:10px; flex-wrap:wrap;
      background: transparent;
    }
    .gameActions .btn{ flex: 1 1 140px; justify-content:center; text-align:center; padding: 12px 14px; border-radius: 18px; }

    .btn.primary{
      border-color: rgba(34,197,94,.35);
      background: linear-gradient(180deg, rgba(34,197,94,.26), rgba(34,197,94,.12));
    }

    .detailsWrap{ display:none; }
    .detailsWrap.open{ display:block; }

    .miniTabs{
      display:flex; gap:10px;
      padding: 10px 14px 12px;
      border-top: 1px solid var(--stroke);
      background: transparent;
      flex-wrap:wrap;
    }
    .tab{
      padding: 8px 10px; border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      font-weight: 900; font-size: 12px;
      cursor:pointer; user-select:none;
    }
    .tab.active{
      border-color: rgba(6,182,212,.38);
      background: linear-gradient(180deg, rgba(6,182,212,.16), rgba(6,182,212,.07));
    }

    .tabContent{
      padding: 10px 14px 14px;
      color: var(--muted);
      font-size: 13px; font-weight: 750;
      display:none;
      background: transparent;
    }
    .tabContent.active{ display:block; }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px 14px; }
    .kv{
      display:flex; justify-content:space-between; gap:10px;
      padding: 9px 10px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.78);
      font-weight: 850;
    }
    .kv b{ color: rgba(255,255,255,.92); }

    .empty{
      padding: 16px;
      border-radius: var(--radius);
      border: 1px dashed rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      color: var(--muted);
      text-align:center;
      font-weight: 950;
    }

    /* Bottom nav */
    .bottomNav{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      width: min(760px, calc(100% - 28px));
      padding: 10px;
      border-radius: 22px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.40);
      backdrop-filter: blur(12px);
      display:flex; gap:10px;
      box-shadow: var(--shadow);
      z-index: 30;
    }
    .navBtn{
      flex: 1 1 0;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.86);
      font-weight: 950;
      display:flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer; user-select:none;
    }
    .navBtn.active{
      border-color: rgba(6,182,212,.38);
      background: linear-gradient(180deg, rgba(6,182,212,.16), rgba(6,182,212,.07));
    }

    /* Menu modal */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index: 50;
    }
    .modalOverlay.show{ display:flex; }
    .modal{
      width: min(760px, calc(100% - 28px));
      margin-bottom: 14px;
      border-radius: 22px;
      border: 1px solid var(--stroke);
      background: rgba(8,24,24,.96);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding: 14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom: 1px solid var(--stroke);
    }
    .modalHead b{ font-size: 15px; letter-spacing:.2px; }
    .modalBody{ padding: 12px 14px 14px; display:flex; flex-direction:column; gap:10px; }
    .menuItem{
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      font-weight: 900;
      display:flex; align-items:center; justify-content:space-between;
      cursor:pointer; user-select:none;
    }
    .menuItem small{ color: var(--muted); font-weight: 800; }

    @media (max-width: 420px){
      .heroTitle{ font-size: 20px; }
      .teams{ font-size: 17px; }
      .badgeLive{ min-width: 112px; }
      .sTab{ width: 88px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topShell surface">
      <div class="topbar">
        <div class="brandRow">
          <div class="logoPill">RD</div>
          <div class="brandText">
            <div class="title">Radar PRO</div>
            <div class="statusline">
              <span class="dot"></span>
              <span>Online</span>
            </div>
          </div>
        </div>

        <div style="display:flex; gap:10px; align-items:center;">
          <div class="iconBtn" id="openMenu" title="Menu">‚ãÆ</div>
          <div class="iconBtn" id="giftBtn" title="Benef√≠cios"><span class="badgeRed"></span>üéÅ</div>
          <button class="btn hot" id="enterBtn">ENTRAR</button>
        </div>
      </div>

      <div class="sportsTabs" id="sportsTabs">
        <div class="sTab active" data-sport="all"><div class="ico">üõ∞Ô∏è</div><div>Tudo</div></div>
        <div class="sTab" data-sport="football"><div class="ico">‚öΩ</div><div>Futebol</div></div>
        <div class="sTab" data-sport="basket"><div class="ico">üèÄ</div><div>Basquete</div></div>
        <div class="sTab" data-sport="volley"><div class="ico">üèê</div><div>V√¥lei</div></div>
        <div class="sTab" data-sport="tennis"><div class="ico">üéæ</div><div>T√™nis</div></div>
      </div>
    </div>

    <div class="hero surface" id="hero">
      <div class="heroInner">
        <div class="heroLeft">
          <div class="heroChip">üóìÔ∏è Pr√≥ximos</div>
          <div class="heroTitle" id="heroTitle">Pr√≥ximas 24h</div>
          <div class="heroSub">Filtre por pa√≠s/ligas e encontre r√°pido.</div>
        </div>
        <button class="btn heroBtn" id="heroBtn">Buscar</button>
      </div>
    </div>

    <div class="panel surface">
      <div class="chips">
        <div class="chip green active" id="chipUpcoming"><span class="miniDot"></span>üóìÔ∏è Pr√≥ximos (24h)</div>
        <div class="chip" id="chipLive"><span class="miniDot"></span>üî¥ Ao vivo</div>
        <div class="chip" id="chipBrazil"><span class="miniDot"></span>üáßüá∑ Brasil</div>
        <div class="chip" id="chipEurope"><span class="miniDot"></span>üá™üá∫ Europa</div>
        <div class="chip" id="chipAll"><span class="miniDot"></span>üåç Todos</div>
      </div>

      <div class="searchWrap">
        <div class="search">
          <input id="q" type="text" placeholder="Buscar time, liga ou pa√≠s..." autocomplete="off" />
        </div>
        <button class="btn ghost" id="clearBtn">Limpar</button>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="refreshBtn">Atualizar</button>
        <button class="btn ghost" id="autoBtn">Auto: OFF</button>
        <button class="btn ghost" id="infoBtn">Info</button>
      </div>

      <div class="meta" id="meta">Carregando‚Ä¶</div>
      <div id="fallbackNoteWrap"></div>

      <div class="sortRow">
        <select class="sortSelect" id="sortSel">
          <option value="time">Hor√°rio primeiro</option>
          <option value="popular">Popular primeiro</option>
        </select>
        <div class="iconBtn" id="gearBtn" title="Config">‚öôÔ∏è</div>
        <div class="iconBtn" id="toolBtn" title="Ferramentas">üßæ</div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="btn ghost" id="scrollTopBtn" style="width:100%;">Voltar pro topo</button>
      </div>
    </div>

    <div class="list" id="list"></div>
  </div>

  <div class="bottomNav">
    <div class="navBtn active" id="navHome">üè† In√≠cio</div>
    <div class="navBtn" id="navLive">üî¥ Ao vivo</div>
    <div class="navBtn" id="navGames">üóìÔ∏è Jogos</div>
    <div class="navBtn" id="navPro">üíé PRO</div>
  </div>

  <div class="modalOverlay" id="menuOverlay">
    <div class="modal">
      <div class="modalHead">
        <b>Menu</b>
        <button class="btn ghost" id="closeMenu">Fechar</button>
      </div>
      <div class="modalBody">
        <div class="menuItem" id="menuFav"><span>‚≠ê Favoritos</span><small>ver salvos</small></div>
        <div class="menuItem" id="menuGames"><span>üóìÔ∏è Jogos</span><small>lista principal</small></div>
        <div class="menuItem" id="menuAbout"><span>‚ÑπÔ∏è Sobre</span><small>fonte</small></div>
      </div>
    </div>
  </div>

  <script>
    /* =======================
       Radar PRO v2.4.5
       - Layout id√™ntico v2.4.2
       - Fallback: se games=[] usa √∫ltimo cache (24h)
    ======================= */

    const TZ = "America/Sao_Paulo";
    const LS_KEY = "rjpro_state_v245";
    const CACHE_KEY = "rjpro_games_cache_v245";
    const CACHE_TTL_MS = 24 * 60 * 60 * 1000; // 24h

    const state = {
      mode: "upcoming",   // upcoming | live | home | pro
      region: "all",      // all | brazil | europe
      sport: "all",       // all | football | basket | volley | tennis
      q: "",
      favorites: {},
      autoOn: false,
      sort: "time"        // time | popular
    };

    let data = null;
    let allGames = [];
    let autoTimer = null;
    let usingFallback = false;

    const $ = (id) => document.getElementById(id);

    function saveState(){ try{ localStorage.setItem(LS_KEY, JSON.stringify({...state})); }catch(e){} }
    function loadState(){ try{ const raw = localStorage.getItem(LS_KEY); if(raw) Object.assign(state, JSON.parse(raw)); }catch(e){} }

    function fmtBrtDate(d){
      return new Intl.DateTimeFormat("pt-BR", { timeZone: TZ, day:"2-digit", month:"2-digit", year:"numeric" }).format(d);
    }
    function fmtBrtTime(d){
      return new Intl.DateTimeFormat("pt-BR", { timeZone: TZ, hour:"2-digit", minute:"2-digit" }).format(d);
    }
    function brtDayKey(d){
      const parts = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).formatToParts(d);
      const y = parts.find(p=>p.type==="year").value;
      const m = parts.find(p=>p.type==="month").value;
      const da = parts.find(p=>p.type==="day").value;
      return `${y}-${m}-${da}`;
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function getKickoffMs(g){
      if(typeof g.kickoffTs === "number") return g.kickoffTs;
      return null;
    }
    function gameId(g){
      if(g.id) return String(g.id);
      return `${g.home||""}__${g.away||""}__${g.league||""}__${g.date||""}__${g.time||""}`;
    }
    function isFinished(g){
      const st = (g.status||"").toUpperCase();
      return st === "FT" || st === "AET" || st === "PEN";
    }

    function isLikelyStaleLive(g){
      const st = (g.status||"").toUpperCase();
      const k = getKickoffMs(g);
      if(!k) return false;

      const now = Date.now();
      const ageMin = (now - k) / 60000;
      const el = (typeof g.elapsed === "number") ? g.elapsed : null;

      const liveSet = ["1H","2H","HT","ET","BT","P","LIVE","IN_PLAY"];
      if(!liveSet.includes(st)) return false;

      if(el !== null && el >= 90 && ageMin >= 120) return true;
      if(st === "ET" && ageMin >= 210) return true;
      if(el === null && ageMin >= 165) return true;

      return false;
    }

    function isLiveGame(g){
      if(isFinished(g)) return false;
      if(isLikelyStaleLive(g)) return false;
      if(g.isLive === true) return true;

      const st = (g.status||"").toUpperCase();
      if(["1H","2H","HT","ET","P","LIVE","IN_PLAY","BT"].includes(st)) return true;
      if(typeof g.elapsed === "number" && st !== "FT") return true;
      return false;
    }

    function minutesText(g){
      if(isLikelyStaleLive(g)) return "FT";
      if(typeof g.elapsed === "number" && g.elapsed > 0) return `${g.elapsed}'`;
      const st = (g.status||"").toUpperCase();
      if(st==="HT") return "HT";
      if(st==="FT") return "FT";
      return st || "‚Äî";
    }

    function scoreText(g){
      const sh = (typeof g.scoreHome === "number") ? g.scoreHome : null;
      const sa = (typeof g.scoreAway === "number") ? g.scoreAway : null;
      if(sh===null || sa===null) return null;
      return `${sh}‚Äì${sa}`;
    }

    function regionMatch(g){
      const c = (g.country||"").toLowerCase();
      if(state.region==="all") return true;
      if(state.region==="brazil") return c.includes("brazil") || c.includes("brasil");
      if(state.region==="europe"){
        const eu = ["england","scotland","spain","france","italy","germany","portugal","netherlands","belgium","switzerland","austria","sweden","norway","denmark","finland","poland","czech","slovakia","hungary","romania","bulgaria","greece","turkey","croatia","serbia","slovenia","ukraine"];
        return eu.some(x => c.includes(x));
      }
      return true;
    }

    function sportMatch(g){
      if(state.sport==="all") return true;
      if(state.sport==="football") return true; // feed atual √© futebol
      return false;
    }

    function qMatch(g){
      const q = (state.q||"").trim().toLowerCase();
      if(!q) return true;
      const hay = `${g.home||""} ${g.away||""} ${g.league||""} ${g.country||""}`.toLowerCase();
      return hay.includes(q);
    }

    function popularityScore(g){
      const league = (g.league||"").toLowerCase();
      const country = (g.country||"").toLowerCase();
      let s = 0;
      const top = ["premier","laliga","serie a","bundesliga","ligue 1","champions","europa","brasile","libertadores","copa do brasil"];
      if(top.some(k=> league.includes(k))) s += 50;
      if(country.includes("brazil")||country.includes("brasil")) s += 20;
      if(isLiveGame(g)) s += 30;
      const k = getKickoffMs(g);
      if(k){
        const diffH = Math.abs((k - Date.now())/3600000);
        s += Math.max(0, 20 - diffH);
      }
      return s;
    }

    /* ===== Cache fallback ===== */
    function writeCache(payload){
      try{
        localStorage.setItem(CACHE_KEY, JSON.stringify(payload));
      }catch(e){}
    }
    function readCache(){
      try{
        const raw = localStorage.getItem(CACHE_KEY);
        if(!raw) return null;
        const obj = JSON.parse(raw);
        if(!obj || typeof obj !== "object") return null;
        if(typeof obj.ts !== "number" || !Array.isArray(obj.games)) return null;
        if(Date.now() - obj.ts > CACHE_TTL_MS) return null;
        return obj;
      }catch(e){
        return null;
      }
    }

    /* ===== Extrator robusto ===== */
    function isMatchLike(obj){
      if(!obj || typeof obj !== "object") return false;
      if((obj.home && obj.away) || (obj.homeTeam && obj.awayTeam)) return true;
      if(obj.teams && obj.teams.home && obj.teams.away) return true;
      if(obj.fixture && obj.teams) return true;
      return false;
    }

    function deepFindArray(root){
      const seen = new Set();
      function walk(node){
        if(!node || typeof node !== "object") return null;
        if(seen.has(node)) return null;
        seen.add(node);

        if(Array.isArray(node)){
          if(node.length && node.some(isMatchLike)) return node;
          for(const it of node){
            const r = walk(it);
            if(r) return r;
          }
          return null;
        }

        const preferredKeys = ["games","fixtures","matches","response","data","items","results"];
        for(const k of preferredKeys){
          if(node[k] !== undefined){
            const r = walk(node[k]);
            if(r) return r;
          }
        }

        for(const k of Object.keys(node)){
          const r = walk(node[k]);
          if(r) return r;
        }
        return null;
      }
      return walk(root);
    }

    function normalizeOne(item){
      if(item.home && item.away){
        const g = {...item};
        if(typeof g.kickoffTs !== "number"){
          if(g.date && g.time){
            const ms = Date.parse(`${g.date}T${g.time}:00-03:00`);
            if(!Number.isNaN(ms)) g.kickoffTs = ms;
          }
        }
        return g;
      }

      const fx = item.fixture || {};
      const teams = item.teams || {};
      const lg = item.league || {};
      const goals = item.goals || {};
      const st = (fx.status || item.status || {});
      const ts = fx.timestamp ? (fx.timestamp * 1000) : null;

      const homeName = teams.home?.name || item.homeTeam?.name || item.home || "‚Äî";
      const awayName = teams.away?.name || item.awayTeam?.name || item.away || "‚Äî";

      const homeGoals = (typeof goals.home === "number") ? goals.home : (typeof item.scoreHome === "number" ? item.scoreHome : null);
      const awayGoals = (typeof goals.away === "number") ? goals.away : (typeof item.scoreAway === "number" ? item.scoreAway : null);

      let date = null, time = null;
      if(fx.date){
        const d = new Date(fx.date);
        const parts = new Intl.DateTimeFormat("en-CA",{ timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).formatToParts(d);
        const y = parts.find(p=>p.type==="year").value;
        const m = parts.find(p=>p.type==="month").value;
        const da = parts.find(p=>p.type==="day").value;
        date = `${y}-${m}-${da}`;
        time = new Intl.DateTimeFormat("pt-BR",{ timeZone: TZ, hour:"2-digit", minute:"2-digit" }).format(d);
      }

      const short = (typeof st.short === "string") ? st.short : (typeof st === "string" ? st : "");
      const elapsed = (typeof st.elapsed === "number") ? st.elapsed : (typeof item.elapsed === "number" ? item.elapsed : null);

      return {
        id: fx.id ?? item.id ?? null,
        home: homeName,
        away: awayName,
        league: lg.name ?? item.league ?? "‚Äî",
        country: lg.country ?? item.country ?? "‚Äî",
        date: date ?? item.date ?? null,
        time: time ?? item.time ?? null,
        kickoffTs: (typeof item.kickoffTs === "number") ? item.kickoffTs : (ts ?? null),
        status: short || st.long || item.status || "",
        elapsed: elapsed,
        scoreHome: homeGoals,
        scoreAway: awayGoals,
        isLive: (short === "1H" || short === "2H" || short === "HT" || short === "ET" || short === "P" || short === "LIVE")
      };
    }

    function normalizeGamesArray(arr){
      return arr
        .filter(x => x && typeof x === "object")
        .map(normalizeOne)
        .filter(g => g && g.home && g.away);
    }

    async function loadJogosJson(force=false){
      usingFallback = false;

      const bust = force ? `?t=${Date.now()}` : "";
      const urls = [`./jogos.json${bust}`, `jogos.json${bust}`];

      let lastErr = null;

      for(const url of urls){
        try{
          const res = await fetch(url, { cache:"no-store" });
          if(!res.ok) throw new Error(`HTTP ${res.status}`);
          const j = await res.json();
          data = j;

          let rawArr =
            (Array.isArray(j.games) && j.games) ||
            (Array.isArray(j.fixtures) && j.fixtures) ||
            (Array.isArray(j.matches) && j.matches) ||
            (Array.isArray(j.response) && j.response) ||
            (Array.isArray(j.data) && j.data) ||
            null;

          if(!rawArr) rawArr = deepFindArray(j);

          const normalized = rawArr ? normalizeGamesArray(rawArr) : [];
          if(normalized.length > 0){
            allGames = normalized;

            // salva cache bom (n√£o salva vazio)
            writeCache({
              ts: Date.now(),
              meta: {
                updatedAt: j.updatedAt || j.updated_at || null,
                source: j.source || j.fonte || "API-Football"
              },
              games: allGames
            });

            return;
          }

          // Se JSON veio mas games vazio -> tenta cache
          const cache = readCache();
          if(cache && Array.isArray(cache.games) && cache.games.length > 0){
            usingFallback = true;
            allGames = cache.games;
            // Mant√©m o meta do JSON atual (atualizado) mas sinaliza fallback
            return;
          }

          allGames = [];
          return;
        }catch(e){
          lastErr = e;
        }
      }

      // falhou fetch -> tenta cache
      const cache = readCache();
      if(cache && Array.isArray(cache.games) && cache.games.length > 0){
        usingFallback = true;
        data = data || { updatedAt: cache.meta?.updatedAt || "‚Äî", source: cache.meta?.source || "API-Football" };
        allGames = cache.games;
        return;
      }

      data = null;
      allGames = [];
      throw lastErr || new Error("Falha ao carregar jogos.json");
    }

    function setActiveChips(){
      $("chipUpcoming").classList.toggle("active", state.mode==="upcoming" || state.mode==="home");
      $("chipUpcoming").classList.toggle("green", true);
      $("chipLive").classList.toggle("active", state.mode==="live");

      $("chipBrazil").classList.toggle("active", state.region==="brazil");
      $("chipEurope").classList.toggle("active", state.region==="europe");
      $("chipAll").classList.toggle("active", state.region==="all");

      $("autoBtn").textContent = `Auto: ${state.autoOn ? "ON" : "OFF"}`;
      $("autoBtn").classList.toggle("primary", state.autoOn);

      $("navHome").classList.toggle("active", state.mode==="home");
      $("navLive").classList.toggle("active", state.mode==="live");
      $("navGames").classList.toggle("active", state.mode==="upcoming");
      $("navPro").classList.toggle("active", state.mode==="pro");
    }

    function updateHero(){
      if(state.mode==="live"){
        $("heroTitle").textContent = "Jogos ao vivo";
        $("hero").querySelector(".heroChip").textContent = "üî¥ Ao vivo";
      }else{
        $("heroTitle").textContent = "Pr√≥ximas 24h";
        $("hero").querySelector(".heroChip").textContent = "üóìÔ∏è Pr√≥ximos";
      }
    }

    function renderFallbackNote(){
      const wrap = $("fallbackNoteWrap");
      wrap.innerHTML = "";
      if(usingFallback){
        const div = document.createElement("div");
        div.className = "fallbackNote";
        div.textContent = "‚ö† Usando √∫ltimos dados (backup) porque a fonte retornou 0 jogos.";
        wrap.appendChild(div);
      }
    }

    function updateMeta(){
      const metaEl = $("meta");
      if(!data){
        metaEl.textContent = "Sem dados ainda. Clique em Atualizar.";
        renderFallbackNote();
        return;
      }

      const upd = data.updatedAt || data.updated_at || "‚Äî";
      const src = data.source || data.fonte || "API-Football";
      const now = Date.now();

      let liveClean=0, todayCount=0, next24=0;
      const todayKey = brtDayKey(new Date());

      for(const g of allGames){
        const k = getKickoffMs(g);
        if(isLiveGame(g)) liveClean++;
        if(g.date === todayKey) todayCount++;
        if(k && k >= now && k <= (now + 24*3600*1000)) next24++;
      }

      metaEl.innerHTML =
        `Atualizado: <b>${escapeHtml(upd)}</b> ‚Ä¢ Fonte: <b>${escapeHtml(src)}</b><br>` +
        `Jogos: <b>${allGames.length}</b> ‚Ä¢ Hoje: <b>${todayCount}</b> ‚Ä¢ Pr√≥x 24h: <b>${next24}</b> ‚Ä¢ Ao vivo (limpo): <b>${liveClean}</b>`;

      renderFallbackNote();
    }

    function filterUpcoming24(){
      const now = Date.now();
      const max = now + 24 * 3600 * 1000;

      let list = allGames.filter(g => {
        if(!regionMatch(g) || !sportMatch(g) || !qMatch(g)) return false;
        if(isLiveGame(g)) return false;
        const k = getKickoffMs(g);
        if(!k) return false;
        if(isFinished(g)) return false;
        return (k >= now && k <= max);
      });

      if(state.sort==="popular"){
        list.sort((a,b)=> popularityScore(b)-popularityScore(a));
      }else{
        list.sort((a,b)=> (getKickoffMs(a)||0) - (getKickoffMs(b)||0));
      }
      return list;
    }

    function filterLive(){
      let list = allGames.filter(g => {
        if(!regionMatch(g) || !sportMatch(g) || !qMatch(g)) return false;
        return isLiveGame(g);
      });

      if(state.sort==="popular"){
        list.sort((a,b)=> popularityScore(b)-popularityScore(a));
      }else{
        list.sort((a,b)=> ((b.elapsed||0) - (a.elapsed||0)));
      }
      return list;
    }

    function renderEmpty(msg){
      $("list").innerHTML = `<div class="empty">${escapeHtml(msg)}</div>`;
    }

    function renderGameCard(g){
      const id = gameId(g);
      const live = isLiveGame(g);
      const k = getKickoffMs(g);

      const dStr = g.date ? fmtBrtDate(new Date(`${g.date}T12:00:00-03:00`)) : "‚Äî";
      const tStr = k ? fmtBrtTime(new Date(k)) : (g.time || "‚Äî");

      const score = scoreText(g);
      const mins = minutesText(g);
      const fav = !!state.favorites[id];

      const o1 = g.odds1 ?? "‚Äî";
      const ox = g.oddsX ?? "‚Äî";
      const o2 = g.odds2 ?? "‚Äî";

      const el = document.createElement("div");
      el.className = "game surface";
      el.innerHTML = `
        <div class="gameHeader">
          <div class="gameTop">
            <div class="teamsWrap" style="min-width:0">
              <div class="teamIcons" aria-hidden="true">
                <div class="tIcon">‚öΩ</div>
                <div class="tIcon">‚öΩ</div>
              </div>
              <div style="min-width:0">
                <div class="teams">${escapeHtml(g.home||"")} <span style="opacity:.6">x</span> ${escapeHtml(g.away||"")}</div>
                <div class="sub">
                  <span>${escapeHtml(g.league||"‚Äî")}</span>
                  <span style="opacity:.5">‚Ä¢</span>
                  <span>${escapeHtml(g.country||"‚Äî")}</span>
                  <span style="opacity:.5">‚Ä¢</span>
                  <span><b>${escapeHtml(tStr)}</b></span>
                  <span class="pillDate">${escapeHtml(dStr)}</span>
                </div>
              </div>
            </div>

            <div class="badgeLive">
              ${live ? `<div class="liveTag"><span class="ldot"></span>AO VIVO</div>` : ``}
              ${(live && (score || mins)) ? `
                <div class="scorePill">
                  <span>${score ? escapeHtml(score) : "‚Äî"}</span>
                  <span class="min">‚Ä¢ ${escapeHtml(mins)}</span>
                </div>
              ` : ``}
            </div>
          </div>
        </div>

        <div class="oddsRow" aria-label="Odds 1X2">
          <div class="odd"><span>1</span><b>${escapeHtml(String(o1))}</b></div>
          <div class="odd"><span>X</span><b>${escapeHtml(String(ox))}</b></div>
          <div class="odd"><span>2</span><b>${escapeHtml(String(o2))}</b></div>
        </div>

        <div class="gameActions">
          <button class="btn ghost" data-act="details">Detalhes</button>
          <button class="btn ${fav ? "primary":"ghost"}" data-act="fav">${fav ? "‚òÖ Favoritado" : "‚òÜ Favoritar"}</button>
        </div>

        <div class="detailsWrap" data-details>
          <div class="miniTabs" data-tabs>
            <div class="tab active" data-tab="insights">Insights / Odds</div>
            <div class="tab" data-tab="maismenos">Mais/Menos</div>
            <div class="tab" data-tab="forma">Forma</div>
          </div>

          <div class="tabContent active" data-content="insights">
            <div class="grid2">
              <div class="kv"><span>Over 1,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Under 2,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Over 2,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>BTTS</span><b>‚Äî%</b></div>
            </div>
            <div style="margin-top:10px; color:rgba(255,255,255,.60); font-weight:750;">
              Em PRO: odds reais, previs√£o e mercados extras.
            </div>
          </div>

          <div class="tabContent" data-content="maismenos">
            <div class="grid2">
              <div class="kv"><span>Over 0,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Over 3,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Under 1,5</span><b>‚Äî%</b></div>
              <div class="kv"><span>Under 3,5</span><b>‚Äî%</b></div>
            </div>
            <div style="margin-top:10px; color:rgba(255,255,255,.60); font-weight:750;">
              Em PRO: linhas completas e odds reais.
            </div>
          </div>

          <div class="tabContent" data-content="forma">
            <div style="display:grid; gap:10px">
              <div class="kv"><span>Forma (casa)</span><b>‚Äî</b></div>
              <div class="kv"><span>Forma (fora)</span><b>‚Äî</b></div>
              <div class="kv"><span>H2H (√∫ltimos)</span><b>‚Äî</b></div>
            </div>
            <div style="margin-top:10px; color:rgba(255,255,255,.60); font-weight:750;">
              Em PRO: dados reais + tend√™ncias.
            </div>
          </div>
        </div>
      `;

      const detailsWrap = el.querySelector('[data-details]');
      const btnDetails = el.querySelector('[data-act="details"]');

      btnDetails.onclick = () => {
        const open = detailsWrap.classList.toggle("open");
        btnDetails.textContent = open ? "Fechar" : "Detalhes";
      };

      el.querySelector('[data-act="fav"]').onclick = () => {
        state.favorites[id] = !state.favorites[id];
        saveState();
        render();
      };

      const tabs = el.querySelectorAll(".tab");
      const contents = el.querySelectorAll(".tabContent");
      tabs.forEach(t => {
        t.onclick = () => {
          tabs.forEach(x=>x.classList.remove("active"));
          t.classList.add("active");
          const key = t.getAttribute("data-tab");
          contents.forEach(c=>{
            c.classList.toggle("active", c.getAttribute("data-content")===key);
          });
        };
      });

      return el;
    }

    function render(){
      setActiveChips();
      updateHero();
      updateMeta();

      if(!data){
        renderEmpty("Sem dados ainda. Clique em Atualizar.");
        return;
      }

      let list = [];
      if(state.mode==="live"){
        list = filterLive();
        if(list.length===0){
          renderEmpty("Nada ao vivo agora com esses filtros.");
          return;
        }
      }else{
        list = filterUpcoming24();
        if(list.length===0){
          renderEmpty("Sem jogos nas pr√≥ximas 24h com esses filtros.");
          return;
        }
      }

      const root = $("list");
      root.innerHTML = "";
      for(const g of list) root.appendChild(renderGameCard(g));
    }

    function startAuto(){
      stopAuto();
      const interval = (state.mode === "live") ? 30_000 : 60_000;
      autoTimer = setInterval(async () => {
        try{
          await loadJogosJson(true);
          render();
        }catch(e){}
      }, interval);
    }
    function stopAuto(){
      if(autoTimer) clearInterval(autoTimer);
      autoTimer = null;
    }

    function setSportActive(){
      document.querySelectorAll(".sTab").forEach(t=>{
        t.classList.toggle("active", t.getAttribute("data-sport")===state.sport);
      });
    }

    function wire(){
      document.querySelectorAll(".sTab").forEach(t=>{
        t.onclick = () => {
          state.sport = t.getAttribute("data-sport");
          saveState();
          setSportActive();
          render();
        };
      });

      $("chipUpcoming").onclick = () => { state.mode="upcoming"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("chipLive").onclick = () => { state.mode="live"; saveState(); render(); if(state.autoOn) startAuto(); };

      $("chipBrazil").onclick = () => { state.region="brazil"; saveState(); render(); };
      $("chipEurope").onclick = () => { state.region="europe"; saveState(); render(); };
      $("chipAll").onclick = () => { state.region="all"; saveState(); render(); };

      $("q").addEventListener("input", () => {
        state.q = $("q").value;
        saveState();
        render();
      });

      $("clearBtn").onclick = () => {
        state.q = "";
        $("q").value = "";
        saveState();
        render();
      };

      $("sortSel").value = state.sort || "time";
      $("sortSel").onchange = () => {
        state.sort = $("sortSel").value;
        saveState();
        render();
      };

      $("refreshBtn").onclick = async () => {
        $("refreshBtn").textContent = "Atualizando‚Ä¶";
        try{
          await loadJogosJson(true);
          render();
        }catch(e){
          renderEmpty("Erro ao atualizar dados.");
        }finally{
          $("refreshBtn").textContent = "Atualizar";
        }
      };

      $("autoBtn").onclick = () => {
        state.autoOn = !state.autoOn;
        saveState();
        setActiveChips();
        if(state.autoOn) startAuto();
        else stopAuto();
      };

      $("infoBtn").onclick = () => {
        const upd = data?.updatedAt || data?.updated_at || "‚Äî";
        const src = data?.source || data?.fonte || "API-Football";
        alert(`Radar PRO v2.4.5\nFonte: ${src}\nAtualizado: ${upd}\n\nObs: Se a fonte retornar 0 jogos, o app usa backup (24h) para n√£o ficar vazio.`);
      };

      $("gearBtn").onclick = () => alert("Configura√ß√µes: ativaremos depois (layout pronto).");
      $("toolBtn").onclick = () => alert("Ferramentas: ativaremos depois (layout pronto).");
      $("giftBtn").onclick = () => alert("Benef√≠cios: ativaremos depois (layout pronto).");

      $("scrollTopBtn").onclick = () => window.scrollTo({top:0, behavior:"smooth"});
      $("heroBtn").onclick = () => window.scrollTo({top:0, behavior:"smooth"});

      $("navHome").onclick = () => { state.mode="home"; saveState(); render(); };
      $("navLive").onclick = () => { state.mode="live"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("navGames").onclick = () => { state.mode="upcoming"; saveState(); render(); if(state.autoOn) startAuto(); };
      $("navPro").onclick = () => alert("PRO: √°rea de assinatura (vamos ativar depois).");

      $("enterBtn").onclick = () => alert("Entrar/Cadastrar: vamos ativar depois (login/conta).");

      $("openMenu").onclick = () => $("menuOverlay").classList.add("show");
      $("closeMenu").onclick = () => $("menuOverlay").classList.remove("show");
      $("menuOverlay").onclick = (e) => { if(e.target === $("menuOverlay")) $("menuOverlay").classList.remove("show"); };

      $("menuFav").onclick = () => {
        alert("Favoritos: nesta vers√£o fica no bot√£o ‚òÜ dentro dos jogos. (√Årea completa depois.)");
        $("menuOverlay").classList.remove("show");
      };
      $("menuGames").onclick = () => { state.mode="upcoming"; saveState(); render(); $("menuOverlay").classList.remove("show"); };
      $("menuAbout").onclick = () => {
        const upd = data?.updatedAt || data?.updated_at || "‚Äî";
        const src = data?.source || data?.fonte || "API-Football";
        alert(`Radar PRO v2.4.5\nFonte: ${src}\nAtualizado: ${upd}`);
      };
    }

    (async function init(){
      loadState();
      if(!state.mode) state.mode="upcoming";
      if(!state.region) state.region="all";
      if(!state.sport) state.sport="all";
      if(!state.favorites) state.favorites = {};
      if(!state.sort) state.sort="time";

      $("q").value = state.q || "";
      $("sortSel").value = state.sort || "time";

      wire();
      setSportActive();
      setActiveChips();
      updateHero();

      try{ await loadJogosJson(false); }catch(e){}
      render();

      if(state.autoOn) startAuto();
    })();
  </script>
</body>
  </html>
