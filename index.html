<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Radar Jogos PRO</title>
  <style>
    :root{
      --bg1:#053a34;
      --bg2:#07151b;
      --card:#0a1f28cc;
      --card2:#0a1f2888;
      --stroke:#1e3a44;
      --text:#e9f2f3;
      --muted:#a9c0c6;
      --green:#24d18b;
      --green2:#0ea56d;
      --pill:#0f2a33;
      --danger:#b14b4b;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      background: radial-gradient(1200px 600px at 50% -50%, #1aa07a55, transparent 65%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    .wrap{max-width: 720px; margin: 0 auto; padding: 22px 16px 120px;}
    header{
      text-align:center;
      padding: 22px 10px 12px;
    }
    h1{
      margin: 0;
      font-size: 46px;
      line-height: 1.05;
      letter-spacing: .5px;
      text-shadow: 0 8px 30px rgba(0,0,0,.45);
    }
    .online{
      display:inline-flex; align-items:center; gap:10px;
      margin-top:10px;
      color:var(--muted);
      font-weight:600;
      opacity:.95;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: var(--green);
      box-shadow: 0 0 0 6px rgba(36,209,139,.12);
    }

    .panel{
      margin-top: 18px;
      background: linear-gradient(180deg, rgba(10,31,40,.78), rgba(10,31,40,.55));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .search{
      flex:1;
      min-width: 210px;
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }
    .btn{
      padding: 12px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.08);
      color:var(--text);
      font-weight: 700;
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{
      background: linear-gradient(180deg, var(--green), var(--green2));
      border:none;
      color:#062019;
      box-shadow: 0 10px 24px rgba(36,209,139,.18);
    }
    .meta{
      margin-top: 10px;
      color: var(--muted);
      line-height: 1.35;
      font-weight: 600;
    }

    .tabs{margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap}
    .tab{
      padding: 10px 14px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 800;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background: rgba(36,209,139,.16);
      border-color: rgba(36,209,139,.30);
    }
    .note{
      margin-top: 12px;
      color: rgba(233,242,243,.75);
      font-weight: 650;
      font-size: 14px;
    }

    .list{margin-top: 18px; display:flex; flex-direction:column; gap:14px;}
    .card{
      background: linear-gradient(180deg, rgba(13,35,45,.85), rgba(10,31,40,.65));
      border:1px solid rgba(255,255,255,.08);
      border-radius: 26px;
      padding: 18px 16px;
      box-shadow: 0 14px 42px rgba(0,0,0,.28);
    }
    .title{
      font-size: 40px;
      line-height: 1.02;
      margin: 0 0 8px;
      letter-spacing: .2px;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-weight: 700;
      font-size: 18px;
    }
    .pills{display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; align-items:center}
    .pill{
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      font-weight: 800;
      color: var(--text);
    }
    .pill.live{background: rgba(36,209,139,.14); border-color: rgba(36,209,139,.25)}
    .pill.final{background: rgba(177,75,75,.14); border-color: rgba(177,75,75,.28)}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px;}
    .btn.small{padding: 11px 14px; border-radius: 16px; font-weight: 900}
    .btn.ghost{background: rgba(255,255,255,.06)}
    .btn.danger{background: rgba(177,75,75,.18); border-color: rgba(177,75,75,.30)}
    .btn.star{display:flex; align-items:center; gap:8px}
    .section{
      margin-top: 14px;
      background: rgba(0,0,0,.16);
      border:1px solid rgba(255,255,255,.07);
      border-radius: 20px;
      padding: 14px;
    }
    .section h3{
      margin:0 0 10px;
      font-size: 18px;
      letter-spacing:.2px;
      color: rgba(233,242,243,.90);
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 8px 12px;
      align-items:center;
      font-weight: 800;
      color: rgba(233,242,243,.85);
    }
    .grid .mut{color: rgba(169,192,198,.95); font-weight: 900}
    .empty{
      text-align:center;
      padding: 26px 12px;
      color: rgba(233,242,243,.75);
      font-weight: 800;
      border:1px dashed rgba(255,255,255,.12);
      border-radius: 22px;
      background: rgba(0,0,0,.12);
    }

    /* bottom bar */
    .bottom{
      position: fixed;
      left:0; right:0; bottom: 12px;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .bottom .bar{
      width: min(720px, calc(100% - 24px));
      display:flex; gap: 10px;
      background: rgba(8,22,28,.58);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 24px;
      padding: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      pointer-events:auto;
    }
    .bigbtn{
      flex:1;
      border-radius: 20px;
      padding: 14px 14px;
      font-weight: 950;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.06);
      color: var(--text);
      display:flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer;
      user-select:none;
    }
    .bigbtn.primary{
      background: linear-gradient(180deg, rgba(36,209,139,.95), rgba(14,165,109,.92));
      color:#062019;
      border:none;
    }
    .modal{
      position: fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items: flex-end;
      justify-content:center;
      padding: 14px;
      z-index: 999;
    }
    .modal.open{display:flex;}
    .sheet{
      width: min(720px, 100%);
      background: rgba(10,31,40,.92);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 26px;
      box-shadow: 0 20px 70px rgba(0,0,0,.5);
      padding: 14px;
      backdrop-filter: blur(12px);
    }
    .sheet h2{margin: 6px 6px 12px; font-size: 20px;}
    .item{
      width:100%;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      padding: 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 900;
      cursor:pointer;
      margin: 10px 0;
    }
    .item .right{color: rgba(169,192,198,.95); font-weight: 900}
    .close{
      margin-top: 10px;
      width:100%;
      padding: 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Radar Jogos<br/>PRO</h1>
      <div class="online"><span class="dot"></span>Online</div>
    </header>

    <section class="panel">
      <div class="row">
        <input id="q" class="search" placeholder="Buscar jogo, time, liga ou pa√≠s..." />
        <button id="clear" class="btn">Limpar</button>
        <button id="refresh" class="btn primary">Atualizar</button>
      </div>

      <div id="meta" class="meta">Carregando‚Ä¶</div>

      <div class="tabs">
        <div class="tab active" data-tab="all">Todos</div>
        <div class="tab" data-tab="br">Brasil</div>
        <div class="tab" data-tab="eu">Europa</div>
        <div class="tab" data-tab="today">Hoje</div>
        <div class="tab" data-tab="live">Ao vivo</div>
      </div>

      <div class="note">
        * Probabilidades/odds aqui s√£o <b>estimativas</b> (odd justa), baseadas nos <b>√∫ltimos 3 jogos</b> (quando dispon√≠vel). Em modo FREE, calculamos para um n√∫mero limitado de jogos por atualiza√ß√£o.
      </div>
    </section>

    <section id="list" class="list"></section>
  </div>

  <div class="bottom">
    <div class="bar">
      <button class="bigbtn primary" id="goGames">üóìÔ∏è Jogos</button>
      <button class="bigbtn" id="openMenu">‚Ä¶ Menu</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <h2>Menu</h2>
      <button class="item" data-view="games"><span>Jogos</span><span class="right">lista principal</span></button>
      <button class="item" data-view="fav"><span>Favoritos</span><span class="right">salvos</span></button>
      <button class="item" data-view="hist"><span>Hist√≥rico</span><span class="right">vistos</span></button>
      <button class="item" data-view="cfg"><span>Configura√ß√µes</span><span class="right">ajustes</span></button>
      <button class="close" id="closeMenu">Fechar</button>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    const state = {
      data: null,
      tab: 'all',
      view: 'games', // games | fav | hist | cfg
      q: '',
      fav: new Set(JSON.parse(localStorage.getItem('fav_ids')||'[]')),
      seen: new Set(JSON.parse(localStorage.getItem('seen_ids')||'[]')),
    };

    function saveLocal(){
      localStorage.setItem('fav_ids', JSON.stringify(Array.from(state.fav)));
      localStorage.setItem('seen_ids', JSON.stringify(Array.from(state.seen)));
    }

    function normalize(s){ return (s||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,''); }

    function isEurope(country){
      const c = (country||'').toLowerCase();
      // heur√≠stica simples
      return ['england','spain','italy','germany','france','portugal','netherlands','belgium','turkey','greece','scotland','wales','ireland','sweden','norway','denmark','finland','austria','switzerland','poland','czech','croatia','serbia','ukraine','russia','romania','bulgaria','hungary'].some(k=>c.includes(k));
    }

    function parseBrtDateTime(game){
      // game.date = YYYY-MM-DD, game.time = HH:MM (BRT)
      const [y,m,d] = game.date.split('-').map(Number);
      const [hh,mm] = game.time.split(':').map(Number);
      // Date em UTC, mas s√≥ precisamos comparar "dia" em BRT: usamos o pr√≥prio date do JSON.
      return {y,m,d,hh,mm};
    }

    function todayYMD(){
      // pega data local do dispositivo (voc√™ est√° em BR)
      const dt = new Date();
      const y = dt.getFullYear();
      const m = String(dt.getMonth()+1).padStart(2,'0');
      const d = String(dt.getDate()).padStart(2,'0');
      return `${y}-${m}-${d}`;
    }

    function gameMatchesTab(g){
      if(state.tab === 'all') return true;
      if(state.tab === 'br') return normalize(g.country).includes('brazil');
      if(state.tab === 'eu') return isEurope(g.country);
      if(state.tab === 'today') return g.date === todayYMD();
      if(state.tab === 'live') return !!g.live;
      return true;
    }

    function gameMatchesView(g){
      if(state.view === 'games') return true;
      if(state.view === 'fav') return state.fav.has(g.id);
      if(state.view === 'hist') return state.seen.has(g.id);
      if(state.view === 'cfg') return false;
      return true;
    }

    function gameMatchesQuery(g){
      const q = normalize(state.q);
      if(!q) return true;
      const text = normalize(`${g.home} ${g.away} ${g.league} ${g.country}`);
      return text.includes(q);
    }

    function statusLabel(g){
      if(g.live) return 'Ao vivo';
      if(g.status === 'FT' || g.status === 'AET' || g.status === 'PEN') return 'Final';
      if(g.status === 'NS') return 'N√£o iniciado';
      if(g.status) return g.status;
      return 'PST';
    }

    function statusPillClass(g){
      if(g.live) return 'pill live';
      if(g.status === 'FT' || g.status === 'AET' || g.status === 'PEN') return 'pill final';
      return 'pill';
    }

    function oddsRow(label, obj){
      if(!obj) return `
        <div class="mut">${label}</div>
        <div>‚Äî% ‚Ä¢ odd ‚Äî</div>
      `;
      return `
        <div class="mut">${label}</div>
        <div>${obj.p}% ‚Ä¢ odd ${obj.odd}</div>
      `;
    }

    function card(g){
      const showScore = !!g.live && g.score && (g.score.home !== null && g.score.away !== null);
      const probs = g.probs || null;

      return `
        <article class="card">
          <h2 class="title">${g.home} x ${g.away}</h2>
          <p class="sub">Liga: ${g.league} ‚Ä¢ ${g.country} ‚Ä¢ ${g.time}</p>

          <div class="pills">
            <span class="${statusPillClass(g)}">${statusLabel(g)}${g.live ? ' ‚Ä¢ Ao vivo' : ''}</span>
            ${showScore ? `<span class="pill">Placar: ${g.score.home} x ${g.score.away}</span>` : ``}
          </div>

          <div class="actions">
            <button class="btn small primary" data-act="seen" data-id="${g.id}">Marcar como visto</button>
            <button class="btn small ghost star" data-act="fav" data-id="${g.id}">${state.fav.has(g.id) ? '‚òÖ Favorito' : '‚òÜ Favoritar'}</button>
          </div>

          <div class="section">
            <h3>Probabilidades (estimativas)</h3>
            <div class="grid">
              ${oddsRow('Over 1,5', probs?.over15)}
              ${oddsRow('Over 2,5', probs?.over25)}
              ${oddsRow('Under 1,5', probs?.under15)}
              ${oddsRow('Under 2,5', probs?.under25)}
            </div>
          </div>
        </article>
      `;
    }

    function render(){
      const list = $('#list');
      list.innerHTML = '';

      if(state.view === 'cfg'){
        list.innerHTML = `
          <div class="card">
            <h2 class="title" style="font-size:34px">Configura√ß√µes</h2>
            <p class="sub">Em breve: alertas, ligas favoritas, notifica√ß√µes.</p>
            <div class="section">
              <h3>Status</h3>
              <div class="muted" style="color:rgba(169,192,198,.95); font-weight:900;">
                Vers√£o atual roda por GitHub Pages + GitHub Actions.
              </div>
            </div>
          </div>
        `;
        return;
      }

      const games = (state.data?.games || [])
        .filter(gameMatchesTab)
        .filter(gameMatchesView)
        .filter(gameMatchesQuery);

      if(!games.length){
        list.innerHTML = `<div class="empty">Nada encontrado.</div>`;
        return;
      }

      list.innerHTML = games.map(card).join('');

      // bind
      $$('[data-act="fav"]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.getAttribute('data-id'));
          if(state.fav.has(id)) state.fav.delete(id);
          else state.fav.add(id);
          saveLocal();
          render();
        };
      });
      $$('[data-act="seen"]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.getAttribute('data-id'));
          state.seen.add(id);
          saveLocal();
          render();
        };
      });
    }

    async function load(){
      const meta = $('#meta');
      meta.textContent = 'Carregando‚Ä¶';

      // cache-bust
      const url = `jogos.json?v=${Date.now()}`;
      const res = await fetch(url, {cache:'no-store'});
      const data = await res.json();
      state.data = data;

      meta.innerHTML = `
        Fonte autom√°tica (GitHub Action). √öltima atualiza√ß√£o: <b>${data.updatedAt}</b> ‚Ä¢
        Fonte: <b>${data.source}</b> ‚Ä¢
        Jogos: <b>${data.counts?.games ?? 0}</b>
      `;
      render();
    }

    // tabs
    $$('.tab').forEach(t=>{
      t.onclick = ()=>{
        $$('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        state.tab = t.getAttribute('data-tab');
        render();
      };
    });

    // search
    $('#q').addEventListener('input', (e)=>{
      state.q = e.target.value || '';
      render();
    });
    $('#clear').onclick = ()=>{
      $('#q').value = '';
      state.q = '';
      render();
    };
    $('#refresh').onclick = load;

    // menu
    const modal = $('#modal');
    $('#openMenu').onclick = ()=> modal.classList.add('open');
    $('#closeMenu').onclick = ()=> modal.classList.remove('open');
    modal.onclick = (e)=>{ if(e.target === modal) modal.classList.remove('open'); };

    $$('.item').forEach(it=>{
      it.onclick = ()=>{
        state.view = it.getAttribute('data-view');
        modal.classList.remove('open');
        render();
      };
    });

    $('#goGames').onclick = ()=>{
      state.view = 'games';
      render();
    };

    load();
  </script>
</body>
</html>
