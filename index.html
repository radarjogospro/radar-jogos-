<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#071f24" />
  <title>Radar Jogos PRO</title>
  <style>
    :root{
      --bg0:#061a1f;
      --bg1:#071f24;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.48);

      --a1:#31d7ff;   /* cyan */
      --a2:#a855f7;   /* purple */
      --a3:#22c55e;   /* green */
      --warn:#ef4444; /* red */

      --r:22px;
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --shadow2: 0 10px 25px rgba(0,0,0,.25);
      --blur: 18px;
      --pad: 14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(49,215,255,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(168,85,247,.14), transparent 60%),
        radial-gradient(900px 600px at 50% 100%, rgba(34,197,94,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--txt);
      min-height:100vh;
    }

    .wrap{
      max-width: 820px;
      margin: 0 auto;
      padding: 14px 12px 90px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px;
      border-radius: var(--r);
      background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(var(--blur));
      position: sticky;
      top: 10px;
      z-index: 20;
    }

    .brand{
      display:flex; flex-direction:column; gap:4px;
    }

    .brand .title{
      font-weight: 800;
      letter-spacing:.2px;
      font-size: 18px;
    }

    .online{
      display:flex; align-items:center; gap:8px;
      color: var(--muted);
      font-size: 13px;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: var(--a3);
      box-shadow: 0 0 0 4px rgba(34,197,94,.14);
    }

    .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      border-radius: 16px;
      padding: 10px 12px;
      font-weight: 650;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      backdrop-filter: blur(var(--blur));
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: linear-gradient(135deg, rgba(49,215,255,.25), rgba(34,197,94,.18));
      border-color: rgba(49,215,255,.25);
    }
    .btn.ghost{
      background: rgba(255,255,255,.04);
    }

    .card{
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--r);
      background: linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.035));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(var(--blur));
      position: relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 10px 10px, rgba(255,255,255,.07) 0 1px, transparent 2px) 0 0/18px 18px;
      opacity:.35;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    .row{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }

    .search{
      flex: 1 1 auto;
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
    }
    .search input{
      width:100%;
      border:0; outline:0;
      background: transparent;
      color: var(--txt);
      font-size: 14px;
    }
    .meta{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12.8px;
      line-height: 1.35;
    }

    .chips{
      margin-top: 10px;
      display:flex; gap:10px; flex-wrap:wrap;
    }

    .chip{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.055);
      color: var(--txt);
      padding: 9px 12px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 13px;
      cursor:pointer;
      display:flex; align-items:center; gap:8px;
      user-select:none;
    }
    .chip.active{
      background: linear-gradient(135deg, rgba(49,215,255,.20), rgba(168,85,247,.16));
      border-color: rgba(49,215,255,.22);
    }
    .chip .pill{
      width:8px; height:8px; border-radius:999px;
      background: rgba(255,255,255,.35);
    }
    .chip.active .pill{ background: var(--a1); }

    .subpanel{
      margin-top: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
    }
    .subpanel .label{
      color: var(--muted2);
      font-size: 12px;
      font-weight: 750;
      margin-bottom: 8px;
      display:flex; justify-content:space-between; align-items:center; gap:8px;
    }

    .window{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .wbtn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      padding: 9px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
    }
    .wbtn.active{
      background: linear-gradient(135deg, rgba(34,197,94,.20), rgba(49,215,255,.16));
      border-color: rgba(34,197,94,.25);
    }

    .propanel{
      margin-top: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
    .progrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .proitem{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      border-radius: 16px;
      padding: 12px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    .proitem b{ color: var(--txt); }

    .list{
      margin-top: 12px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .match{
      padding: 14px;
      border-radius: var(--r);
      background: linear-gradient(135deg, rgba(255,255,255,.075), rgba(255,255,255,.035));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(var(--blur));
      overflow:hidden;
      position:relative;
    }
    .match::after{
      content:"";
      position:absolute; inset:-40px -40px auto auto;
      width:160px; height:160px;
      background: radial-gradient(circle at 40% 40%, rgba(49,215,255,.18), transparent 60%);
      transform: rotate(18deg);
      pointer-events:none;
    }

    .mhead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .teams{
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .2px;
      line-height: 1.15;
    }
    .sub{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.15);
      color: var(--txt);
      font-weight: 800;
      font-size: 12px;
    }
    .tag.live{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
    }
    .tag.live .ldot{
      width:8px; height:8px; border-radius:999px;
      background: var(--warn);
      box-shadow: 0 0 0 4px rgba(239,68,68,.12);
    }

    .actions{
      margin-top: 12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .btn.small{
      padding: 10px 12px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 800;
      flex: 1 1 140px;
      display:flex; justify-content:center; gap:8px; align-items:center;
    }
    .btn.small.secondary{
      background: rgba(255,255,255,.05);
    }

    .accordion{
      margin-top: 12px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      overflow:hidden;
    }
    .acc-head{
      display:flex; justify-content:space-between; align-items:center;
      padding: 12px;
      cursor:pointer;
      user-select:none;
      color: var(--txt);
      font-weight: 900;
      font-size: 13px;
    }
    .acc-body{
      padding: 12px;
      border-top:1px solid rgba(255,255,255,.08);
      display:none;
    }
    .acc-body.open{ display:block; }

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .tab{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.045);
      padding: 7px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      color: var(--txt);
      opacity:.9;
    }
    .tab.active{
      background: linear-gradient(135deg, rgba(168,85,247,.16), rgba(49,215,255,.12));
      border-color: rgba(168,85,247,.25);
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 12px;
      align-items:center;
      font-size: 13px;
      color: var(--muted);
    }
    .grid2 b{ color: var(--txt); }

    .empty{
      margin-top: 12px;
      padding: 18px;
      border-radius: var(--r);
      border: 1px dashed rgba(255,255,255,.18);
      color: var(--muted);
      background: rgba(0,0,0,.16);
      text-align:center;
    }

    .bottomnav{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.45));
      backdrop-filter: blur(16px);
      z-index: 30;
    }
    .bnwrap{
      max-width: 820px;
      margin: 0 auto;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }
    .navbtn{
      flex:1 1 auto;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.055);
      color: var(--txt);
      border-radius: 18px;
      padding: 12px 10px;
      font-weight: 900;
      font-size: 13px;
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
      cursor:pointer;
      user-select:none;
    }
    .navbtn.active{
      background: linear-gradient(135deg, rgba(34,197,94,.22), rgba(49,215,255,.14));
      border-color: rgba(34,197,94,.28);
    }

    /* modal/menu */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      display:none;
      z-index: 60;
      padding: 18px 12px;
    }
    .overlay.open{ display:block; }
    .sheet{
      max-width: 820px;
      margin: 10px auto 0;
      border-radius: 22px;
      border: 1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .sheet h3{
      margin:0; padding: 14px 14px 10px;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .sheet .sitem{
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      cursor:pointer;
      user-select:none;
      color: var(--txt);
      font-weight: 850;
    }
    .sheet .sitem span{ color: var(--muted); font-weight: 800; }
    .sheet .sclose{
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      text-align:center;
      color: var(--txt);
      font-weight: 900;
      cursor:pointer;
    }
    @media (min-width: 720px){
      .teams{ font-size: 20px; }
      .progrid{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="title">Radar Jogos PRO</div>
        <div class="online"><span class="dot"></span> Online</div>
      </div>
      <button class="btn ghost" id="btnMenu">‚Ä¶ Menu</button>
    </div>

    <div class="card">
      <div class="row">
        <div class="search">
          <input id="q" placeholder="Buscar time, liga ou pa√≠s..." autocomplete="off" />
        </div>
        <button class="btn ghost" id="btnClear">Limpar</button>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn primary" id="btnRefresh">Atualizar</button>
      </div>

      <div class="meta" id="meta">Carregando‚Ä¶</div>

      <div class="chips">
        <div class="chip active" data-mode="next"><span class="pill"></span> ‚ö° Ao vivo + Pr√≥ximos</div>
        <div class="chip" data-mode="live"><span class="pill"></span> üî¥ Ao vivo</div>
        <div class="chip" data-mode="calendar"><span class="pill"></span> üìÖ Calend√°rio</div>
        <div class="chip" data-region="Brazil"><span class="pill"></span> üáßüá∑ Brasil</div>
        <div class="chip" data-region="Europe"><span class="pill"></span> üá™üá∫ Europa</div>
        <div class="chip" data-region="All"><span class="pill"></span> üåç Todos</div>
      </div>

      <div class="subpanel" id="calendarPanel" style="display:none;">
        <div class="label">
          <span>Data (BRT)</span>
          <span id="calendarHint"></span>
        </div>
        <div class="row">
          <input id="datePick" type="date" class="btn" style="flex:1 1 auto; text-align:left;" />
          <button class="btn" id="applyDate">Aplicar</button>
        </div>
      </div>

      <div class="subpanel" id="windowPanel">
        <div class="label">
          <span>Janela</span>
          <span id="windowHint">Pr√≥ximas 1h ‚Ä¢ BRT</span>
        </div>
        <div class="window" id="windowBtns">
          <div class="wbtn active" data-h="1">1h</div>
          <div class="wbtn" data-h="2">2h</div>
          <div class="wbtn" data-h="3">3h</div>
          <div class="wbtn" data-h="6">6h</div>
          <div class="wbtn" data-h="12">12h</div>
          <div class="wbtn" data-h="24">24h</div>
        </div>
      </div>

      <div class="propanel">
        <div class="label">
          <span>‚ú® Painel PRO</span>
          <span id="proStatus">Janela ativa: 1h ‚Ä¢ Fuso: BRT</span>
        </div>
        <div class="progrid">
          <div class="proitem"><b>Pr√≥ximos por janela</b><br>Escolha 1‚Äì24h para ver s√≥ o que come√ßa nessa faixa (ideal pra ‚Äúpuxar‚Äù jogo em cima da hora).</div>
          <div class="proitem"><b>Odds / Mais‚ÄìMenos</b><br>Aba pronta para probabilidades reais assim que voc√™ migrar para API paga.</div>
          <div class="proitem"><b>Favoritos</b><br>Salva jogos/ligas que voc√™ acompanha (localStorage). Layout e menu j√° preparados.</div>
          <div class="proitem"><b>Hist√≥rico</b><br>Marca jogos vistos e revisa depois (localStorage). √ìtimo pra rotina di√°ria.</div>
        </div>
      </div>
    </div>

    <div class="list" id="list"></div>
    <div class="empty" id="empty" style="display:none;">Nada para mostrar. Tente mudar filtros (Ao vivo / Pr√≥ximos / Calend√°rio) ou a janela (1h‚Äì24h).</div>
  </div>

  <div class="bottomnav">
    <div class="bnwrap">
      <div class="navbtn active" data-page="games">üóìÔ∏è Jogos</div>
      <div class="navbtn" data-page="fav">‚òÖ Favoritos</div>
      <div class="navbtn" data-page="hist">‚è±Ô∏è Hist√≥rico</div>
    </div>
  </div>

  <!-- Menu -->
  <div class="overlay" id="overlay">
    <div class="sheet">
      <h3>Menu</h3>
      <div class="sitem" data-menu="games">Jogos <span>lista principal</span></div>
      <div class="sitem" data-menu="fav">Favoritos <span>salvos</span></div>
      <div class="sitem" data-menu="hist">Hist√≥rico <span>vistos</span></div>
      <div class="sitem" data-menu="settings">Configura√ß√µes <span>ajustes</span></div>
      <div class="sclose" id="closeMenu">Fechar</div>
    </div>
  </div>

  <script>
    // ===== Helpers de BRT =====
    const TZ = "America/Sao_Paulo";

    function nowBRT(){
      // Date "em BRT" (via toLocaleString). Suficiente para comparar janelas no front.
      return new Date(new Date().toLocaleString("en-US", { timeZone: TZ }));
    }

    function isoDateBRT(d){
      // yyyy-mm-dd em BRT
      const parts = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).formatToParts(d);
      const y = parts.find(p=>p.type==="year").value;
      const m = parts.find(p=>p.type==="month").value;
      const da = parts.find(p=>p.type==="day").value;
      return `${y}-${m}-${da}`;
    }

    function parseKickoffBRT(dateStr, timeStr){
      // Interpreta date+time como BRT.
      // Prefer√™ncia: usar offset -03:00 (Brasil sem DST hoje). Se falhar, fallback.
      const t = (timeStr || "00:00").slice(0,5);
      const iso = `${dateStr}T${t}:00-03:00`;
      const d = new Date(iso);
      if (!isNaN(d)) return d;

      // fallback: construir e "re-interpretar" em BRT
      const fallback = new Date(`${dateStr}T${t}:00`);
      return new Date(fallback.toLocaleString("en-US", { timeZone: TZ }));
    }

    // ===== Status =====
    const FINISHED = new Set(["FT","AET","PEN"]);
    const CANCELED = new Set(["PST","CANC","ABD","SUSP","AWD","WO","TBD"]);
    const NOT_STARTED = new Set(["NS"]);

    function isLive(g){
      const s = (g.status || "").toUpperCase().trim();
      if (!s) return false;
      if (FINISHED.has(s) || CANCELED.has(s) || NOT_STARTED.has(s)) return false;
      // Qualquer coisa que n√£o seja FT/NS/etc consideramos ao vivo (HT, 1H, 2H, LIVE, IN_PLAY‚Ä¶)
      return true;
    }

    function isFinished(g){
      const s = (g.status || "").toUpperCase().trim();
      return FINISHED.has(s);
    }

    function isNotStarted(g){
      const s = (g.status || "").toUpperCase().trim();
      return NOT_STARTED.has(s) || s === "";
    }

    // ===== Estado =====
    let DATA = null;
    let MODE = "next"; // next | live | calendar
    let REGION = "All"; // All | Brazil | Europe
    let WINDOW_H = 1; // 1..24
    let DATE_PICK = null; // yyyy-mm-dd
    let PAGE = "games"; // games | fav | hist

    const EUROPE = new Set([
      "Albania","Andorra","Armenia","Austria","Azerbaijan","Belarus","Belgium","Bosnia and Herzegovina","Bulgaria",
      "Croatia","Cyprus","Czech Republic","Denmark","England","Estonia","Finland","France","Georgia","Germany","Gibraltar",
      "Greece","Hungary","Iceland","Ireland","Italy","Kosovo","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta",
      "Moldova","Montenegro","Netherlands","North Macedonia","Northern Ireland","Norway","Poland","Portugal","Romania",
      "Russia","San Marino","Scotland","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Turkey","Ukraine",
      "Wales"
    ]);

    // localStorage
    const LS_FAV = "rjp_favs_v1";
    const LS_HIST = "rjp_hist_v1";
    function loadSet(key){
      try{ return new Set(JSON.parse(localStorage.getItem(key) || "[]")); }
      catch{ return new Set(); }
    }
    function saveSet(key, set){
      localStorage.setItem(key, JSON.stringify([...set]));
    }
    let favs = loadSet(LS_FAV);
    let hist = loadSet(LS_HIST);

    // ===== UI refs =====
    const elList = document.getElementById("list");
    const elEmpty = document.getElementById("empty");
    const elMeta = document.getElementById("meta");
    const elQ = document.getElementById("q");
    const elWindowHint = document.getElementById("windowHint");
    const elProStatus = document.getElementById("proStatus");
    const elCalendarPanel = document.getElementById("calendarPanel");
    const elWindowPanel = document.getElementById("windowPanel");
    const elDatePick = document.getElementById("datePick");
    const elCalendarHint = document.getElementById("calendarHint");

    // ===== Fetch =====
    async function fetchData(){
      // cache-bust
      const url = `./jogos.json?v=${Date.now()}`;
      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error("Falha ao carregar jogos.json");
      return await res.json();
    }

    function gameId(g){
      // id est√°vel para fav/hist
      return `${g.date}|${g.time}|${g.country}|${g.league}|${g.home}|${g.away}`.toLowerCase();
    }

    function regionOk(g){
      if (REGION === "All") return true;
      if (REGION === "Brazil") return (g.country || "").toLowerCase() === "brazil";
      if (REGION === "Europe") return EUROPE.has(g.country || "");
      return true;
    }

    function queryOk(g){
      const q = (elQ.value || "").trim().toLowerCase();
      if(!q) return true;
      const s = `${g.home} ${g.away} ${g.league} ${g.country}`.toLowerCase();
      return s.includes(q);
    }

    function modeOk(g){
      const n = nowBRT();
      const kickoff = parseKickoffBRT(g.date, g.time);
      const s = (g.status || "").toUpperCase().trim();

      if (MODE === "live"){
        return isLive(g);
      }

      if (MODE === "calendar"){
        const pick = DATE_PICK || isoDateBRT(n);
        return g.date === pick;
      }

      // MODE === "next" (Ao vivo + Pr√≥ximos por janela)
      // - inclui ao vivo
      // - inclui n√£o iniciados dentro da janela
      // - exclui finalizados e cancelados
      if (isFinished(g)) return false;
      if (CANCELED.has(s)) return false;

      if (isLive(g)) return true;

      const diffMs = kickoff - n;
      const diffH = diffMs / (1000*60*60);

      // s√≥ futuros dentro da janela
      return diffH >= 0 && diffH <= WINDOW_H;
    }

    function sortGames(a,b){
      const da = parseKickoffBRT(a.date, a.time);
      const db = parseKickoffBRT(b.date, b.time);
      return da - db;
    }

    function formatMeta(){
      if(!DATA) return;

      const total = (DATA.games || []).length;
      const n = nowBRT();
      const today = isoDateBRT(n);

      let liveCount = 0, todayCount = 0, next24 = 0;
      for(const g of (DATA.games||[])){
        if (isLive(g)) liveCount++;
        if (g.date === today) todayCount++;

        const k = parseKickoffBRT(g.date, g.time);
        const dh = (k - n) / 3600000;
        if (dh >= 0 && dh <= 24 && !isFinished(g)) next24++;
      }

      elMeta.innerHTML =
        `√öltima atualiza√ß√£o: <b>${(DATA.updatedAt || "‚Äî")}</b> ‚Ä¢ Fonte: <b>${(DATA.source || "‚Äî")}</b><br>` +
        `Jogos no arquivo: <b>${total}</b> ‚Ä¢ Hoje: <b>${todayCount}</b> ‚Ä¢ Pr√≥x 24h: <b>${next24}</b> ‚Ä¢ Ao vivo: <b>${liveCount}</b>`;
    }

    function setMode(mode){
      MODE = mode;

      // chips active
      document.querySelectorAll(".chip[data-mode]").forEach(ch=>{
        ch.classList.toggle("active", ch.dataset.mode === MODE);
      });

      // pain√©is
      elCalendarPanel.style.display = (MODE === "calendar") ? "" : "none";
      elWindowPanel.style.display = (MODE === "next") ? "" : "none";

      render();
    }

    function setRegion(region){
      REGION = region;
      document.querySelectorAll(".chip[data-region]").forEach(ch=>{
        ch.classList.toggle("active", ch.dataset.region === REGION);
      });
      render();
    }

    function setWindow(h){
      WINDOW_H = h;
      document.querySelectorAll(".wbtn").forEach(b=>{
        b.classList.toggle("active", Number(b.dataset.h) === WINDOW_H);
      });
      elWindowHint.textContent = `Pr√≥ximas ${WINDOW_H}h ‚Ä¢ BRT`;
      elProStatus.textContent = `Janela ativa: ${WINDOW_H}h ‚Ä¢ Fuso: BRT`;
      render();
    }

    function setDatePick(v){
      DATE_PICK = v;
      elCalendarHint.textContent = v ? v.split("-").reverse().join("/") : "";
      render();
    }

    function render(){
      if(!DATA){
        elList.innerHTML = "";
        elEmpty.style.display = "";
        return;
      }

      // p√°gina: games/fav/hist
      let games = [...(DATA.games || [])];

      if (PAGE === "fav"){
        games = games.filter(g => favs.has(gameId(g)));
      } else if (PAGE === "hist"){
        games = games.filter(g => hist.has(gameId(g)));
      }

      games = games
        .filter(regionOk)
        .filter(queryOk)
        .filter(modeOk)
        .sort(sortGames);

      elList.innerHTML = "";
      elEmpty.style.display = games.length ? "none" : "";

      for(const g of games){
        elList.appendChild(renderMatch(g));
      }
    }

    function renderMatch(g){
      const id = gameId(g);
      const live = isLive(g);
      const kickoff = parseKickoffBRT(g.date, g.time);

      const m = document.createElement("div");
      m.className = "match";

      const title = `${g.home} x ${g.away}`;
      const sub = `${g.league || "‚Äî"} ‚Ä¢ ${g.country || "‚Äî"} ‚Ä¢ ${String(g.time||"‚Äî").slice(0,5)}`;
      const dateBadge = (g.date || "").split("-").reverse().join("/");

      m.innerHTML = `
        <div class="mhead">
          <div>
            <div class="teams">${escapeHtml(title)}</div>
            <div class="sub">
              <span>${escapeHtml(sub)}</span>
              <span class="tag">${escapeHtml(dateBadge)}</span>
            </div>
          </div>
          ${live ? `<div class="tag live"><span class="ldot"></span> AO VIVO</div>` : ``}
        </div>

        <div class="actions">
          <button class="btn small secondary" data-action="details">Detalhes</button>
          <button class="btn small ${favs.has(id) ? "primary" : "secondary"}" data-action="fav">‚òÖ Favoritar</button>
        </div>

        <div class="accordion">
          <div class="acc-head" data-action="toggle">
            <span>INSIGHTS</span>
            <span style="color:var(--muted); font-weight:900;">${live ? "Ao vivo" : (isNotStarted(g) ? "N√£o iniciado" : (g.status||"‚Äî"))}</span>
          </div>
          <div class="acc-body">
            <div class="tabs">
              <div class="tab active" data-tab="odds">Odds</div>
              <div class="tab" data-tab="mm">Mais/Menos</div>
              <div class="tab" data-tab="forma">Forma</div>
            </div>

            <div class="grid2" data-pane="odds">
              <b>Over 1,5</b><span>‚Äî% ‚Ä¢ odd ‚Äî</span>
              <b>Over 2,5</b><span>‚Äî% ‚Ä¢ odd ‚Äî</span>
              <b>Under 1,5</b><span>‚Äî% ‚Ä¢ odd ‚Äî</span>
              <b>Under 2,5</b><span>‚Äî% ‚Ä¢ odd ‚Äî</span>
              <span style="grid-column:1/3; color:var(--muted2); font-weight:800;">
                No FREE, o c√°lculo pode n√£o aparecer. Layout pronto para API paga.
              </span>
            </div>

            <div class="grid2" data-pane="mm" style="display:none;">
              <b>+</b><span>tend√™ncia ofensiva</span>
              <b>‚àí</b><span>tend√™ncia defensiva</span>
              <b>Gols recentes</b><span>√∫ltimos 3 jogos (quando dispon√≠vel)</span>
              <span style="grid-column:1/3; color:var(--muted2); font-weight:800;">
                (Em breve: dados reais via API paga.)
              </span>
            </div>

            <div class="grid2" data-pane="forma" style="display:none;">
              <b>Forma Casa</b><span>‚Äî</span>
              <b>Forma Fora</b><span>‚Äî</span>
              <b>H2H</b><span>‚Äî</span>
              <span style="grid-column:1/3; color:var(--muted2); font-weight:800;">
                (Em breve: forma/placares e hist√≥rico via API paga.)
              </span>
            </div>
          </div>
        </div>
      `;

      // handlers
      m.querySelector('[data-action="toggle"]').addEventListener("click", ()=>{
        const body = m.querySelector(".acc-body");
        body.classList.toggle("open");
      });

      m.querySelector('[data-action="fav"]').addEventListener("click", ()=>{
        if (favs.has(id)) favs.delete(id); else favs.add(id);
        saveSet(LS_FAV, favs);
        render();
      });

      m.querySelector('[data-action="details"]').addEventListener("click", ()=>{
        // marca como visto automaticamente ao abrir detalhes
        hist.add(id);
        saveSet(LS_HIST, hist);

        const k = parseKickoffBRT(g.date, g.time);
        alert(
          `${g.home} x ${g.away}\n` +
          `${g.league} ‚Ä¢ ${g.country}\n` +
          `Data: ${dateBadge} ‚Ä¢ Hora: ${String(g.time||"‚Äî").slice(0,5)} (BRT)\n` +
          `Status: ${(g.status||"‚Äî")}\n\n` +
          `Kickoff(BRT): ${k.toLocaleString("pt-BR")}`
        );
        render();
      });

      // tabs
      const tabs = [...m.querySelectorAll(".tab")];
      tabs.forEach(t=>{
        t.addEventListener("click", ()=>{
          tabs.forEach(x=>x.classList.toggle("active", x===t));
          const sel = t.dataset.tab;
          m.querySelectorAll("[data-pane]").forEach(p=>{
            p.style.display = (p.dataset.pane === sel) ? "" : "none";
          });
        });
      });

      return m;
    }

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    // ===== Menu / Navega√ß√£o =====
    const overlay = document.getElementById("overlay");
    document.getElementById("btnMenu").addEventListener("click", ()=> overlay.classList.add("open"));
    document.getElementById("closeMenu").addEventListener("click", ()=> overlay.classList.remove("open"));
    overlay.addEventListener("click", (e)=>{ if(e.target === overlay) overlay.classList.remove("open"); });

    overlay.querySelectorAll("[data-menu]").forEach(it=>{
      it.addEventListener("click", ()=>{
        const to = it.dataset.menu;
        overlay.classList.remove("open");
        setPage(to);
      });
    });

    function setPage(p){
      PAGE = (p === "settings") ? "games" : p;

      document.querySelectorAll(".navbtn").forEach(nb=>{
        nb.classList.toggle("active", nb.dataset.page === PAGE);
      });

      // s√≥ para ‚Äúconfigura√ß√µes‚Äù (layout pronto)
      if (p === "settings"){
        alert("Configura√ß√µes: em breve (alertas, ligas favoritas, notifica√ß√µes).");
      }
      render();
    }

    document.querySelectorAll(".navbtn").forEach(nb=>{
      nb.addEventListener("click", ()=> setPage(nb.dataset.page));
    });

    // ===== Chips =====
    document.querySelectorAll(".chip[data-mode]").forEach(ch=>{
      ch.addEventListener("click", ()=> setMode(ch.dataset.mode));
    });
    document.querySelectorAll(".chip[data-region]").forEach(ch=>{
      ch.addEventListener("click", ()=> setRegion(ch.dataset.region));
    });

    // janela
    document.querySelectorAll(".wbtn").forEach(b=>{
      b.addEventListener("click", ()=> setWindow(Number(b.dataset.h)));
    });

    // calend√°rio default hoje (BRT)
    const today = isoDateBRT(nowBRT());
    elDatePick.value = today;
    setDatePick(today);

    document.getElementById("applyDate").addEventListener("click", ()=>{
      setDatePick(elDatePick.value);
    });

    // busca
    elQ.addEventListener("input", ()=> render());
    document.getElementById("btnClear").addEventListener("click", ()=>{
      elQ.value = "";
      render();
    });

    // refresh
    document.getElementById("btnRefresh").addEventListener("click", async ()=>{
      await init(true);
    });

    async function init(force){
      try{
        if(force) elMeta.textContent = "Atualizando‚Ä¶";
        DATA = await fetchData();
        formatMeta();
        // aplica estado atual sem perder sele√ß√£o
        elWindowHint.textContent = `Pr√≥ximas ${WINDOW_H}h ‚Ä¢ BRT`;
        elProStatus.textContent = `Janela ativa: ${WINDOW_H}h ‚Ä¢ Fuso: BRT`;
        render();
      }catch(err){
        console.error(err);
        elMeta.textContent = "Falha ao carregar jogos. Verifique jogos.json / GitHub Pages.";
        DATA = { updatedAt:"‚Äî", source:"‚Äî", games:[] };
        render();
      }
    }

    // inicial
    setMode("next");
    setRegion("All");
    setWindow(1);
    init(false);
  </script>
</body>
</html>
